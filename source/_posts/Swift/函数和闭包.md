---
title: 函数和闭包
date: 2023-03-15 15:04:35
tags: Swift
---

函数是一个独立的代码块，用来执行特定的任务。通过给函数一个名字来定义它的功能，并且在需要的时候，通过这个名字来“调用”函数执行它的任务。

Swift 统一的函数语法十分灵活，可以表达从简单的无形式参数的 C 风格函数，到复杂的每一个形式参数都带有局部和外部形式参数名的 Object-C 风格方法的任何内容。

形式参数能提供一个默认的值来简化函数的调用，也可以被当做输入输出形式参数被传递，它在函数执行完成时修改传递来的变量。

Swfit 中的每一个函数都有类型，有函数的形式参数类型和返回类型组成。可以像 Swfit 中其它类型那样使用它。这使得能够方便的将一个函数当作一个形式参数传递到另外的一个函数中，也可以在一个函数中返回另一个函数。函数同时也可以写在其它函数内部，在内嵌范围封装有用的功能。

## 函数的定义

### 定义和调用函数

在定义一个函数时，可以定义一个或者多个被命名的分类的值，作为函数的输入（形式参数）。在函数完成后，也可以定义将要传回的值作为输出的类型（返回类型）。

每一个函数都有一个函数名，它描述了函数执行的任务。要使用一个函数，可以通过“调用”函数的名字并且传入符合函数形式参数类型的输入值（实际参数）来调用这个函数。给函数提供的实际参数的顺序必须符合函数的形式参数列表顺序。

```swift
import Foundation

func greet(person: String) -> String {
    let greeting = "Hello, " + person + "!"
    return greeting
}

greet(person: "zhangsan")
// Prints 'Hello, zhangsan!'
```

### 无形式参数的函数

函数没有要求必须输入一个参数，可以没有形式参数。函数的定义需要在名字后边加一个圆括号`()`，即使在不接受形式参数时也得这样做。当函数被调用的时候同样要在函数的名字后边加一个空的圆括号`()`。

```swift
func sayHello() -> String {
    return "hello"
}
print(sayHello())
// Prints 'hello'
```

### 多形式参数的函数

函数可以输入多个形式参数，写在函数后边的圆括号内，用逗号分隔。

```swift
func greetAgain(person: String) -> String {
    return "Hello again, \(person)"
}

func greet(person: String) -> String {
    return "Hello, \(person)"
}

func greet(person: String, alreadyGreeted: Bool) -> String {
    if alreadyGreeted {
        return greetAgain(person: person)
    } else {
        return greet(person: person)
    }
}

print(greet(person: "Kevin", alreadyGreeted: true))
// Prints 'Hello again, Kevin'
```

### 无返回值的函数

函数定义中没有要求必须有一个返回类型。不需要返回值，函数在定义的时候就没有包含返回箭头`->`或者返回类型。

严格来讲，尽管函数 `greet(person:)`没有定义返回值，但是它还是有一个返回值的。没有定义返回类型的函数实际上会返回一个特殊的类型 `Void`，它是一个空的元组，作用相当于没有元素的元组，可以写作 `()`。

```swift
func greet(person: String) {
    print("Hello, \(person)")
}

print(greet(person: "kevin"))
```

打印结果：

```js
Hello, kevin
()
```

### 多返回值的函数

为了让函数返回多个值作为一个复合的返回值，可以使用元组类型作为返回类型。

```swift
func minMax(array: [Int]) -> (min: Int, max: Int)? {
    var currentMin = array[0]
    var currentMax = array[0]
    for value in array[1..<array.count] {
        if value < currentMin {
            currentMin = value
        } else if value > currentMax {
            currentMax = value
        }
    }
    return (currentMin, currentMax)
}

if let bounds = minMax(array: [8, -6, 2, 109, 3, 711]) {
    print("min is \(bounds.min) and max is \(bounds.max)")
}
// Prints 'min is -6 and max is 711'
```

### 可选元组返回类型

如果函数返回的元组可能“没有值”，可以用一个**可选元组返回类型**来表示整个元组可能是 `nil`。写法是在可选元组类型的圆括号后边添加一个问号`?`，例如：`(Int, Int)?` 或者 `(String, Int, Bool)?`。

```swift
func minMax(array: [Int]) -> (min: Int, max: Int)? {
    if array.count == 0 {
        return nil
    }
    var currentMin = array[0]
    var currentMax = array[0]
    for value in array[1..<array.count] {
        if value < currentMin {
            currentMin = value
        } else if value > currentMax {
            currentMax = value
        }
    }
    return (currentMin, currentMax)
}

print(minMax(array: []))
// Prints 'nil'
```

### 隐式返回的函数

如果整个函数体是一个单一表达式，那么函数隐式返回这个表达式。

```swift
func greeting(for person: String) -> String {
    "Hello, " + person + "!"
}
print(greeting(for: "Kevin"))
// Prints 'Hello, Kevin!'
```

上面的写法等价于👇

```swift
func anotherGreeting(for person: String) -> String {
    return "Hello, " + person + "!"
}
print(anotherGreeting(for: "Kevin"))
// Prints 'Hello, Kevin!'
```

## 函数实际参数标签和形式参数名

### 实参标签和形参名

每一个函数的**形式参数**都包含**实际参数标签**和**形式参数名**。实际参数标签用在调用函数的时候，在调用函数的时候每一个**实际参数**前边都要写**实际参数标签**。形式参数名用在函数的实现当中，默认情况下，形式参数使用**形式参数名**作为**实际参数标签**。所有的形式参数必须有唯一的名字。尽管多个形式参数拥有相同的实际参数标签也是有可能的，但是唯一的实际参数标签有助于让代码更加易读。

参数由形式参数名代替实际参数标签👇

![01](../Swift/函数和闭包/01.png)

### 指定实际参数标签

在提供形式参数名之前写实际参数标签，用空格分隔。如果为一个形式参数提供了实际参数标签，那么这个实际参数就必须在调用函数的时候使用标签。实际参数标签的使用能够让函数的调用更加明确，更像是自然语句，同时还能提供更可读的函数体并更清晰的表达函数的意图。

```swift
func greet(person: String, from hometown: String) -> String {
    return "Hello \(person)! Glad you could visit from \(hometown)."
}

print(greet(person: "Kevin", from: "Cupertion"))
// Prints 'Hello Kevin! Glad you could visit from Cupertion.'
```

### 省略实际参数标签

如果对于函数的形式参数不想使用实际参数标签的话，可以**利用下划线 `_` 来代替显示的实际参数标签**。

第一个参数不使用实际参数标签，第二个参数由形式参数名代替实际参数标签👇

![02](../Swift/函数和闭包/02.png)

### 默认形式参数值

### 可变形式参数

### 输入输出形式参数

## 函数类型和内嵌函数

### 函数类型

### 使用函数类型

### 函数类型作为形式参数类型

### 函数类型作为返回类型

### 内嵌函数

## 闭包

### 闭包表达式

### 闭包表达式-从sorted函数说起

### 闭包表达式语法

### 闭包表达式语法版本的backward

### 从语境中推断类型

### 从单表达式闭包隐式返回

### 简写时机参数名

### 运算符函数

### 尾随闭包

### 捕获值

### 闭包是引用类型

### 逃逸闭包和自动闭包

#### 逃逸闭包

#### 自动闭包

#### 自动+逃逸

## 高阶函数

### map

### filter

### reduce

### flatMap

### compactMap

## 函数式编程

### 函数式编程1

#### 范式转换

#### 传统解决方案

#### 函数式

#### 简洁

### 函数式编程2

#### 命令式解法

#### 函数式解法

## Swift的劣势-并行

