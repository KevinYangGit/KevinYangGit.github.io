---
title: é“¾è¡¨
date: 2020-10-20 16:41:50
tags: æ•°æ®ç»“æ„ä¸ç®—æ³•
---

[é“¾è¡¨](https://baike.baidu.com/item/%E9%93%BE%E8%A1%A8/9794473?fr=aladdin)æ˜¯ä¸€ç§ç‰©ç†å­˜å‚¨å•å…ƒä¸Šéè¿ç»­ã€éé¡ºåºçš„å­˜å‚¨ç»“æ„ï¼Œæ•°æ®å…ƒç´ çš„é€»è¾‘é¡ºåºæ˜¯é€šè¿‡é“¾è¡¨ä¸­çš„æŒ‡é’ˆé“¾æ¥æ¬¡åºå®ç°çš„ã€‚

<!-- more -->

# å•å‘é“¾è¡¨
åŠ¨æ€æ•°ç»„åœ¨æ‰©å®¹æ—¶ï¼Œå¦‚æœæ–°æ‰©å‡ºæ¥çš„ç©ºé—´æ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œå°±é€ æˆäº†å†…å­˜ç©ºé—´çš„å¤§é‡æµªè´¹ã€‚è€Œé“¾è¡¨åˆ™æ˜¯ç”¨åˆ°å¤šå°‘å°±ç”³è¯·å¤šå°‘å†…å­˜ç©ºé—´ã€‚

çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨è¡¨ç¤ºçš„ç‰¹ç‚¹æ˜¯ç”¨ä¸€ç»„ä»»æ„çš„å­˜å‚¨å•å…ƒå­˜å‚¨çº¿æ€§è¡¨çš„æ•°æ®å…ƒç´ ã€‚è¿™ç»„å­˜å‚¨å•å…ƒå¯ä»¥æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸è¿ç»­çš„ã€‚

é“¾è¡¨ç”±ä¸€ç³»åˆ—ç»“ç‚¹ï¼ˆé“¾è¡¨ä¸­æ¯ä¸€ä¸ªå…ƒç´ ç§°ä¸ºç»“ç‚¹ï¼‰ç»„æˆï¼Œç»“ç‚¹å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚æ¯ä¸ªç»“ç‚¹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å­˜å‚¨æ•°æ®å…ƒç´ çš„æ•°æ®åŸŸï¼Œå¦ä¸€ä¸ªæ˜¯å­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹åœ°å€çš„æŒ‡é’ˆåŸŸã€‚
![é“¾è¡¨01](é“¾è¡¨/é“¾è¡¨01.png)

## è‡ªå®šä¹‰é“¾è¡¨
### é“¾è¡¨çš„è®¾è®¡
å®šä¹‰ size è®°å½•é“¾è¡¨çš„å¤§å°ï¼Œå®šä¹‰ firt æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¤´ç»“ç‚¹ï¼‰ã€‚æ¯ä¸ªèŠ‚ç‚¹é‡Œå®šä¹‰ element å­˜å‚¨æ•°æ®ï¼Œå®šä¹‰ next æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹åœ°å€ï¼‰ã€‚
![é“¾è¡¨02](é“¾è¡¨/é“¾è¡¨02.png)

### æ¥å£è®¾è®¡
![é“¾è¡¨04](é“¾è¡¨/é“¾è¡¨04.png)
åˆ›å»ºä¸€ä¸ªæ¥å£ç±» Listï¼Œç”¨æ¥å®šä¹‰ ArrayList å’Œ LinkedList çš„å…¬å…±æ¥å£ï¼ˆå³é”® -> new -> Interfaceï¼‰ï¼š
```
public interface List<E> {
    /**
     * é”™è¯¯ç 
     */
    public static final int ELEMENT_NOT_FOUND = -1;
    /**
     * æ¸…é™¤æ‰€æœ‰å…ƒç´ 
     */
    public void clear();
    /**
     * å…ƒç´ çš„æ•°é‡
     * @return
     */
    public int size();
    /**
     * æ˜¯å¦ä¸ºç©º
     * @return
     */
    public boolean isEmpty();
    /**
     * æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 
     * @param element
     * @return
     */
    public boolean contains(E element);
    /**
     * æ·»åŠ å…ƒç´ åˆ°å°¾éƒ¨
     * @param element
     */
    public void add(E element); 
    /**
     * è·å–indexä½ç½®çš„å…ƒç´ 
     * @param index
     * @return
     */
    public E get(int index);
    /**
     * è®¾ç½®indexä½ç½®çš„å…ƒç´ 
     * @param index
     * @param element
     * @return åŸæ¥çš„å…ƒç´ Öµ
     */
    public E set(int index, E element);
    /**
     * åœ¨indexä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ 
     * @param index
     * @param element
     */
    public void add(int index, E element);
    /**
     * åˆ é™¤indexä½ç½®çš„å…ƒç´ 
     * @param index
     * @return
     */
    public E remove(int index);
    /**
     * æŸ¥çœ‹å…ƒç´ çš„ç´¢å¼•
     * @param element
     * @return
     */
    public int indexOf(E element);
}
```

åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±» AbstractListï¼Œå®ç° ArrayList å’Œ LinkedList æœ‰ç›¸åŒå®ç°çš„æ–¹æ³•ï¼š
```
// implements å®ç°æ¥å£
// abstract æŠ½è±¡ç±»ï¼š1ã€å¯ä»¥é€‰æ‹©å®ç°æ¥å£ï¼›2ã€æŠ½è±¡ç±»æ— æ³•è¢«åˆ›å»ºï¼ˆnew AbstractList<>()ï¼‰
public abstract class AbstractList<E> implements List<E>{
    
    protected int size; // protected å­ç±»å¯ä»¥è®¿é—®
    
    @Override
    public int size() {
        return size;
    }

    @Override
    public boolean isEmpty() {
        return size == 0;
    }

    @Override
    public boolean contains(E element) {
        return indexOf(element) != ELEMENT_NOT_FOUND;
    }

    @Override
    public void add(E element) {
        add(size, element);
    }
    
    protected void outOfBounds(int index) {
        throw new IndexOutOfBoundsException("Index:" + index + ", Size" + size);
    }
    
    protected void rangeCheck(int index) {
        if (index < 0 || index >= size) {
            outOfBounds(index);
        }
    }
    
    protected void rangeCheckForAdd(int index) {
        if (index < 0 || index > size) {
            outOfBounds(index);
        }
    }
}
```

è®© ArrayList å’Œ LinkedList ç»§æ‰¿è‡ª AbstractListï¼š
```
// åŠ¨æ€æ•°ç»„
public class ArrayList<E> extends AbstractList<E> { 
    // å®ç°å‰©ä½™æ–¹æ³•
}

// é“¾è¡¨
public class LinkedList<E> extends AbstractList<E> {
    // å®ç°å‰©ä½™æ–¹æ³•
}
```

psï¼š  
å®ç° List æ¥å£çš„å¿«æ·æ–¹å¼ï¼š
![é“¾è¡¨03](é“¾è¡¨/é“¾è¡¨03.png)

### clear
```
public void clear() {
    size = 0;
    first = null;
}
```
å›¾è§£ï¼š
![é“¾è¡¨05](é“¾è¡¨/é“¾è¡¨05.png)

### get/set
å®šä¹‰ `node(int index)` æ–¹æ³•ï¼ŒæŸ¥æ‰¾æŒ‡å®š index å¤„çš„ node å¹¶è¿”å›ï¼š
```
public E get(int index) {
    return node(index).element;
}

public E set(int index, E element) {
    Node<E> node = node(index);
    E old = node.element;
    node.element = element;
    return old;
}

private Node<E> node(int index) {
    rangeCheck(index);
    
    Node<E> node = first;
    for (int i = 0; i < index; i++) {
        node = node.next;
    }
    return node;
}
```

### add
æ·»åŠ æ–°çš„ newNodeï¼š
![é“¾è¡¨06](é“¾è¡¨/é“¾è¡¨06.png)

#### index == 1
è¦æ·»åŠ ä¸€ä¸ª node åˆ° index == 1 çš„ä½ç½®ï¼Œåªéœ€è¦æ‰¾åˆ° index - 1 å¤„çš„ prevï¼Œé‚£ä¹ˆ index == 1 å¤„å°±æ˜¯ prev.nextã€‚è®©æ–°æ·»åŠ çš„ newNode çš„ next æŒ‡å‘ prev.nextï¼Œå†è®© prev çš„ next æŒ‡é’ˆæŒ‡å‘ newNodeï¼š
![é“¾è¡¨07](é“¾è¡¨/é“¾è¡¨07.png)

#### index == size
è¦æ·»åŠ ä¸€ä¸ª node åˆ° index == size çš„ä½ç½®ï¼Œåªéœ€è¦æ‰¾åˆ° index - 1 å¤„çš„ prevï¼Œé‚£ä¹ˆ index == size å¤„å°±æ˜¯ prev.nextï¼ˆnullï¼‰ã€‚è®©æ–°æ·»åŠ çš„ newNode çš„ next æŒ‡å‘ prev.nextï¼Œå†è®© prev çš„ next æŒ‡é’ˆæŒ‡å‘ newNodeï¼š
![é“¾è¡¨09](é“¾è¡¨/é“¾è¡¨09.png)

#### index == 0
è¦æ·»åŠ ä¸€ä¸ª node åˆ° index == 0 çš„ä½ç½®ï¼Œåªéœ€è¦è®©æ–°æ·»åŠ çš„ newNode çš„ next æŒ‡å‘ firstï¼Œå†è®© first æŒ‡å‘ newNodeï¼š
![é“¾è¡¨08](é“¾è¡¨/é“¾è¡¨08.png)

#### ä»£ç å®ç°
```
public void add(int index, E element) {
    rangeCheckForAdd(index);
    
    if (index == 0) {
        first = new Node<>(element, first);
    } else {
        Node<E> prev = node(index - 1);
        prev.next = new Node<>(element, prev.next); 
    }
    size++;
}
```

### remove
1. è¦åˆ é™¤ index == 1 å¤„çš„ nodeï¼Œåªéœ€è¦æ‰¾åˆ° index - 1 å‡ºçš„ prevï¼Œè®© `prev.next = prev.next.next`ã€‚
2. è¦åˆ é™¤ index == 0 å¤„çš„ nodeï¼Œåªéœ€è¦è®© `first = first.next`ã€‚
```
public E remove(int index) {
    rangeCheck(index);
    
    Node<E> node = first;
    if (index == 0) {
        first = first.next;
    } else {
        Node<E> prev = node(index - 1);
        node = prev.next;
        prev.next = node.next;  
    }
    size--;
    return node.element;
}
```
å›¾è§£ï¼š
![é“¾è¡¨10](é“¾è¡¨/é“¾è¡¨10.png)

### indexOf
```
public int indexOf(E element) {
    if (element == null) {
        Node<E> node = first;
        for (int i = 0; i < size; i++) {
            if (node.element == null) return i;
            
            node = node.next;
        }
    } else {
        Node<E> node = first;
        for (int i = 0; i < size; i++) {
            if (node.element.equals(element)) return i;
            
            node = node.next;
        }   
    }
    return ELEMENT_NOT_FOUND;
}
```

psï¼š[VisuAlgo](https://visualgo.net/zh) ä»¥åŠ¨ç”»çš„æ–¹å¼å±•ç¤ºäº†æ•°æ®ç»“æ„åŸºæœ¬æ“ä½œçš„åŸç†ï¼Œè¿˜æœ‰ä»£ç å®ç°ã€‚

## ç»ƒä¹ 
é“¾è¡¨çš„é¢˜ç›®ä¼šç”¨åˆ°ä¸€ä¸ª ListNode èŠ‚ç‚¹ç±»ï¼Œæ‰€ä»¥å…ˆåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ç±»ï¼š
```
public class ListNode {
    int val;
    ListNode next;
    ListNode(int x) {
        val = x;
    }
}
```

### åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹
åŸºæœ¬æ“ä½œï¼š  
1. ä»¥é¢˜ç›®çš„ç±»å‹å’Œé¢˜ç›®åç§°åˆ†åˆ«åˆ›å»ºâ€œé“¾è¡¨â€åŒ…å’Œâ€œ_237_åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹â€æ–‡ä»¶ï¼›
2. ä¿å­˜æ”¹é¢˜ç›®çš„è¿æ¥ï¼š[237. åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-node-in-a-linked-list/)ï¼Œæ–¹ä¾¿ä»¥åæŸ¥çœ‹ï¼›
3. æ‹·è´ç½‘é¡µä¸­çš„æ¡ä»¶åŠé¢˜ç›®ï¼›
![é“¾è¡¨11](é“¾è¡¨/é“¾è¡¨11.png)

åˆ†æï¼šåˆ é™¤æŒ‡å®šèŠ‚ç‚¹ nodeï¼Œå¯ä»¥å°† node ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å®¹è¦†ç›–æ‰ node çš„å†…å®¹ï¼Œè®©åå°† node çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤æ‰ `node.next = node.next.next`ï¼š
```
public void deleteNode(ListNode node) {
    node.val = node.next.val;
    node.next = node.next.next;
}
```
å›¾è§£ï¼š
![é“¾è¡¨12](é“¾è¡¨/é“¾è¡¨12.png)

### åè½¬ä¸€ä¸ªé“¾è¡¨
[206. åè½¬é“¾è¡¨](https://leetcode-cn.com/problems/reverse-linked-list/)
![é“¾è¡¨13](é“¾è¡¨/é“¾è¡¨13.png)
#### é€’å½’
[5, 4, 3, 2, 1] ä¼ å…¥4ï¼ŒreverseList(4) -> [1, 2, 3, 4]ï¼š
![é“¾è¡¨14](é“¾è¡¨/é“¾è¡¨14.png)
ä»£ç å®ç°ï¼š
```
//[5, 4, 3, 2, 1], headï¼š5
public ListNode reverseList(ListNode head) {
    // æ·»åŠ è¾¹ç•Œï¼Œé¿å…æ­»å¾ªç¯
    // head == null è¡¨ç¤ºæ²¡æœ‰å…ƒç´ 
    // head.next == null è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå…ƒç´ 
    if (head == null || head.next == null) return head;
    
    // 1->2, 2->3, 3->4, 4->5
    ListNode newHead = reverseList(head.next);
    head.next.next = head;
    head.next = null;
    return newHead;
}
```

#### è¿­ä»£
newHead, head -> [5, 4, 3, 2, 1]  
newHead -> [5], head -> [4, 3, 2, 1]  
newHead -> [5, 4], head -> [3, 2, 1]  
...
![é“¾è¡¨15](é“¾è¡¨/é“¾è¡¨15.png)
ä»£ç å®ç°ï¼š
```
public ListNode reverseList2(ListNode head) {
    if (head == null || head.next == null) return head;
    
    ListNode newHead = null;
    while (head != null) {
        ListNode tmp = head.next;
        head.next = newHead;
        newHead = head;
        head = tmp;
    }
    return newHead;
}
```

### åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦æœ‰ç¯
[141. ç¯å½¢é“¾è¡¨](https://leetcode-cn.com/problems/linked-list-cycle/)  
å¿«æ…¢æŒ‡é’ˆï¼šslow ç§»åŠ¨1ä¸ªå…ƒç´ /æ¬¡ï¼Œfast ç§»åŠ¨2ä¸ªå…ƒç´ /æ¬¡ï¼Œå½“ slow å’Œ fast ç›¸é‡çš„æ—¶å€™ï¼Œè¯´æ˜é“¾è¡¨æœ‰ç¯ã€‚
![é“¾è¡¨16](é“¾è¡¨/é“¾è¡¨16.png)
ä»£ç å®ç°ï¼š
```
public boolean hasCycle(ListNode head) {
    if (head == null || head.next == null) return false;
    
    ListNode slow = head;
    ListNode fast = head.next;
    while (fast != null && fast.next != null) {
        slow = slow.next;
        fast = fast.next.next;
        if (slow == fast) return true;
    }
    return false;
}
```

### ç§»é™¤é“¾è¡¨å…ƒç´ 
[203. ç§»é™¤é“¾è¡¨å…ƒç´ ](https://leetcode-cn.com/problems/remove-linked-list-elements/)
```
public ListNode removeElements(ListNode head, int val) {
    if (head == null) return head;
    
    // éå†é“¾è¡¨
    ListNode node = head;
    while (node.next != null) {
        if (node.next.val == val) {
            node.next = node.next.next;
        } else {
            node = node.next;
        }
    }

    // åˆ¤æ–­å¤´ç»“ç‚¹
    if (head.val == val) {
        if (head.next == null) {
            return null;
        } else {
            head = head.next;
        }
    }
    
    return head;
}
```

### åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ 
[83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ ](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/submissions/)
```
public ListNode deleteDuplicates(ListNode head) {
    if (head == null || head.next == null) return head;
    // éå†é“¾è¡¨
    ListNode node = head;
    while (node != null) {
        
        // ä» node å¼€å§‹éå†é“¾è¡¨
        ListNode targetNode = node;
        while (targetNode.next != null) {
            if (targetNode.next.val == node.val) {
                targetNode.next = targetNode.next.next;
            } else {
                targetNode = targetNode.next;   
            }
        }
        
        node = node.next;
    }
    
    return head;
}
```

### é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹
[876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹](https://leetcode-cn.com/problems/middle-of-the-linked-list/)
```
public ListNode middleNode(ListNode head) {
    int count = 0; // æ ‡è®°é“¾è¡¨é•¿åº¦
    // éå†é“¾è¡¨
    ListNode node = head;
    while (node != null) {
        count++;
        node = node.next;
    }
    
    count = count/2;
    // éå†é“¾è¡¨
    while (node != null) {
        if (count > 0) {
            count--;
        } else {
            break; // æ­¤æ—¶ node ä¸ºä¸­é—´èŠ‚ç‚¹
        }
        node = node.next;
    }
    
    return node;
}
```

## è™šæ‹Ÿç»“ç‚¹
åœ¨é“¾è¡¨çš„æœ€å‰é¢å¢åŠ ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹ï¼ˆä¸å­˜å‚¨æ•°æ®ï¼‰ï¼Œå¯ä»¥ç»Ÿä¸€æ‰€æœ‰èŠ‚ç‚¹çš„å¤„ç†é€»è¾‘ï¼Œè®©ä»£ç æ›´åŠ ç²¾ç®€ï¼š
```
// æ·»åŠ æ„é€ æ–¹æ³•ï¼Œæ·»åŠ è™šæ‹Ÿå¤´ç»“ç‚¹
public LinkedList2() {
    first = new Node<>(null, null);
}

// ä¿®æ”¹add
public void add(int index, E element) {
    rangeCheckForAdd(index);
    Node<E> prev = index == 0 ? first : node(index - 1);
    prev.next = new Node<>(element, prev.next);
    size++;
}

// ä¿®æ”¹remove
public E remove(int index) {
    rangeCheck(index);
    Node<E> prev = index == 0 ? first : node(index - 1);
    Node<E> node = prev.next;
    prev.next = node.next;
    size--;
    return node.element;
}

// ä¿®æ”¹node
private Node<E> node(int index) {
    rangeCheck(index);
    
    Node<E> node = first.next;
    for (int i = 0; i < index; i++) {
        node = node.next;
    }
    return node;
}
```

## å¤æ‚åº¦åˆ†æ
![é“¾è¡¨18](é“¾è¡¨/é“¾è¡¨18.png)

### åŠ¨æ€æ•°ç»„
#### add(E element)
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == size` å¤„æ·»åŠ å…ƒç´ ï¼Œä¸éœ€è¦ç§»åŠ¨ä»»ä½•å…ƒç´ ï¼Œå¤æ‚åº¦ O(1)ï¼›  
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == size` å¤„æ·»åŠ å…ƒç´ æ—¶å®¹é‡ä¸å¤Ÿéœ€è¦æ‰©å®¹ï¼Œæ‰€æœ‰å…ƒç´ éƒ½è¦ç§»åŠ¨åˆ°æ–°æ‰©å®¹çš„æ•°ç»„é‡Œï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 1 + 1 + ... + 1 + n) / n` -> O(2n/2)ï¼Œå¤æ‚åº¦ O(1)ï¼›  
å‡æ‘Šå¤æ‚åº¦ï¼šO(1)ã€‚

å‡æ‘Šå¤æ‚åº¦ï¼šå‡è®¾æœ€å¤§å®¹é‡æ˜¯4ï¼Œæ‰©å®¹ç›¸å½“äºæ¯æ¬¡ add çš„æ“ä½œæ¬¡æ•°æ˜¯ 2ï¼Œä¹Ÿå°±æ˜¯O(1)å¤æ‚åº¦ï¼š
![é“¾è¡¨19](é“¾è¡¨/é“¾è¡¨19.png)
åœ¨ç»è¿‡è¿ç»­çš„å¤šæ¬¡å¤æ‚åº¦æ¯”è¾ƒä½çš„æƒ…å†µåï¼Œå‡ºç°ä¸ªåˆ«å¤æ‚åº¦æ¯”è¾ƒé«˜çš„æƒ…å†µæ—¶ï¼Œé€‚åˆå‡æ‘Šå¤æ‚åº¦ã€‚

#### add(int index, E element)
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == size` å¤„æ·»åŠ å…ƒç´ ï¼Œä¸éœ€è¦ç§»åŠ¨ä»»ä½•å…ƒç´ ï¼Œå¤æ‚åº¦ O(1)ï¼›  
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == 0` å¤„æ·»åŠ å…ƒç´ ï¼Œæ‰€æœ‰å…ƒç´ éƒ½è¦å‘åç§»åŠ¨ä¸€ä½ï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 2 + 3 + ... + n) / n` -> O(n/2)ï¼Œå¤æ‚åº¦ O(n)ã€‚
#### remove
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šåˆ é™¤ `index == size - 1` å¤„çš„å…ƒç´ ï¼Œä¸éœ€è¦ç§»åŠ¨ä»»ä½•å…ƒç´ ï¼Œå¤æ‚åº¦ O(1)ï¼› 
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šåˆ é™¤ `index == 0` å¤„çš„å…ƒç´ ï¼Œæ‰€æœ‰å…ƒç´ éƒ½è¦å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 2 + 3 + ... + n) / n` -> O(n/2)ï¼Œå¤æ‚åº¦ O(n)ã€‚
#### set & get
æ•°ç»„çš„éšæœºè®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼Œ`elements[n]` çš„æ•ˆç‡ä¸ n æ˜¯å¤šå°‘æ— å…³ã€‚
![é“¾è¡¨17](é“¾è¡¨/é“¾è¡¨17.png)

### å•å‘é“¾è¡¨
#### add
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == 0` å¤„æ·»åŠ å…ƒç´ ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶è®© first æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œå¤æ‚åº¦ O(1)ï¼›  
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šåœ¨ `index == size - 1` å¤„æ·»åŠ å…ƒç´ ï¼Œéœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰èƒ½æ‰¾åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è®©æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 2 + 3 + ... + n) / n` -> O(n/2)ï¼Œå¤æ‚åº¦ O(n)ã€‚
#### remove
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šåˆ é™¤ `index == 0` å¤„çš„å…ƒç´ ï¼Œåªéœ€è¦æ‰¾åˆ° firstï¼Œå¹¶è®© first æŒ‡å‘è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¤æ‚åº¦ O(1)ï¼›  
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šåˆ é™¤ `index == size - 1` å¤„çš„å…ƒç´ ï¼Œéœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰èƒ½æ‰¾åˆ°å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œå¹¶è®©å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹æŒ‡å‘ nullï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 2 + 3 + ... + n) / n` -> O(n/2)ï¼Œå¤æ‚åº¦ O(n)ã€‚
#### set & get
æœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼šæŸ¥æ‰¾ `index == 0` å¤„çš„å…ƒç´ ï¼Œä¸éœ€è¦éå†ï¼Œç›´æ¥é€šè¿‡ `first.next` å°±å¯ä»¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¤æ‚åº¦ O(1)ï¼›  
æœ€åæƒ…å†µå¤æ‚åº¦ï¼šæŸ¥æ‰¾ `index == size - 1` å¤„çš„å…ƒç´ ï¼Œéœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰èƒ½æ‰¾åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¤æ‚åº¦ O(n)ï¼›  
å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼šæ‰€æœ‰æƒ…å†µçš„ç§»åŠ¨æ¬¡æ•°ç›¸åŠ å†é™¤ä»¥å…ƒç´ ä¸ªæ•°ï¼š`(1 + 2 + 3 + ... + n) / n` -> O(n/2)ï¼Œå¤æ‚åº¦ O(n)ã€‚

# åŒå‘é“¾è¡¨
![é“¾è¡¨20](é“¾è¡¨/é“¾è¡¨20.png)
åŒå‘é“¾è¡¨çš„ä»£ç å®ç°ï¼Œæ˜¯åœ¨å•å‘é“¾è¡¨çš„ä»£ç åŸºç¡€ä¸Šè¿›è¡Œä»¥ä¸‹ä¿®æ”¹ğŸ‘‡ã€‚

## set&get
åªéœ€è¦ä¿®æ”¹ `node()` æ–¹æ³•å³å¯ï¼š
```
private Node<E> node(int index) {
    rangeCheck(index);
    
    if (index < (size >> 1)) {
        Node<E> node = first;
        for (int i = 0; i < index; i++) {
            node = node.next;
        }
        return node;
    } else {
        Node<E> node = last;
        for (int i = size - 1; i > index; i--) {
            node = node.prev;
        }
        return node;
    }
}
```

## add
```
public void add(int index, E element) {
    rangeCheckForAdd(index);
    
    if (index == size) {
        Node<E> oldLast = last;
        last = new Node<>(oldLast, element, null);
        if (oldLast == null) { // è¿™æ˜¯é“¾è¡¨æ·»åŠ çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
            first = last;
        } else {
            oldLast.next = last;
        }
    } else {
        Node<E> next = node(index);
        Node<E> prev = next.prev;
        Node<E> node = new Node<>(prev, element, next);
        next.prev = node;
        
        if (prev == null) { // index == 0
            first = node;
        } else {
            prev.next = node;
        }
    }
    size++;
}
```
åœ¨ `0 < index < size` å¤„æ·»åŠ å…ƒç´ ï¼š
![é“¾è¡¨22](é“¾è¡¨/é“¾è¡¨22.png)
åœ¨ `index == 0` å¤„æ·»åŠ å…ƒç´ ï¼š
![é“¾è¡¨21](é“¾è¡¨/é“¾è¡¨21.png)
åœ¨ `index == size` å¤„æ·»åŠ å…ƒç´ ï¼Œåˆ†ä¸ºé¦–æ¬¡æ·»åŠ å…ƒç´ å’Œéé¦–æ¬¡æ·»åŠ å…ƒç´ ï¼š  
é¦–æ¬¡æ·»åŠ å…ƒç´ ï¼š
![é“¾è¡¨23](é“¾è¡¨/é“¾è¡¨23.png)
éé¦–æ¬¡æ·»åŠ å…ƒç´ ï¼š
![é“¾è¡¨24](é“¾è¡¨/é“¾è¡¨24.png)

## remove
```
public E remove(int index) {
    rangeCheck(index);
    
    Node<E> node = node(index);
    Node<E> prev = node.prev;
    Node<E> next = node.next;
    
    if (prev == null) { // index == 0
        first = next;
    } else {
        prev.next = next;
    }
    
    if (next == null) { // index == size - 1
        last = prev;
    } else {
        next.prev = prev;
    }
    
    size--;
    return node.element;
}
```
åˆ é™¤ `0 < index < size` å¤„çš„å…ƒç´ ï¼š
![é“¾è¡¨25](é“¾è¡¨/é“¾è¡¨25.png)
åˆ é™¤ `index == 0` å¤„çš„å…ƒç´ ï¼š
![é“¾è¡¨26](é“¾è¡¨/é“¾è¡¨26.png)

## æµ‹è¯•
ä¿®æ”¹ LinkedList çš„ `toString()` æ–¹æ³•ï¼š
```
public String toString() {
    StringBuilder string = new StringBuilder();
    string.append("size=").append(size).append(", [");
    Node<E> node = first;
    for (int i = 0; i < size; i++) {
        if (i != 0) {
            string.append(", ");
        }
        string.append(node);
        
        node = node.next;
    }
    string.append("]");
    return string.toString();
}
```

åœ¨ `class Node<E>` é‡Œé‡å†™ `toString()` æ–¹æ³•ï¼š
```
public String toString() {
    StringBuilder sb = new StringBuilder();
    
    if (prev != null) {
        sb.append(prev.element);
    } else {
        sb.append("null");
    }
    
    sb.append("_").append(element).append("_");

    if (next != null) {
        sb.append(next.element);
    } else {
        sb.append("null");
    }
    
    return sb.toString();
}
```

åœ¨ Main.java é‡Œæ·»åŠ æµ‹è¯•ä»£ç ï¼š
```
public class Main {

    public static void main(String[] args) {
        List<Integer> list = new LinkedList<>();
        list.add(12);
        list.add(0, 11);
        list.add(13);
        list.add(14);
        list.add(15);
        list.add(list.size(), 16);
        
        list.remove(1);
        list.remove(2);
        
        System.out.println(list);
    }
}
```

æ‰“å°ç»“æœï¼š
```
size=4, [null_11_13, 11_13_15, 13_15_16, 15_16_null]
```

## åŒå‘é“¾è¡¨ vs å•å‘é“¾è¡¨
å•å‘é“¾è¡¨ï¼š`1 + 2 + 3 + ... + n = (1 + n) * n/2 = n/2 + (n^2)/2`ï¼Œé™¤ä»¥ n å¹³å‡ä¸€ä¸‹æ˜¯ `1/2 + n/2`ï¼›  
åŒå‘é“¾è¡¨ï¼š`(1 + 2 + 3 + ... + n/2) * 2 = ((1 + n/2) * n/2)/2 * 2 = n/2 + (n^2)/4`ï¼Œé™¤ä»¥ n å¹³å‡ä¸€ä¸‹æ˜¯ `1/2 + n/4`ã€‚

## åŒå‘é“¾è¡¨ vs åŠ¨æ€æ•°ç»„
åŠ¨æ€æ•°ç»„ï¼šå¼€è¾Ÿã€é”€æ¯å†…å­˜ç©ºé—´çš„æ¬¡æ•°ç›¸å¯¹è¾ƒå°‘ï¼Œä½†å¯èƒ½é€ æˆå†…å­˜ç©ºé—´æµªè´¹ï¼ˆå¯ä»¥é€šè¿‡ç¼©å®¹è§£å†³ï¼‰ï¼›   
åŒå‘é“¾è¡¨ï¼šå¼€è¾Ÿã€é”€æ¯å†…å­˜ç©ºé—´çš„æ¬¡æ•°ç›¸å¯¹è¾ƒå¤šï¼Œä½†ä¸ä¼šé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ã€‚

# å•å‘å¾ªç¯é“¾è¡¨
![é“¾è¡¨27](é“¾è¡¨/é“¾è¡¨27.png)
å•å‘å¾ªç¯é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æƒ…å†µï¼š
![é“¾è¡¨33](é“¾è¡¨/é“¾è¡¨33.png)
åœ¨å•å‘é“¾è¡¨çš„ä»£ç åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦ä¿®æ”¹çš„æœ‰ `add()` å’Œ `remove()` æ–¹æ³•ã€‚
## add
å•å‘å¾ªç¯é“¾è¡¨çš„æ·»åŠ ï¼Œä¸»è¦æ˜¯åœ¨ `index == 0` å¤„çš„é€»è¾‘éœ€è¦ä¿®æ”¹ï¼š
1. è®©æœ€åé¢èŠ‚ç‚¹çš„ next æŒ‡å‘æ–°æ·»åŠ çš„èŠ‚ç‚¹ï¼›
2. è®© first æŒ‡å‘æ–°æ·»åŠ çš„èŠ‚ç‚¹ï¼›
```
public void add(int index, E element) {
    rangeCheckForAdd(index);
    
    if (index == 0) {
        Node<E> newFirst = new Node<>(element, first);
        // æ‹¿åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹
        Node<E> last = (size == 0) ? newFirst : node(size - 1);
        last.next = newFirst;
        first = newFirst;
    } else {
        Node<E> prev = node(index - 1);
        prev.next = new Node<>(element, prev.next); 
    }
    size++;
}
```

## remove
å•å‘å¾ªç¯é“¾è¡¨çš„åˆ é™¤ï¼Œä¸»è¦æ˜¯åœ¨ `index == 0` å¤„çš„é€»è¾‘éœ€è¦ä¿®æ”¹ï¼š
1. å¦‚æœé“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥è®© `first = null`ï¼›
2. è®© first æŒ‡å‘ `index == 1` å¤„çš„å…ƒç´ ï¼›
3. è®© last æŒ‡å‘ `index == 1` å¤„çš„å…ƒç´ ï¼ˆ`last.next = first`ï¼‰ï¼›
```
public E remove(int index) {
    rangeCheck(index);
    
    Node<E> node = first;
    if (index == 0) {
        if (size == 1) {
            first = null;
        } else {
            Node<E> last = node(size - 1); // å¿…é¡»åœ¨ first = first.next å‰è·å–
            first = first.next;
            last.next = first;
        }
    } else {
        Node<E> prev = node(index - 1);
        node = prev.next;
        prev.next = node.next;  
    }
    size--;
    return node.element;
}
```

# åŒå‘å¾ªç¯é“¾è¡¨
![é“¾è¡¨28](é“¾è¡¨/é“¾è¡¨28.png)
åœ¨åŒå‘é“¾è¡¨çš„ä»£ç åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦ä¿®æ”¹çš„æœ‰ `add()` å’Œ `remove()` æ–¹æ³•ã€‚
## add
```
public void add(int index, E element) {
    rangeCheckForAdd(index);
    
    if (index == size) { // index == size
        Node<E> oldLast = last;
        last = new Node<>(oldLast, element, first);
        if (oldLast == null) { // è¿™æ˜¯é“¾è¡¨æ·»åŠ çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
            first = last;
            first.prev = first;
            first.next = first;
        } else {
            oldLast.next = last;
            first.prev = last;
        }
    } else {
        Node<E> next = node(index);
        Node<E> prev = next.prev;
        Node<E> node = new Node<>(prev, element, next);
        next.prev = node;
        prev.next = node; // åŒå‘é“¾è¡¨ä¸­ï¼Œprev ä¸€å®šä¸ä¸º null
        
        if (next == first) { // index == 0
            first = node;
        }
    }
    size++;
}
```
![é“¾è¡¨29](é“¾è¡¨/é“¾è¡¨29.png)
åŒå‘å¾ªç¯é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼š
![é“¾è¡¨30](é“¾è¡¨/é“¾è¡¨30.png)

## remove
```
public E remove(int index) {
    rangeCheck(index);
    
    Node<E> node = first;
    if (size == 0) {
        first = null;
        last = null;
    } else {
        node = node(index);
        Node<E> prev = node.prev;
        Node<E> next = node.next;
        prev.next = next;
        next.prev = prev;
        
        if (node == first) { // index == 0
            first = next;
        }
        
        if (node == last) { // index == size - 1
            last = prev;
        }
    }
    size--;
    return node.element;
}
```

## ç»ƒä¹  - çº¦ç‘Ÿå¤«é—®é¢˜
ä»1å¼€å§‹æ•°ï¼Œæ•°åˆ°ä¸‰å°±å»æ‰ï¼š
![é“¾è¡¨31](é“¾è¡¨/é“¾è¡¨31.png)

ä¸ºäº†å‘æŒ¥å¾ªç¯é“¾è¡¨çš„æœ€å¤§å¨åŠ›ï¼Œå¢è®¾1ä¸ªæˆå‘˜å˜é‡ã€3ä¸ªæ–¹æ³•ï¼š
1. `current`ï¼šç”¨äºæŒ‡å‘æŸä¸ªèŠ‚ç‚¹ï¼›
2. `void reset()`ï¼šè®© `current` æŒ‡å‘å¤´ç»“ç‚¹ `first`ï¼›
3. `E next()`ï¼šè®© `current` å¾€åèµ°ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯ `current = current.next`;
4. `E remove()`ï¼šåˆ é™¤ `current` æŒ‡å‘çš„èŠ‚ç‚¹ï¼Œåˆ é™¤æˆåŠŸåè®© `current` æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼›
![é“¾è¡¨32](é“¾è¡¨/é“¾è¡¨32.png)

ç›¸å…³ä»£ç ï¼š
```
public void reset() {
    current = first;
}

public E next() {
    if (current == null) return null;
    
    current = current.next;
    return current.element;
}

public E remove() {
    if (current == null) return null;
    
    E element = remove(current);
    if (size == 0) {
        current = null;
    } else {
        current = current.next;
    }
    
    return element;
}

public E remove(int index) {
    rangeCheck(index);
    return remove(node(index));
}

public E remove(Node<E> node) {
    if (size == 0) {
        first = null;
        last = null;
    } else {
        Node<E> prev = node.prev;
        Node<E> next = node.next;
        prev.next = next;
        next.prev = prev;
        
        if (node == first) { // index == 0
            first = next;
        }
        
        if (node == last) { // index == size - 1
            last = prev;
        }
    }
    size--;
    return node.element;
}
```

æµ‹è¯•ï¼š
```
static void josephus() {
    CircleLinkedList<Integer> list = new CircleLinkedList<>();
    for (int i = 1; i <= 8; i++) {
        list.add(i);
    }
    
    // æŒ‡å‘å¤´ç»“ç‚¹ï¼ˆæŒ‡å‘1ï¼‰
    list.reset();
    
    while (!list.isEmpty()) {
        list.next();
        list.next();
        System.out.println(list.remove());
    }
}
```

æ‰“å°ç»“æœï¼š
```
3
6
1
5
2
8
4
7
```

# é™æ€é“¾è¡¨
å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨ã€å•å‘å¾ªç¯é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨ï¼Œéƒ½æ˜¯ä¾èµ–äºæŒ‡é’ˆå®ç°çš„ã€‚åœ¨æ—©æœŸçš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæœ‰äº›æ˜¯æ²¡æœ‰æŒ‡é’ˆçš„ï¼Œæ¯”å¦‚ BASICã€FORTRAN è¯­è¨€ã€‚å®ƒä»¬é€šè¿‡æ•°ç»„æ¥æ¨¡æ‹Ÿé“¾è¡¨ï¼Œæˆä¸ºé™æ€é“¾è¡¨ã€‚

åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ å­˜æ”¾ä¸¤ä¸ªæ•°æ®ï¼Œä¸€ä¸ªæ˜¯æ•°å€¼ï¼Œä¸€ä¸ªæ˜¯ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯çš„å€¼æ˜¯ 11ï¼Œä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ç´¢å¼•ä¸º 3 çš„å…ƒç´ ï¼ˆ44ï¼‰ï¼š
![é“¾è¡¨34](é“¾è¡¨/é“¾è¡¨34.png)
ç›¸å½“äºä¸‹é¢è¿™ä¸ªé“¾è¡¨ï¼š
![é“¾è¡¨35](é“¾è¡¨/é“¾è¡¨35.png)

* æ€è€ƒï¼šå¦‚æœæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åªèƒ½å­˜æ”¾1ä¸ªæ•°æ®å‘¢ï¼Ÿ  
  ä½¿ç”¨2ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ•°ç»„å­˜æ”¾ç´¢å¼•å…³ç³»ï¼Œå¦ä¸€ä¸ªæ•°ç»„å­˜æ”¾å€¼ã€‚

# åŠ¨æ€æ•°ç»„ä¼˜åŒ–
å®šä¹‰å˜é‡ `int first`ï¼Œæ ‡è®°é¦–å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚è·å– index çš„å…ƒç´ å¯ä»¥é€šè¿‡ `first + index % elements.length` å¯¹åº”å…ƒç´ çš„åæ ‡ã€‚

## remove
### åˆ é™¤é¦–å…ƒç´  
å½“å‰æ•°ç»„ `first == 0`ï¼š
![é“¾è¡¨36](é“¾è¡¨/é“¾è¡¨36.png)
åˆ é™¤é¦–å…ƒç´ ï¼Œè®© `first = 1`ï¼š
![é“¾è¡¨37](é“¾è¡¨/é“¾è¡¨37.png)
åˆ é™¤é¦–å…ƒç´ ï¼Œè®© `first = 2`ï¼š
![é“¾è¡¨38](é“¾è¡¨/é“¾è¡¨38.png)
### åˆ é™¤ä¸­é—´å…ƒç´ 
å½“å‰æ•°ç»„ `first == 0`ï¼š
![é“¾è¡¨43](é“¾è¡¨/é“¾è¡¨43.png)
åˆ é™¤1å¤„çš„å…ƒç´ ï¼Œè®©0å¤„çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä½ï¼Œè¦†ç›–æ‰1å¤„çš„å…ƒç´ ï¼Œå¹¶å°†0å¤„çš„å…ƒç´ æ¸…ç©ºï¼Œæœ€åè®© `first = 1`ï¼š
![é“¾è¡¨44](é“¾è¡¨/é“¾è¡¨44.png)
ä»£ç å®ç°ï¼š
```
public E remove(int index) {
    
	rangeCheck(index);
	
	int oldIndex = (first + index) % elements.length;
	E old = elements[oldIndex];
	
	if (index * 2 >= size) {
		for (int i = index + 1; i < size; i++) {
			int newIndex = (first + i) % elements.length;
			int nextIndex = (first + i - 1) % elements.length;
			elements[nextIndex] = elements[newIndex];
		}
		int last = (first + size - 1) % elements.length;
		elements[last] = null;
	} else {
		for (int i = index; i > 0; i--) {
			int newIndex = (first + i) % elements.length;
			int nextIndex = (first + i - 1) % elements.length;
			elements[newIndex] = elements[nextIndex];
		}
		elements[first] = null;
		first = (first + 1) < elements.length ? first + 1 : 0;
	}
	size--;
	trim();
	return old;
}
```

## add
### åœ¨æœ«å°¾æ·»åŠ 
å½“å‰æ•°ç»„ `first == 2`ï¼š
![é“¾è¡¨38](é“¾è¡¨/é“¾è¡¨38.png)
åœ¨æ•°ç»„æœ«å°¾æ·»åŠ ï¼Œæ­¤æ—¶ä¸éœ€è¦ä¿®æ”¹ firstï¼Œ `first = 2`ï¼š
### åœ¨å¤´éƒ¨æ·»åŠ 
![é“¾è¡¨39](é“¾è¡¨/é“¾è¡¨39.png)
åœ¨æ•°ç»„çš„å¤´éƒ¨æ·»åŠ å…ƒç´ ï¼Œè®© `first = 1`ï¼š
![é“¾è¡¨40](é“¾è¡¨/é“¾è¡¨40.png)
åœ¨æ•°ç»„çš„å¤´éƒ¨æ·»åŠ å…ƒç´ ï¼Œè®© `first = 0`ï¼š
![é“¾è¡¨41](é“¾è¡¨/é“¾è¡¨41.png)
åœ¨æ•°ç»„çš„å¤´éƒ¨æ·»åŠ å…ƒç´ ï¼Œè®© `first = 8`ï¼š
![é“¾è¡¨42](é“¾è¡¨/é“¾è¡¨42.png)
### åœ¨ä¸­é—´æ·»åŠ 
å½“å‰æ•°ç»„ `first == 1`ï¼š
![é“¾è¡¨40](é“¾è¡¨/é“¾è¡¨40.png)
åœ¨ 3 å¤„æ’å…¥99ï¼Œåªéœ€è¦è®©1ã€2å¤„çš„å…ƒç´ å¾€å‰ç§»åŠ¨ä¸€ä½ï¼Œè®© `first = 0`ï¼š
![é“¾è¡¨43](é“¾è¡¨/é“¾è¡¨43.png)
ä»£ä¹°å®ç°ï¼š
```
public void add(int index, E element) {
    
	rangeCheckForAdd(index);
	
	ensureCapacity(size + 1);
	
	if (index * 2 >= size) {
		for (int i = size; i > index; i--) {
			int newIndex = (first + i) % elements.length;
			int nextIndex = (first + i - 1) % elements.length;
			elements[newIndex] = elements[nextIndex];
		}
		index = (first + index) % elements.length;
		elements[index] = element;
	} else {
		first = (first - 1) >= 0 ? first - 1 : elements.length - 1;
		for (int i = 0; i < index; i++) {
			int newIndex = (first + i) % elements.length;
			int nextIndex = (first + i + 1) % elements.length;
			elements[newIndex] = elements[nextIndex];
		}
		index = (first + index) % elements.length;
		elements[index] = element;
	}
	System.out.println(first);
	size++;
}
```
## set&get
é€šè¿‡ `first + index % elements.length` å¯¹åº”å…ƒç´ çš„åæ ‡ï¼Œç„¶åè·å–å…ƒç´ ï¼š
```
public E get(int index) { //O(1)
	rangeCheck(index);
	index = (first + index) % elements.length;
	return elements[index];
}

public E set(int index, E element) { //O(1)
	rangeCheck(index);
	index = (first + index) % elements.length;
	E old = elements[index];
	elements[index] = element;
	return old;
}
```

## æ‰©å®¹
å½“æ•°ç»„è£…æ»¡åï¼Œæ–°åˆ›å»ºä¸€ä¸ªå®¹é‡æ‰©å¤§1.5å€çš„æ•°ç»„ï¼Œå°†åŸæ•°ç»„é‡Œçš„å…ƒç´ ç§»åŠ¨åˆ°æ–°æ•°ç»„é‡Œï¼Œä»0å¼€å§‹å¡«å……ï¼Œ`first = 0`ã€‚
```
private void ensureCapacity(int capacity) {
	int oldCapacity = elements.length;
	if (oldCapacity >= capacity) return;
	// æ–°å®¹é‡ä¸ºå°±å®¹é‡çš„1.5å€
	int newCapacity = oldCapacity + (oldCapacity >> 1); //iOS 1.6, java 1.5, >> è¡¨ç¤ºé™¤ä»¥2
	E[] newElements = (E[]) new Object[newCapacity];
	for (int i = 0; i < size; i++) {
		int index = (first + i) % elements.length;
		newElements[i] = elements[index];
	}
	elements = newElements;
	first = 0;
	
	System.out.println(oldCapacity + "æ‰©å®¹ä¸º" + newCapacity);
}
```

## ç¼©å®¹
å½“æ•°ç»„æ»¡è¶³ç¼©å®¹æ¡ä»¶æ—¶ï¼Œæ–°åˆ›å»ºä¸€ä¸ªå®¹é‡æŒ‰è§„åˆ™ç¼©å°çš„æ•°ç»„ï¼Œå°†åŸæ•°ç»„é‡Œçš„å…ƒç´ ç§»åŠ¨åˆ°æ–°æ•°ç»„é‡Œï¼Œä»0å¼€å§‹å¡«å……ï¼Œ`first = 0`ã€‚
```
private void trim() {
	int oldCapacity = elements.length;
	int newCapacity = oldCapacity >> 1;
	// å‰©ä½™ç©ºé—´å°äºä¸€åŠ || ç©ºé—´å¤§å° <= é»˜è®¤ç©ºé—´
	if (size >= newCapacity || oldCapacity <= DEFAULT_CAPACITY) return;
	
	E[] newElements = (E[]) new Object[newCapacity];
	for (int i = 0; i < size; i++) {
		int newIndex = (first + i) % elements.length;
		newElements[i] = elements[newIndex];
	}
	elements = newElements;
	first = 0;
	
	System.out.println(oldCapacity + "ç¼©å®¹ä¸º" + newCapacity);
}
```

## åæœŸä¼˜åŒ–
```
private int ensureIndex(int index) {
	return (first + index) % elements.length;
}

private void rightMoveFitst() {
	first = (first + 1) < elements.length ? first + 1 : 0;
}

private void leftMoveFitst() {
	first = (first - 1) >= 0 ? first - 1 : elements.length - 1;
}
```
