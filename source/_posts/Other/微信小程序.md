---
title: å¾®ä¿¡å°ç¨‹åº
date: 2021-03-02 17:59:41
tags: Other
---

[å¾®ä¿¡å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
<!-- more -->

# å¼€å‘å·¥å…·
å¾®ä¿¡å¼€å‘è€…å·¥å…·ç›¸å…³å†…å®¹ï¼š[å¾®ä¿¡å®˜æ–¹æ–‡æ¡£-å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)ã€‚  
å°å›¾æ ‡ï¼š[iconfont](https://www.iconfont.cn/)ã€‚  
é«˜æ•ˆçš„è®¾è®¡ç¨¿æ ‡æ³¨ã€æµ‹é‡å·¥å…·ï¼š[é©¬å…‹é³—](http://www.getmarkman.com/)ã€‚  
æ•°æ®ï¼š[èšåˆæ•°æ®](https://www.juhe.cn/)ã€‚  
å°ç¨‹åºä¸ºäº†å‹ç¼©ä½“ç§¯ï¼Œwxss æ–‡ä»¶é‡Œè®¾ç½®å›¾ç‰‡ï¼Œä¸æ”¯æŒæœ¬åœ°èµ„æºå›¾ç‰‡ï¼Œå¯ä»¥æ”¯æŒbase64å’Œç½‘ç»œå›¾ç‰‡ï¼š[base64å›¾ç‰‡åœ¨çº¿è½¬æ¢å·¥å…·](https://tool.chinaz.com/tools/imgtobase)ã€‚  
CSSæ–‡æ¡£ï¼š[w3school](https://www.w3school.com.cn/cssref/index.asp)ã€‚  
è§†é¢‘åŠ å¯†ï¼š[POLYVä¿åˆ©å¨](https://www.polyv.net/)ã€‚  
minappï¼šVSCode å¼€å‘å°ç¨‹åºæ’ä»¶ã€‚  
Beautifyï¼šVSCode ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚  


# å®æˆ˜é¡¹ç›® DouBan
![å¾®ä¿¡å°ç¨‹åº01.png](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº01.png)

[å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/app.html)ï¼Œæ‰“å¼€ app.js æ–‡ä»¶ï¼š
```
App({

  /**
   * å½“å°ç¨‹åºåˆå§‹åŒ–å®Œæˆæ—¶ï¼Œä¼šè§¦å‘ onLaunchï¼ˆå…¨å±€åªè§¦å‘ä¸€æ¬¡ï¼‰
   */
  onLaunch: function () {
    
  },

  /**
   * å½“å°ç¨‹åºå¯åŠ¨ï¼Œæˆ–ä»åå°è¿›å…¥å‰å°æ˜¾ç¤ºï¼Œä¼šè§¦å‘ onShow
   */
  onShow: function (options) {
    
  },

  /**
   * å½“å°ç¨‹åºä»å‰å°è¿›å…¥åå°ï¼Œä¼šè§¦å‘ onHide
   */
  onHide: function () {
    
  },

  /**
   * å½“å°ç¨‹åºå‘ç”Ÿè„šæœ¬é”™è¯¯ï¼Œæˆ–è€… api è°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šè§¦å‘ onError å¹¶å¸¦ä¸Šé”™è¯¯ä¿¡æ¯
   */
  onError: function (msg) {
    
  }
})
```

## è‡ªå®šä¹‰ç»„ä»¶
[ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/lifetimes.html)ï¼Œæ‰“å¼€è‡ªå®šä¹‰ç»„ä»¶çš„ .js æ–‡ä»¶ï¼š
```
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {

  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {

  },

  /**
   * ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åˆ—è¡¨
   */
  lifetimes: {
    // åœ¨ç»„ä»¶å®ä¾‹è¿›å…¥é¡µé¢èŠ‚ç‚¹æ ‘æ—¶æ‰§è¡Œ
    attached: function() {
      
    },

    // åœ¨ç»„ä»¶å®ä¾‹è¢«ä»é¡µé¢èŠ‚ç‚¹æ ‘ç§»é™¤æ—¶æ‰§è¡Œ
    detached: function() {

    },
  },

  /**
   * ç»„ä»¶æ‰€åœ¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ
   */
  pageLifetimes: {
    // é¡µé¢è¢«å±•ç¤º
    show: function() {

    },

    // é¡µé¢è¢«éšè—
    hide: function() {

    },

    // é¡µé¢å°ºå¯¸å˜åŒ–
    resize: function(size) {

    }
  }
})
```

### stars
è‡ªå®šä¹‰ç»„ä»¶ï¼šè¯„åˆ†ï¼ˆstars.wxmlï¼‰ï¼š
![å¾®ä¿¡å°ç¨‹åº02.png](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº02.png)

#### stars.wxml
```
<!--components/stars/stars.wxml-->
<view class='rate-group'>
  <!-- å…¨é»„ -->
  <image style='width:{{starsize}}rpx;height:{{starsize}}rpx;' wx:for="{{lights}}" wx:key="*this"
    src='/images/rate_light.png'></image>
  <!-- åŠé»„åŠç° -->
  <image style='width:{{starsize}}rpx;height:{{starsize}}rpx;' wx:for="{{halfs}}" wx:key="*this"
    src='/images/rate_half.png'></image>
  <!-- å…¨ç° -->
  <image style='width:{{starsize}}rpx;height:{{starsize}}rpx;' wx:for="{{grays}}" wx:key="*this"
    src='/images/rate_gray.png'></image>
  <!-- è¯„åˆ† -->
  <text wx:if="{{istext}}" style='font-size:{{fontsize}}rpx;color:{{fontcolor}};'>{{ratetext}}</text>
</view>
```

åœ¨è¯„åˆ†UIä¸­ï¼Œè®¾ç½®ä¸€ä¸ª view ä½œä¸ºäº”ä¸ªæ˜Ÿæ˜Ÿå’Œè¯„åˆ†çš„å®¹å™¨ï¼š
```
<!--components/stars/stars.wxml-->
<view class='rate-group'>
  <!--å†…å®¹-->
</view>
```

`<view></view>`ï¼šåˆ›å»º view ç»„ä»¶ã€‚  
`class='rate-group'`ï¼šè®¾ç½®ç±»åï¼Œæ–¹ä¾¿åœ¨ stars.wxss æ–‡ä»¶ä¸­è®¾ç½®å¸ƒå±€ã€‚

ä»¥åˆ›å»ºé»„è‰²æ˜Ÿæ˜Ÿçš„çš„ä»£ç ä¸ºä¾‹ï¼š
```
<image style='width:{{starsize}}rpx;height:{{starsize}}rpx;' wx:for="{{lights}}" wx:key="*this" src='/images/rate_light.png'></image>
```

`<image></image>`ï¼šåˆ›å»º image ç»„ä»¶ã€‚  
`style='width:{{starsize}}rpx;height:{{starsize}}rpx;'`ï¼šé€šè¿‡ style è®¾ç½® image çš„å®½é«˜ã€‚  
`wx:for="{{lights}}" wx:key="*this"`ï¼šé€šè¿‡ wx:for wx:key éå†åˆ›å»º imageã€‚  
`src='/images/rate_light.png'`ï¼šæŒ‡å®š image çš„æ–‡ä»¶è·¯å¾„ã€‚

```
<text wx:if="{{istext}}" style='font-size:{{fontsize}}rpx;color:{{fontcolor}};'>{{ratetext}}</text>
```

`<text>{{ratetext}}</text>`ï¼šåˆ›å»º text ç»„ä»¶ã€‚  
`wx:if="{{istext}}"`ï¼šå¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™åˆ›å»º textã€‚  
`style='font-size:{{fontsize}}rpx;color:{{fontcolor}};'>`ï¼šæŒ‡å®šå­—ä½“å¤§å°ã€å­—ä½“é¢œè‰²ã€‚  
`<text>{{ratetext}}</text>`ï¼šè®¾ç½®å±•ç¤ºæ–‡æ¡ˆã€‚  
ç”¨äºåŠ è½½ stars.js æ–‡ä»¶ä¸­çš„å±æ€§å’Œå˜é‡ï¼Œä½¿ç”¨ç¬¦å·ï¼š`{% raw %}{{}}{% endraw %}`

#### stars.wxss
stars ç»„ä»¶çš„å¸ƒå±€ï¼š
```
/* components/stars/stars.wxss */

.rate-group {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20rpx;
  color: #ccc;
}

/* è®¾ç½®å›¾ç‰‡çš„å®½é«˜ */
.rate-group image {
  width: 20rpx;
  height: 20rpx;
}
```

`display: flex;`ï¼šå¸ƒå±€æ–¹å¼é‡‡ç”¨ flex å¸ƒå±€ã€‚  
`justify-content: center;`ï¼šæ¨ªå‘å±…ä¸­å¯¹é½ã€‚  
`align-items: center;`ï¼šå‚ç›´å±…ä¸­å¯¹é½ã€‚  
`font-size: 20rpx;`ï¼šåœ¨ .rate-group å®¹å™¨ä¸­çš„å­—ä½“å¤§å°ã€‚  
`color: #ccc;`ï¼šåœ¨ .rate-group å®¹å™¨ä¸­çš„å­—ä½“é¢œè‰²ã€‚  

#### stars.js
```
// components/stars/stars.js
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    rate: {
      type: Number,
      value: 0,
      observer(newVal, oldVal, changedPath) {
        // å±æ€§è¢«æ”¹å˜æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œä¹Ÿå¯ä»¥å†™æˆåœ¨methodsæ®µä¸­å®šä¹‰çš„æ–¹æ³•åå­—ç¬¦ä¸², å¦‚ï¼š'_propertyChange'
        // é€šå¸¸ newVal å°±æ˜¯æ–°è®¾ç½®çš„æ•°æ®ï¼Œ oldVal æ˜¯æ—§æ•°æ®
        this.updateRate();
      }
    },
    starsize: {
      type: Number,
      value: 20 //rpx
    },
    fontsize: {
      type: Number,
      value: 20 //rpx
    },
    fontcolor: {
      type: String,
      value: "#ccc"
    },
    istext: {
      type: Boolean,
      value: true
    }
  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {
    updateRate: function () {
      // å®šä¹‰å˜é‡
      var that = this;
      var rate = that.properties.rate;
      var intRate = parseInt(rate);
      var light = parseInt(intRate / 2);
      var half = intRate % 2;
      var gray = 5 - light - half;
      var lights = [];
      var halfs = [];
      var grays = [];
      for (var index = 1; index <= light; index++) {
        lights.push(index);
      }
      for (var index = 1; index <= half; index++) {
        halfs.push(index);
      }
      for (var index = 1; index <= gray; index++) {
        grays.push(index);
      }
      var ratetext = rate && rate > 0 ? rate.toFixed(1) : "æœªè¯„åˆ†"
      that.setData({
        lights: lights,
        halfs: halfs,
        grays: grays,
        ratetext: ratetext,
      })
    }
  },

  /**
   * ç»„ä»¶çš„å£°æ˜å‘¨æœŸæ–¹æ³•åˆ—è¡¨
   */
  lifetimes: {
    // åœ¨ç»„ä»¶å®ä¾‹è¿›å…¥é¡µé¢èŠ‚ç‚¹æ ‘æ—¶æ‰§è¡Œ
    attached: function(){
      this.updateRate();
    }
  }
})
```

stars æ–‡ä»¶æ˜¯è‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œ`rateã€starsizeã€fontsizeã€fontcolorã€istext` éƒ½æ˜¯ stars æ–‡ä»¶çš„å±æ€§ï¼Œæ˜¯è®©è°ƒç”¨è€…åœ¨è°ƒç”¨æ—¶è¿›è¡Œè®¾ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚`lightsã€halfsã€graysã€ratetext` éƒ½æ˜¯ stars æ–‡ä»¶çš„å˜é‡ï¼Œç»è¿‡æ•°æ®å¤„ç†åï¼Œç”¨äºUIå±•ç¤ºã€‚

æ›´æ–°UIï¼š
```
that.setData({
  lights: lights,
  halfs: halfs,
  grays: grays,
  ratetext: ratetext,
})
```

### itemview
è‡ªå®šä¹‰ç»„ä»¶ç”µå½±ä¿¡æ¯ï¼ˆitemview.wxmlï¼‰ï¼š
![å¾®ä¿¡å°ç¨‹åº03.png](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº03.png)

#### itemview.wxml
```
<navigator wx:if="{{item}}" class='item-navigator' url="{{itemurl}}">
  <view class='item-group'>
    <!-- å°é¢ -->
    <view class='thumbnail-group'>
      <image class='thumbnail' src='{{item.cover.url}}'></image>
    </view>
    <!-- åç§° -->
    <view class='item-title'>{{item.title}}</view>
    <!-- è¯„åˆ† -->
    <stars rate="{{item.rating.value}}"></stars>
  </view>
</navigator>

<!-- å ä½view -->
<view wx:else class="item-navigator"></view>
```

navigator ç»„ä»¶æ˜¯ä¸€ä¸ªè´Ÿè´£é¡µé¢è·³è½¬çš„ç³»ç»Ÿç»„ä»¶ï¼Œå…·æœ‰å“åº”ç‚¹å‡»äº‹ä»¶å’Œé¡µé¢è·³è½¬åŠŸèƒ½ã€‚
```
<navigator url="{{itemurl}}">
  <!--å†…å®¹-->
</navigator>
```

`class='item-navigator'`ï¼šè®¾ç½®ç±»åï¼Œä¾¿äºå¸ƒå±€ã€‚  
`url="{{itemurl}}"`ï¼šéœ€è¦è·³è½¬çš„é¡µé¢è·¯å¾„ã€‚å› ä¸ºæ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ‰€ä»¥è·³è½¬è·¯å¾„ç”±å¤–éƒ¨è°ƒç”¨è€…ä¼ å…¥ã€‚  
`wx:if="{{item}}" wx:else`ï¼šæ¡ä»¶æˆç«‹åˆ™åˆ›å»º navigator ç»„ä»¶ï¼Œå¦åˆ™åˆ›å»ºç©ºç™½ viewã€‚  

stars å°±æ˜¯ä¸Šé¢ğŸ‘†ä»‹ç»çš„è‡ªå®šä¹‰ç»„ä»¶-è¯„åˆ†ã€‚è®¾ç½® rateï¼Œå…¶å®ƒå±æ€§ä½¿ç”¨é»˜è®¤å€¼ã€‚
```
<stars rate="{{item.rating.value}}"></stars>
```

#### itemview.json
ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶çš„å‰ææ˜¯åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼ˆ`usingComponents`ï¼‰ï¼Œå¦‚åœ¨ itemview.json æ–‡ä»¶å¯¼å…¥ `stars` ç»„ä»¶çš„æ–‡ä»¶è·¯å¾„ï¼š
```
{
  "component": true,
  "usingComponents": {
    "stars": "/components/stars/stars"
  }
}
```

#### itemview.wxss
`itemview` ç»„ä»¶çš„å¸ƒå±€ï¼š
```
.item-navigator {
  width: 200rpx;
  margin-right: 20rpx;
  display: inline-block;
}

.item-navigator .item-group {
  width: 100%;
}

.item-group .thumbnail-group {
  width: 100%;
  height: 284rpx;
}

.thumbnail-group .thumbnail {
  width: 100%;
  height: 100%;
}

.item-group .item-title {
  font-size: 32rpx;
  text-align: center;
  margin-top: 20rpx;
  text-overflow: ellipsis;
  overflow: hidden;
  margin-bottom: 20rpx;
}
```

`margin-right: 20rpx;`ï¼šæ˜¯æŒ‡å®¹å™¨æœ¬èº«å³è¾¹è·ç¦»å…¶ä»–å®¹å™¨æœ‰20åƒç´ ï¼Œä¸åŒ…å«åœ¨å®¹å™¨å†…ï¼›  
`display: inline-block;`ï¼šå‚ç›´æ’åˆ—ã€‚  
`width: 100%;`ï¼šå®½åº¦è·Ÿçˆ¶viewä¿æŒä¸€è‡´ã€‚  
`text-align: center;`ï¼šå­—ä½“å±…ä¸­æ˜¾ç¤ºã€‚  
`text-overflow: ellipsis;`ï¼šå­—ä½“é•¿åº¦è¶…è¿‡ç»„ä»¶æ—¶æ˜¾ç¤ºä¸ºâ€œ...â€ã€‚  
`overflow: hidden;`ï¼šè¶…å‡ºç»„ä»¶çš„viewï¼Œéšè—ã€‚  
`margin-bottom: 20rpx;`ï¼šè®¾ç½®åº•éƒ¨è¾¹è·ã€‚  

#### itemview.js
```
// components/itemview/itemview.js
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    item: {
      type: Object,
      value: {}
    },
    itemurl: {
      type: String,
      value: ""
    }
  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {

  }
})
```

`itemview` ç»„ä»¶çš„å±æ€§æœ‰ `itemã€itemurl`ï¼Œå…¶ä¸­ item æ˜¯å¤–éƒ¨è°ƒç”¨è€…åˆ›å»ºå¥½äº†çš„æ•°æ®å®¹å™¨å¯¹è±¡ã€‚itemurl æ˜¯å¤–éƒ¨è°ƒç”¨è€…è®¾ç½®çš„è·³è½¬è·¯å¾„ã€‚

### indexmodule
![å¾®ä¿¡å°ç¨‹åº04.png](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº04.png)

#### indexmodule.wxml
```
<!--components/indexmodule/indexmodule.wxml-->
<view class='module-group'>
  <!-- æ ‡é¢˜ã€æ›´å¤š -->
  <view class='module-top'>
    <view class='module-title'>{{title}}</view>
    <navigator url="{{moreurl}}" class='module-more'>æ›´å¤š</navigator>
  </view>
  <!-- ç”µå½±å±•ç¤º -->
  <scroll-view class='module-scroll-view' scroll-x="{{true}}">
    <itemview wx:for="{{items}}" wx:key="{{item.title}}" item="{{item}}"
      itemurl="/pages/detail/detail?type={{type}}&id={{item.id}}"></itemview>
  </scroll-view>
</view>
```

åˆ›å»º scroll-viewï¼š
```
<scroll-view class='module-scroll-view' scroll-x="{{true}}">
  <!--å†…å®¹-->
</scroll-view>
```

`scroll-x="{{true}}"`ï¼šè®¾ç½®æ»šåŠ¨æ–¹å‘ï¼Œxè½´æ–¹å‘ã€‚  

ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼š
```
<itemview wx:for="{{items}}" wx:key="{{item.title}}" item="{{item}}"
      itemurl="/pages/detail/detail?type={{type}}&id={{item.id}}"></itemview>
```

`item="{{item}}"`ï¼šè®¾ç½®æ•°æ® itemã€‚  
`itemurl="/pages/detail/detail?type={{type}}&id={{item.id}}"`ï¼šè®¾ç½®è·³è½¬é¡µé¢çš„è·¯å¾„ã€‚è·¯å¾„ä¸­çš„ `?type={{type}}&id={{item.id}}"` æ˜¯é¡µé¢é—´è·³è½¬æ—¶çš„æ•°æ®ä¼ é€’ã€‚  

#### indexmodule.wxss
indexmodule ç»„ä»¶çš„å¸ƒå±€ï¼š
```
.module-group {
  padding: 40rpx;
  background-color: #fff;
}

.module-group .module-top {
  font-size: 36rpx;
  display: flex;
  justify-content: space-between;
}

.module-group .module-title {
  color: #494949;
}

.module-group .module-more {
  color: #41be57;
}

.module-scroll-view {
  margin-top: 40rpx;
  width: 100%;
  height: 400rpx;
  white-space: nowrap;
}
```

`padding: 40rpx;`ï¼šè®¾ç½®ä¸Šä¸‹ã€å·¦å³è¾¹è·ã€‚  
`background-color: #fff;`ï¼šè®¾ç½®èƒŒæ™¯è‰²ã€‚  
`justify-content: space-between;`ï¼šé¡¹ç›®æ²¿ä¸»è½´å‡åŒ€åˆ†å¸ƒï¼Œä½äºé¦–å°¾ä¸¤ç«¯çš„å­å®¹å™¨ä¸çˆ¶å®¹å™¨ç´§ç´§æŒ¨ç€ã€‚  
`white-space: nowrap;`ï¼šè®¾ç½® scroll-view ä¸æ¢è¡Œã€‚ 
`margin-top: 40rpx;` æ˜¯æŒ‡å®¹å™¨æœ¬èº«çš„é¡¶éƒ¨è·ç¦»å…¶ä»–å®¹å™¨æœ‰40ä¸ªåƒç´ ï¼Œä¸åŒ…å«åœ¨å®¹å™¨å†…ï¼›

#### indexmodule.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "component": true,
  "usingComponents": {
    "itemview": "/components/itemview/itemview"
  }
}
```

#### indexmodule.js
ä¸ºå¤–éƒ¨è°ƒç”¨è€…æä¾›äº†å››ä¸ªå±æ€§ï¼š`titleã€moreurlã€itemsã€type`ï¼š
```
// components/indexmodule/indexmodule.js
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    title: {
      type: String,
      value: ""
    },
    moreurl: {
      type: String,
      value: ""
    },
    items: {
      type: Array,
      value: []
    },
    type: {
      type: String,
      value: ""
    }
  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {

  }
})
```

### comment
![å¾®ä¿¡å°ç¨‹åº05](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº05.png)

#### comment.wxml
ä¸ºäº†æ–¹ä¾¿å¸ƒå±€ï¼ŒåµŒå¥—äº†å¤šå±‚viewï¼š
```
<view class="comment-group">
  <view class="left-comment">
    <image class="avatar" src="{{item.user.avatar}}"></image>
  </view>
  <view class="right-comment">
    <view class="username-rate">
      <text class="username">{{item.user.name}}</text>
      <stars rate="{{item.rating.value*2}}" starsize="30" istext="{{false}}"></stars>
    </view>
    <view class="release-time">{{item.create_time}}</view>
    <view class="content">{{item.comment}}</view>
  </view>
</view>
```

ä½¿ç”¨ç½‘ç»œå›¾ç‰‡åˆ›å»º imageï¼š
```
<image class="avatar" src="{{item.user.avatar}}"></image>
```

ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ starsï¼Œè‡ªå®šä¹‰äº†æ˜Ÿæ˜Ÿçš„å¤§å°ï¼ˆstarsizeï¼‰ï¼Œä¸éœ€è¦æ˜¾ç¤ºè¯„åˆ†ï¼ˆistext = falseï¼‰ï¼š
```
<stars rate="{{item.rating.value*2}}" starsize="30" istext="{{false}}"></stars>
```

#### comment.wxss
```
.comment-group {
  display: flex;
  justify-content: flex-start;
  padding-top: 40rpx;
}

.comment-group .left-comment {
  width: 70rpx;
  margin-right: 20rpx;
}

.left-comment .avatar {
  width: 70rpx;
  height: 70rpx;
  border-radius: 50%;
}

.comment-group .right-comment {
  flex: 1;
}

.right-comment .username-rate {
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.username-rate .username {
  font-size: 36rpx;
  margin-right: 20rpx;
}

.release-time {
  color: #b3b3b3;
  font-size: 32rpx;
  margin-top: 10rpx;
}

.content {
  font-size: 32rpx;
  color: #353535;
  margin-top: 10rpx;
}
```

`justify-content: flex-start;` èµ·å§‹ç«¯å¯¹é½ã€‚é»˜è®¤å°±æ˜¯è¿™ç§å¯¹é½æ–¹å¼ã€‚  
`padding-top: 40rpx;` æ˜¯æŒ‡å®¹å™¨å†…çš„å†…å®¹è·ç¦»å®¹å™¨çš„é¡¶éƒ¨æœ‰40ä¸ªåƒç´ ï¼Œæ˜¯åŒ…å«åœ¨å®¹å™¨å†…çš„ï¼›  
`border-radius: 50%;` è®¾ç½®åœ†è§’ï¼Œåœ†è§’å¤§å°ç­‰äºå®½åº¦çš„ä¸€åŠã€‚  

#### comment.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "component": true,
  "usingComponents": {
    "stars": "/components/stars/stars"
  }
}
```

#### comment.js
åªéœ€è¦ä¸€ä¸ªå‚æ•° item å¯¹è±¡ï¼š
```
// components/comment/comment.js
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    item: {
      type: Object,
      value: {}
    }
  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {

  }
})
```

### searchbar
![å¾®ä¿¡å°ç¨‹åº06](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº06.png)

#### searchbar.wxml
```
<!--components/searchbar/searchbar.wxml-->
<view class='searchbar'>
  <navigator wx:if="{{isnavigator}}" url='/pages/search/search' class='searh-navigator'></navigator>
  <view wx:else class='search-input-group'>
    <input class='search-input' placeholder='æœç´¢' bindinput="onInputEvent"></input>
  </view>
</view>
```

å¦‚æœ isnavigator = trueï¼Œåˆ›å»ºå¯¼èˆªç»„ä»¶ï¼Œåœ¨ç‚¹å‡»æœç´¢æ¡†æ—¶ï¼Œè·³è½¬åˆ° search é¡µé¢ï¼š
```
<navigator wx:if="{{isnavigator}}" url='/pages/search/search' class='searh-navigator'></navigator>
```

å¦‚æœ isnavigator = falseï¼Œåˆ›å»ºè¾“å…¥æ¡†ï¼š
```
<input class='search-input' placeholder='æœç´¢' bindinput="onInputEvent"></input>
```

#### searchbar.wxss
```
/* components/searchbar/searchbar.wxss */

.searchbar {
  background-color: #41be57;
  padding: 20rpx; 
}

.searh-navigator {
  width: 100%;
  height: 60rpx;
  background-color: #fff;
  border-radius: 10rpx;
  background-image: url("data:image/png;base64,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");
  background-position: center center;
  background-repeat: no-repeat;
  background-size: 6%;
}

.search-input-group {
  width: 100%;
  height: 60rpx;
  background-color: #fff;
  border-radius: 10rpx;
  padding: 10rpx 20rpx;
  box-sizing: border-box;
}

.search-input {
  min-height: 40rpx;
  height: 40rpx;
  font-size: 12px;
}
```

`border-radius: 10rpx;`ï¼šè®¾ç½®åœ†è§’å¤§å° 10rpxã€‚  
`background-image: url("")`ï¼šè®¾ç½®èƒŒæ™¯å›¾ã€‚å› ä¸º wxss æ–‡ä»¶é‡Œä½¿ç”¨çš„æ˜¯æœ¬åœ°å›¾ç‰‡èµ„æºï¼Œæ‰€ä»¥éœ€è¦å°†å›¾ç‰‡è½¬æˆbase64ã€‚  
`background-position: center center;`ï¼šè®¾ç½®å›¾ç‰‡å‚ç›´æ°´å¹³å±…ä¸­ã€‚  
`box-sizing: border-box;`ï¼šè®¾ç½®çš„è¾¹æ¡†å’Œå†…è¾¹è·çš„å€¼æ˜¯åŒ…å«åœ¨ width å†…çš„ã€‚
`min-height: 40rpx; height: 40rpx;`ï¼šåŒæ—¶è®¾ç½®æœ€å°é«˜åº¦å’Œé«˜åº¦ï¼Œé˜²æ­¢å…‰æ ‡åç§»ã€‚  
`background-repeat: no-repeat;`ï¼šèƒŒæ™¯å›¾åƒå°†ä»…æ˜¾ç¤ºä¸€æ¬¡ã€‚

#### search.js
```
// components/searchbar/searchbar.js
Component({
  /**
   * ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    isnavigator: {
      type: Boolean,
      value: false
    }
  },

  /**
   * ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {
    // è¾“å…¥æ¡†è¾“å…¥å›è°ƒ
    onInputEvent: function(event) {
      var value = event.detail.value;
      var detail = {"value": value};
      var options = {};
      // å›è°ƒæ–¹æ³•
      this.triggerEvent("searchinput",detail,options);
    }
  }
})
```

`isnavigator` ç”¨äºåˆ¤æ–­æ˜¯å¦åˆ›å»ºå¯¼èˆªæ§ä»¶ã€‚  
`onInputEvent` æ˜¯è¾“å…¥æ¡†æ­£åœ¨è¾“å…¥çš„å›è°ƒäº‹ä»¶ã€‚  
`this.triggerEvent("searchinput",detail,options);` ä¸»åŠ¨è§¦å‘äº‹ä»¶ triggerEventï¼Œå‚æ•°ä¸º `"searchinput"`ã€`detail`ã€`options`ã€‚å› ä¸ºè¿™é‡Œçš„ `searchbar` æ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°†è¾“å…¥äº‹ä»¶ä¼ é€’ç»™å¤–éƒ¨è°ƒç”¨è€…ï¼Œå¤–éƒ¨è°ƒç”¨è€…éœ€è¦å®ç° triggerEvent äº‹ä»¶ï¼š  
search.json æ–‡ä»¶ï¼š
```
{
  "usingComponents": {
    "searchbar": "/components/searchbar/searchbar"
  }
}
```

search.wxml æ–‡ä»¶ï¼š
```
<!-- æœç´¢æ¡† -->
<searchbar bindsearchinput="onSearchInputEvent"></searchbar>
```

search.js æ–‡ä»¶ï¼š
```
onItemTapEvent: function(event) {
  var that = this;
  var id = event.currentTarget.dataset.id;
  var title = event.currentTarget.dataset.title;

  // to do
},
```

## ç½‘ç»œ

[ç½‘ç»œè¯·æ±‚API](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html)

### urls.js
![å¾®ä¿¡å°ç¨‹åº11](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº11.png)

å®šä¹‰æ„é€ å™¨ globalUrlsï¼š
```
const globalUrls = {
    // å†…å®¹
}
```

å®šä¹‰ url å˜é‡ï¼š
```
// åˆ—è¡¨
movieList: "https://m.douban.com/rexxar/api/v2/subject_collection/movie_showing/items",
tvList: "https://m.douban.com/rexxar/api/v2/subject_collection/tv_hot/items",
showList: "https://m.douban.com/rexxar/api/v2/subject_collection/tv_variety_show/items",
// è¯¦æƒ…
movieDetail: "https://m.douban.com/rexxar/api/v2/movie/",
tvDetail: "https://m.douban.com/rexxar/api/v2/tv/",
showDetail: "https://m.douban.com/rexxar/api/v2/tv/",
```

åˆ›å»ºæ–¹æ³•ï¼Œæ ¹æ®å‚æ•°æ‹¼æ¥ urlï¼š
```
// æ ‡ç­¾
movieTags: function(id){
  return "https://m.douban.com/rexxar/api/v2/movie/" + id + "/tags?count=8"
},
tvTags: function(id){
  return "https://m.douban.com/rexxar/api/v2/tv/" + id + "/tags?count=8"
},
showTags: function(id){
  return this.tvTags(id);
},
// è¯„è®º
movieComments: function(id,start=0,count=3){
  return "https://m.douban.com/rexxar/api/v2/movie/" + id + "/interests?count=" + count + "&start=" + start;
},
tvComments: function(id,start=0,count=3){
  return "https://m.douban.com/rexxar/api/v2/tv/" + id + "/interests?count=" + count + "&start=" + start;
},
showComments: function(id,start=0,count=3){
  return this.tvComments(id,start,count);
},
// æœç´¢
searchUrl: function(q) {
  return "https://m.douban.com/rexxar/api/v2/search?type=movie&q=" + q
}
```

å¯¼å‡ºæ„é€ å™¨ globalUrlsï¼Œå¯¼å‡ºåå¤–éƒ¨è°ƒç”¨è€…é€šè¿‡ `import { globalUrls } from "urls.js"` å¯¼å…¥åå¯ç”¨ï¼š
```
export {globalUrls}
```

### network
```
// å¯¼å…¥ globalUrls ç±»
import { globalUrls } from "urls.js"


// å®šä¹‰æ„é€ å™¨ network
const network = {
  // ç”µå½±
  getMovieList: function (params) {
    params.type = "movie";
    this.getItemList(params);
  },

  // ç”µè§†å‰§
  getTVList: function (params) {
    params.type = "tv";
    this.getItemList(params);
  },

  // ç»¼è‰º
  getShowList: function (params) {
    params.type = "show";
    this.getItemList(params);
  },

  // é¦–é¡µåˆ—è¡¨
  getItemList: function (params) {
    var url = "";
    if (params.type == "movie") {
      url = globalUrls.movieList;
    } else if (params.type == "tv") {
      url = globalUrls.tvList;
    } else if (params.type == "show") {
      url = globalUrls.showList;
    } else { 
    
    }
    var count = params.count ? params.count : 7;
    // å‘èµ·ç½‘ç»œè¯·æ±‚
    wx.request({
      // è®¾ç½®è¯·æ±‚url
      url: url,
      // è®¾ç½®è¯·æ±‚å‚æ•°
      data: {
        count: count
      },
      // è¯·æ±‚æˆåŠŸå›è°ƒ
      success: function(res) {
        var items = res.data.subject_collection_items;
        var itemCount = items.length;
        var left = itemCount%3;
        if (left === 2) {
          items.push(null);
        }
        if (params && params.success) {
          params.success(items);
        }
      }
    })
  },
  
  // è¯¦æƒ…
  getItemDetail: function(params) {
    var type = params.type;
    var id = params.id;
    var url = "";
    if (type === "movie") {
      url = globalUrls.movieDetail + id;
    } else if (type === "tv") {
      url = globalUrls.tvDetail + id;
    } else if (type === "show") {
      url = globalUrls.showDetail + id;
    } else {

    }
    wx.request({
      url: url,
      success: function(res) {
        var item = res.data;
        if (params.success) {
          params.success(item);
        }
      }
    })
  },
  
  // æ ‡ç­¾
  getItemTags: function(params) {
    var type = params.type;
    var id = params.id;
    var url = "";
    if (type === "movie") {
      url = globalUrls.movieTags(id);
    } else if (type === "tv") {
      url = globalUrls.tvTags(id);
    } else if (type === "show") {
      url = globalUrls.showTags(id);
    } else {

    }
    wx.request({
      url: url,
      success: function(res) {
        var tags = res.data.tags;
        if (params.success) {
          params.success(tags)
        }
      }
    })
  },

  // è¯„è®º
  getItemComments: function(params) {
    var type = params.type;
    var id = params.id;
    var start = params.start;
    var count = params.count;
    var url = "";
    if (type === "movie") {
      url = globalUrls.movieComments(id,start,count);
    } else if (type === "tv") {
      url = globalUrls.tvComments(id,start,count);
    } else if (type === "show") {
      url = globalUrls.showComments(id,start,count);
    } else {

    }
    wx.request({
      url: url,
      success: function(res){
        var comment = res.data;
        if (params.success) {
          params.success(comment); 
        }
      }
    })
  },

  // æœç´¢
  getSearch: function(params) {
    var q = params.q;
    var url = globalUrls.searchUrl(q);
    wx.request({
      url: url,
      success: function(res){
        var subjects = res.data.subjects;
        if (params.success) {
          params.success(subjects);
        }
      }
    })
  }
}

// å¯¼å‡ºæ„é€ å™¨ networkï¼Œå¯¼å‡ºåå¤–éƒ¨è°ƒç”¨è€…é€šè¿‡ `import {network} from "../../utils/network.js"` å¯¼å…¥åå¯ç”¨ï¼š
export { network }
```

## é¡µé¢
[é¡µé¢ç”Ÿå‘½å‘¨æœŸ](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page-life-cycle.html)

ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨ .js æ–‡ä»¶ï¼š[æ³¨å†Œé¡µé¢](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page.html)ï¼š
```
Page({
  
  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åˆæ¬¡æ¸²æŸ“å®Œæˆ
   */
  onReady: function () {
    
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢æ˜¾ç¤º
   */
  onShow: function () {
    
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢éšè—
   */
  onHide: function () {
    
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢å¸è½½
   */
  onUnload: function () {
    
  },

  /**
   * é¡µé¢ç›¸å…³äº‹ä»¶å¤„ç†å‡½æ•°--ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åŠ¨ä½œ
   */
  onPullDownRefresh: function () {
    
  },

  /**
   * é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶çš„å¤„ç†å‡½æ•°
   */
  onReachBottom: function () {
    
  },

  /**
   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
   */
  onShareAppMessage: function () {
    
  }
})
```

### é¦–é¡µ
![å¾®ä¿¡å°ç¨‹åº07](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº07.png)

#### index.wxml
```
<!--index.wxml-->
<searchbar isnavigator="{{true}}"></searchbar>

<!-- ç”µå½± -->
<indexmodule title="ç”µå½±" moreurl="/pages/list/list?type=movie" items="{{movies}}" type="movie"></indexmodule>

<!-- ç”µè§†å‰§ -->
<indexmodule title="ç”µè§†å‰§" moreurl="/pages/list/list?type=tv" items="{{tvs}}" type="tv"></indexmodule>

<!-- ç»¼è‰º -->
<indexmodule title="ç»¼è‰º" moreurl="/pages/list/list?type=show" items="{{shows}}" type="show"></indexmodule>
```

åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ `searchbar`ï¼Œ æŒ‡å®šå¯¼èˆª isnavigator = trueã€‚
```
<searchbar isnavigator="{{true}}"></searchbar>
```

åˆ›å»ºä¸‰ä¸ªè‡ªå®šä¹‰ç»„ä»¶ `indexmodule`ï¼Œåˆ†åˆ«ç”¨äºå±•ç¤ºç”µå½±ã€ç”µè§†å‰§å’Œç»¼è‰ºã€‚`moreurl` æ˜¯æ›´å¤šæŒ‰é’®è·³è½¬çš„é¡µé¢è·¯å¾„ï¼Œ`items` æ˜¯æ¯ä¸€ä¸ªç”µå½±çš„ä¿¡æ¯ã€‚
```
<indexmodule title="ç”µå½±" moreurl="/pages/list/list?type=movie" items="{{movies}}" type="movie"></indexmodule>
```

#### index.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "usingComponents": {
    "searchbar": "/components/searchbar/searchbar",
    "indexmodule": "/components/indexmodule/indexmodule"
  }
}
```

#### index.js
```
//index.js
import {network} from "../../utils/network.js"
Page({
  
  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    var that = this;
    
    // ç”µå½±
    network.getMovieList({
      success: function(movies){
        that.setData({
          movies: movies,
        })
      }
    })
   
    // ç”µè§†å‰§
    network.getTVList({
      success: function(tvs) {
        that.setData({
          tvs: tvs,
        })
      }
    })
    
    // ç»¼è‰º
    network.getShowList({
      success: function (shows){
        that.setData({
          shows: shows,
        })
      }
    })
  }
})
```

å¯¼å…¥ network.js æ–‡ä»¶åæ‰å¯ä»¥ä½¿ç”¨ `network`ï¼š
```
import {network} from "../../utils/network.js"
```

è¯·æ±‚æ•°æ®ï¼Œ`network.getMovieList({ })` æ–¹æ³•å†…éƒ¨çš„ `{}` æ˜¯æ–¹æ³• `getMovieList: function (params){ }` éœ€è¦çš„ `params`ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ `params` å†…éƒ¨åªæœ‰ä¸€ä¸ª `success: function(movies){ }` æ–¹æ³•ã€‚åœ¨ç½‘ç»œè¯·æ±‚å®Œæˆæ—¶ï¼Œ`network` åœ¨ `getMovieList()` æ–¹æ³•å†…éƒ¨å¯ä»¥é€šè¿‡ `params.success(moives)` å›è°ƒè¿‡æ¥ï¼š
```
// ç”µå½±
network.getMovieList({
  success: function(movies){
    that.setData({
      movies: movies,
    })
  }
})
```

æ›´æ–°æ•°æ®ï¼Œå¹¶ä¸”é‡æ–°æ¸²æŸ“UIï¼š
```
that.setData({
  movies: movies,
})
```

### æ›´å¤š
![å¾®ä¿¡å°ç¨‹åº07](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº07.png)

#### list.wxml
```
<searchbar isnavigator="{{true}}"></searchbar>

<view class="container">
  <itemview wx:for="{{items}}" wx:key="{{item.title}}" item="{{item}}"
    itemurl="/pages/detail/detail?type={{type}}&id={{item.id}}"></itemview>
</view>
```

åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ `searchbar`ï¼Œ æŒ‡å®šå¯¼èˆª isnavigator = trueã€‚
```
<searchbar isnavigator="{{true}}"></searchbar>
```

éå†åˆ›å»º itemview ç»„ä»¶ï¼Œå±•ç¤ºæ¯ä¸€ä¸ª item æ•°æ®ã€‚
```
<itemview wx:for="{{items}}" wx:key="{{item.title}}" item="{{item}}"
    itemurl="/pages/detail/detail?type={{type}}&id={{item.id}}"></itemview>
```

#### list.wxml
```
.container {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  padding: 30rpx
}
```

`justify-content: space-between;` é¡¹ç›®æ²¿ä¸»è½´å‡åŒ€åˆ†å¸ƒï¼Œä½äºé¦–å°¾ä¸¤ç«¯çš„å­å®¹å™¨ä¸çˆ¶å®¹å™¨ç´§ç´§æŒ¨ç€ã€‚  
`flex-wrap: wrap;` æ¢è¡Œã€‚  
`padding: 30rpx` è¾¹è·30ä¸ªåƒç´ ã€‚  

#### list.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "usingComponents": {
    "searchbar": "/components/searchbar/searchbar",
    "itemview": "/components/itemview/itemview"
  }
}
```

#### list.js
```
// pages/list/list.js
import { network } from "../../utils/network.js"

Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    type: {
      type: String,
      value: ""
    }
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    var that = this;

    // æç¤ºæ¡†
    wx.showLoading({
      title: 'æ­£åœ¨åŠ è½½ä¸­...',
    })
    var title = "";
    var type = options.type;
    if (type === "movie") {
      // ç”µå½±
      title = "ç”µå½±";
      network.getMovieList({
        success: function(movies){
          that.setData({
            items: movies,
            type: type
          });
          // ç§»é™¤æç¤ºæ¡†
          wx.hideLoading();
        },
        count: 1000
      })
    } else if (type === "tv") {
      //ç”µè§†å‰§
      title = "ç”µè§†å‰§";
      network.getTVList({
        success: function(tvs) {
          that.setData({
            items: tvs,
            type: type
          });
          // ç§»é™¤æç¤ºæ¡†
          wx.hideLoading();
        },
        count: 1000
      })
    } else {
      // ç»¼è‰º
      title = "ç»¼è‰º";
      network.getShowList({
        success: function(shows) {
          that.setData({
            items: shows,
            type: type
          });
          // ç§»é™¤æç¤ºæ¡†
          wx.hideLoading();
        },
        count: 1000
      })
    }

    // è®¾ç½®å¯¼èˆªæ çš„æ ‡é¢˜
    wx.setNavigationBarTitle({
      title: title,
    })
  }
})
```

å¯¼å…¥ç½‘ç»œè¯·æ±‚æ–‡ä»¶ network.jsï¼š
```
import { network } from "../../utils/network.js"
```

å®šä¹‰å˜é‡ typeï¼š
```
data: {
  type: {
    type: String,
    value: ""
  }
},
```

æ˜¾ç¤ºæç¤ºæ¡†ï¼š
```
wx.showLoading({
  title: 'æ­£åœ¨åŠ è½½ä¸­...',
})
```

ç§»é™¤æç¤ºæ¡†ï¼š
```
wx.hideLoading();
```

è®¾ç½®å¯¼èˆªæ çš„æ ‡é¢˜ï¼š
```
wx.setNavigationBarTitle({
  title: title,
})
```

### ç”µå½±è¯¦æƒ…
![å¾®ä¿¡å°ç¨‹åº09](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº09.png)

#### detail.wxml
```
<view class="item-header">
  <view class="item-title">{{item.title}} {{item.original_title}}ï¼ˆ{{item.year}}ï¼‰</view>
  <view class="item-detail">
    <view class="left-detail">
      <!-- è¯„åˆ† -->
      <view class="item-rate">
        <stars rate="{{item.rating.value}}" starsize="30" fontsize="30" fontcolor="#595959"></stars>
        <text class="comment-persons">{{item.rating.count}}äººè¯„ä»·</text>
      </view>
      <!-- ä¿¡æ¯ -->
      <view class="item-sub-detail">
        <view class="item-type">
          {{item.durations[0]}} {{item.genres}}
        </view>
        <view class="item-show">
          {{item.pubdate[0]}}ä¸Šæ˜  {{item.countries[0]}}
        </view>
        <view class="actors">
          {{item.authors}}
        </view>
      </view>
    </view>
    <!-- å°é¢ -->
    <view class="right-detail">
      <image src="{{item.cover.image.small.url}}"></image>
    </view>
  </view>
</view>

<!-- æ ‡ç­¾ -->
<view class="item-tags">
  <view class="item-tags-title">è±†ç“£æˆå‘˜å¸¸ç”¨æ ‡ç­¾</view>
  <view class="item-tags-list">
    <text wx:for="{{tags}}" wx:key="*this">{{item}}</text>
  </view>
</view>

<!-- è¯„è®º -->
<view class="comment-list-group">
  <view class="comment-title">çŸ­è¯„({{comment.total}})</view>
  <comment wx:for="{{comment.interests}}" wx:key="{{item.id}}" item="{{item}}"></comment>
</view>

<!-- æŸ¥çœ‹æ›´å¤šçŸ­è¯„ -->
<navigator class="more-comment"
  url="/pages/comments/comments?id={{id}}&type={{type}}&thumbnail={{item.cover.image.small.url}}&title={{item.title}}&rate={{item.rating.value}}">
  æŸ¥çœ‹æ›´å¤šçŸ­è¯„</navigator>
```

åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶-è¯„åˆ†ï¼ŒæŒ‡å®šæ˜Ÿæ˜Ÿå¤§å°ã€å­—ä½“å¤§å°å’Œå­—ä½“é¢œè‰²ï¼š
```
<stars rate="{{item.rating.value}}" starsize="30" fontsize="30" fontcolor="#595959"></stars>
```

éå†åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶-è¯„ä»·ï¼š
```
<comment wx:for="{{comment.interests}}" wx:key="{{item.id}}" item="{{item}}"></comment>
```

åˆ›å»ºâ€œæŸ¥çœ‹æ›´å¤šçŸ­è¯„â€æŒ‰é’®ï¼Œéœ€è¦ä¼ é€’äº”ä¸ªå‚æ•°ï¼š`idã€typeã€thumbnailã€titleã€rete`ã€‚
```
<navigator class="more-comment"
  url="/pages/comments/comments?id={{id}}&type={{type}}&thumbnail={{item.cover.image.small.url}}&title={{item.title}}&rate={{item.rating.value}}">
  æŸ¥çœ‹æ›´å¤šçŸ­è¯„</navigator>
```

#### detail.wxss
```
.item-header {
  padding: 60rpx 30rpx;
}

/* ç”µå½±åç§° */
.item-header .item-title {
  font-size: 50rpx;
}

/* è¯„åˆ† */
.item-header .item-detail {
  display: flex;
  justify-content: space-between;
  margin-top: 20rpx;
}

.item-detail .left-detail {
  flex: 1;
  margin-right: 20rpx; 
}

.left-detail .item-rate {
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.item-rate .comment-persons {
  font-size: 28rpx;
  color: #ccc;
  margin-left: 20rpx;
}

/* ç”µå½±å°é¢ */
.item-detail .right-detail {
  width: 200rpx;
  height: 300rpx;
}

.right-detail image {
  width: 100%;
  height: 100%;
}

/* ç”µå½±ä¿¡æ¯ */
.item-sub-detail {
  margin-top: 40rpx;
  font-size: 32rpx;
}

.item-sub-detail view {
  margin-bottom: 10rpx;
}

/* æ ‡ç­¾ */
.item-tags {
  padding: 0rpx 30rpx;
}

.item-tags .item-tags-title {
  color: #b3b3b3;
  font-size: 32rpx;
  margin-bottom: 20rpx;
}

.item-tags .item-tags-list {
  display: flex;
  justify-content: flex-start;
  flex-wrap: wrap;
}

.item-tags-list text {
  padding: 10rpx 20rpx;
  background-color: #f5f5f5;
  font-size: 32rpx;
  color: #353535;
  text-align: center;
  border-radius: 40rpx;
  margin-right: 20rpx;
  margin-bottom: 20rpx;
}

/* è¯„è®ºåˆ—è¡¨ */
.comment-list-group {
  padding: 60rpx 30rpx;
}

.comment-list-group .comment-title {
  font-size: 32rpx;
  color: #b3b3b3;
}

/* æŸ¥çœ‹æ›´å¤šçŸ­è¯„ */
.more-comment {
  text-align: center;
  font-size: 36rpx;
  color: #41be57;
  margin-bottom: 40rpx;
}
```

#### detail.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "usingComponents": {
    "stars": "/components/stars/stars",
    "comment": "/components/comment/comment"
  }
}
```

#### detail.js
```
// pages/detail/detail.js
import {network} from "../../utils/network.js"


Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    <!-- options å¯ä»¥è·å–åˆ°é¡µé¢è·³è½¬æ—¶ä¼ é€’çš„æ•°æ® -->
    console.log(options);
    var that = this;
    var type = options.type;
    var id = options.id;
    that.setData({
      type: type,
      id: id
    })
    // è¯¦æƒ…
    network.getItemDetail({
      type: type,
      id: id,
      success: function(item) {
        var genres = item.genres;
        genres = genres.join("/");
        item.genres = genres;

        var actors = item.actors;
        var actornames = [];
        if (actors.length > 3) {
          actors = actors.slice(0, 3);
        }
        for (var index=0; index<actors.length; index++) {
          var actor = actors[index];
          actornames.push(actor.name);
        }
        
        actornames = actornames.join("/");
        var director = "";
        if (item.directors.length > 0) {
          director = item.directors[0].name;
        }
        var authors = director + "(å¯¼æ¼”) /" + actornames;
        item.authors = authors;
        
        that.setData({
          item: item
        });
      }
    });
    // æ ‡ç­¾
    network.getItemTags({
      type: type,
      id: id,
      success: function (tags) {
        that.setData({
          tags: tags
        })
      }
    });
    // è¯„è®º
    network.getItemComments({
      type: type,
      id: id,
      success: function (comment) {
        that.setData({
          comment: comment
        })
      }
    })
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢æ˜¾ç¤º
   */
  onShow: function () {
    // æ»šåŠ¨åˆ°é¡¶éƒ¨
    wx.pageScrollTo({
      scrollTop: 0,
    })
  }
})
```

æ•°æ®å¤„ç†ï¼Œå°† [1, 2, 3] -> '1/2/3' çš„æ ·å¼ï¼š
```
actornames = actornames.join("/");
```

`var actornames = [];` å®šä¹‰ä¸€ä¸ªå¯å˜æ•°ç»„ã€‚  
`actornames.push(actor.name);` å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ ã€‚  

### è¯„è®º
![å¾®ä¿¡å°ç¨‹åº10](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº10.png)

#### comments.wxml
```
<view class="container">
  <!-- ç”µå½±è¯¦æƒ… -->
  <view class="item-group" bindtap="onItenTapEvent">
    <image class="thumbnail" src="{{thumbnail}}"></image>
    <text class="item-title">{{title}}</text>
    <text class="item-rate">{{rate}}</text>
  </view>

  <!-- è¯„è®º -->
  <view class="comment-title">å…¨éƒ¨å½±è¯„({{comment.total}})</view>
  <comment wx:for="{{comment.interests}}" wx:key="{{item.id}}" item="{{item}}"></comment>

  <!-- ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µ -->
  <view class="page-btn-group">
    <button class="page-btn" bindtap="onPrePageTap" disabled="{{start <= 1}}" loading="{{preLoading}}">ä¸Šä¸€é¡µ</button>
    <button class="page-btn" bindtap="onNextPageTap" loading="{{nextLoading}}">ä¸‹ä¸€é¡µ</button>
  </view>
</view>
```

#### comments.wxss
```
.container {
  padding: 20rpx 30rpx;
}

.item-group {
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.item-group .thumbnail{
  width: 40rpx;
  height: 50rpx;
}

.item-group .item-title {
  font-size: 32rpx;
  color: #41be57;
  margin-left: 10rpx;
  margin-right: 10rpx;
}

.item-group .item-rate {
  font-size: 28rpx;
  color: #ccc;
}

.comment-title {
  margin-top: 60rpx;
  font-size: 40rpx;
}

/* ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µ */
.page-btn-group {
  margin-top: 40rpx;
  margin-bottom: 40rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.page-btn {
  flex: 1;
  height: 60rpx;
  color: #898989;
  border-color: #898989;
  line-height: 60rpx;
}
```

#### comments.json
åœ¨ .json æ–‡ä»¶ä¸­å¯¼å…¥äº†ç»„ä»¶ï¼š
```
{
  "usingComponents": {
    "comment": "/components/comment/comment"
  }
}
```

#### comments.js
```
// pages/comments/comments.js
import {network} from "../../utils/network.js"

Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    total: 0,
    start: 1,
    count: 20
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    console.log(options);
    var that = this;
    that.setData(options);

    that.getComments(1);
  },

  /**
   * è·å–è¯„è®º
   */
  getComments: function(start) {
    var that = this;
    var type = that.data.type;
    var id = that.data.id;
    if (start > that.data.start) {
      that.setData({
        nextLoading: true
      })
    } else {
      that.setData({
        preLoading: true
      })
    }

    // è¯·æ±‚è¯„è®ºæ•°æ®
    network.getItemComments({
      type: type,
      id: id,
      start: start,
      count: 20,
      success: function (comment) {
        that.setData({
          comment: comment,
          start: start,
          nextLoading: false,
          preLoading: false,
        });
        wx.pageScrollTo({
          scrollTop: 0,
        })
      }
    })
  },

  // è¿”å›ä¸Šä¸€é¡µ
  onItenTapEvent: function(event) {
    wx.navigateBack({});
  },

  // ä¸Šä¸€é¡µ
  onPrePageTap: function(event) {
    var that = this;
    var oldStart = that.data.start;
    var start = oldStart - that.data.count;
    if (start > 0) {
      that.getComments(start);
    }
  },

  // ä¸‹ä¸€é¡µ
  onNextPageTap: function(event) {
    var that = this;
    var oldStart = that.data.start;
    var start = oldStart + that.data.count;
    that.getComments(start);
  }
})
```

### æœç´¢
![å¾®ä¿¡å°ç¨‹åº12](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº12.png)

#### search.wxml
```
<!-- æœç´¢æ¡† -->
<searchbar bindsearchinput="onSearchInputEvent"></searchbar>

<!-- å†å²è®°å½• -->
<view class="history-list-group" wx:if="{{histories && !subjects}}">
  <view class="history-title">
    <view class="title">å†å²è®°å½•</view>
    <view class="clear" bindtap="clearEvent">æ¸…é™¤</view>
  </view>
  <view wx:for="{{histories}}" wx:key="{{item.id}}" url="/pages/detail/detail?type=movie&id={{item.id}}" class="history-group">{{item.title}}</view>
</view>

<!-- æœç´¢ç»“æœ -->
<view class="item-list-group">
  <view class="item-group" wx:for="{{subjects}}" wx:key="{{item.id}}" bindtap="onItemTapEvent" data-id="{{item.id}}" data-title="{{item.title}}">
    <image class="thumbnail" src="{{item.pic.normal}}"></image>
    <view class="info-group">
      <view class="title">{{item.title}}</view>
      <view class="rate-year">{{item.rating.value}}åˆ†/{{item.year}}</view>
    </view>
  </view>
</view>
```

ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ `searchbar`ï¼Œä½¿ç”¨ `bindsearchinput="onSearchInputEvent"` ç»‘å®šè¾“å…¥æ¡†çš„è¾“å…¥äº‹ä»¶ã€‚å…¶ä¸­çš„ `bindsearchinput` = `bind` + `searchinput`ï¼Œè€Œ `"onSearchInputEvent"` æ˜¯æœç´¢é¡µé¢éœ€è¦å®ç°çš„å›è°ƒæ–¹æ³•ï¼š
```
<searchbar bindsearchinput="onSearchInputEvent"></searchbar>
```

#### search.wxss
```
.item-list-group {
  padding: 10rpx 20rpx;
}

.item-list-group .item-group {
  padding: 10rpx 0;
  border-bottom: 1rpx solid #e4e4e4;
  display: flex;
}

.item-group .thumbnail{
  width: 80rpx;
  height: 100rpx;
  margin-right: 20rpx;
}

.item-group .info-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.info-group .title {
  font-size: 32rpx;
}

.info-group .rate-year {
  font-size: 28rpx;
  color: #7b7b7b;
}


.history-list-group {
  padding: 10rpx 20rpx;
}

.history-list-group .history-title {
  display: flex;
  justify-content: space-between;
  padding: 20rpx 0;
  background: #f9f9f9;
  font-size: 28rpx;
  color: #9e9e9e;
}

.history-list-group .history-group {
  font-size: 32rpx;
  padding: 20rpx 0;
  border-bottom: 1rpx solid #e4e4e4;
}

/* 
 padding:10px 5px 15px 20px;
 
 ä¸Šå†…è¾¹è·æ˜¯ 10px
 å³å†…è¾¹è·æ˜¯ 5px
 ä¸‹å†…è¾¹è·æ˜¯ 15px
 å·¦å†…è¾¹è·æ˜¯ 20px

 ---------
 padding:10px 5px 15px;

 ä¸Šå†…è¾¹è·æ˜¯ 10px
 å³å†…è¾¹è·å’Œå·¦å†…è¾¹è·æ˜¯ 5px
 ä¸‹å†…è¾¹è·æ˜¯ 15px

 ---------
 padding:10px 5px;

 ä¸Šå†…è¾¹è·å’Œä¸‹å†…è¾¹è·æ˜¯ 10px
 å³å†…è¾¹è·å’Œå·¦å†…è¾¹è·æ˜¯ 5px

 ---------
 padding:10px;

 æ‰€æœ‰ 4 ä¸ªå†…è¾¹è·éƒ½æ˜¯ 10px
 */
```

#### search.json
ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ searchbarï¼š
```
{
  "usingComponents": {
    "searchbar": "/components/searchbar/searchbar"
  }
}
```

#### search.js
```
// pages/search/search.js
import {network} from "../../utils/network.js"

Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {

  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    var that = this;
    wx.getStorage({
      key: 'searched',
      success: function(res) {
        console.log(res)
        var data = res.data;
        that.setData({
          histories: data
        })
      },
    })
  },

  // è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶
  onSearchInputEvent: function(event) {
    var that = this;
    var value = event.detail.value;
    if (!value || value === "") {
      that.setData({
        subjects: null
      });
      return;
    }
    network.getSearch({
      q: value,
      success: function(subjects){
        that.setData({
          subjects: subjects
        })
      }
    })
  },

  // é€‰ä¸­æŸä¸€æ¡æœç´¢ç»“æœ
  onItemTapEvent: function(event) {
    var that = this;
    var id = event.currentTarget.dataset.id;
    var title = event.currentTarget.dataset.title;
    var histories = that.data.histories;
    if (!histories) {
      histories = [];
    }
    var isExisted = false;
    for (var index=0; index<histories.length;index++) {
      var movie = histories[index];
      if (movie.id === id) {
        isExisted = true;
        break;
      }
    }
    if (!isExisted) {
      histories.push({ title: title, id: id })
      wx.setStorage({
        key: 'searched',
        data: histories,
        success: function () {
          console.log("ä¿å­˜æˆåŠŸï¼");
        }
      })
    }
    
    // é¡µé¢è·³è½¬
    wx.navigateTo({
      url: "/pages/detail/detail?type=movie&id="+id,
    })
  },

  clearEvent: function() {
    var that = this;
    wx.removeStorage({
      key: 'searched',
      success: function(res) {
        console.log("åˆ é™¤æˆåŠŸ!");
        that.setData({
          histories: null
        });
      },
    });
  }
})
```

## æ€»ç»“

### æ›´æ–°UI
```
that.setData({
  lights: lights,
  halfs: halfs,
  grays: grays,
  ratetext: ratetext,
})
```

### é¡µé¢è·³è½¬
åˆ›å»º `navigator` ç»„ä»¶ï¼›  
è®¾ç½®è·³è½¬è·¯å¾„ `url`ï¼›  
`typeã€id`ï¼šåœ¨ `url` ä¸­é€šè¿‡ç¬¦å· `?` åŠ å…¥å‚æ•°ï¼Œå®ç°é¡µé¢é—´ä¼ å€¼ã€‚  
```
<navigator url="/pages/detail/detail?type={{type}}&id={{item.id}}"> </navigator>
```

### paddingã€padding-topã€margin-top å’Œ top çš„åŒºåˆ«
```
padding:10px 5px 15px 20px; //ä¸Šå†…è¾¹è·æ˜¯ 10pxï¼Œå³å†…è¾¹è·æ˜¯ 5pxï¼Œä¸‹å†…è¾¹è·æ˜¯ 15pxï¼Œå·¦å†…è¾¹è·æ˜¯ 20px

padding:10px 5px 15px; //ä¸Šå†…è¾¹è·æ˜¯ 10pxï¼Œå³å†…è¾¹è·å’Œå·¦å†…è¾¹è·æ˜¯ 5pxï¼Œä¸‹å†…è¾¹è·æ˜¯ 15px

padding:10px 5px; //ä¸Šå†…è¾¹è·å’Œä¸‹å†…è¾¹è·æ˜¯ 10pxï¼Œå³å†…è¾¹è·å’Œå·¦å†…è¾¹è·æ˜¯ 5px

padding:10px; //æ‰€æœ‰ 4 ä¸ªå†…è¾¹è·éƒ½æ˜¯ 10px

padding-top:10px; //æ˜¯æŒ‡å®¹å™¨å†…çš„å†…å®¹è·ç¦»å®¹å™¨çš„é¡¶éƒ¨æœ‰10ä¸ªåƒç´ ï¼Œæ˜¯åŒ…å«åœ¨å®¹å™¨å†…çš„

margin-top:10px; //æ˜¯æŒ‡å®¹å™¨æœ¬èº«çš„é¡¶éƒ¨è·ç¦»å…¶ä»–å®¹å™¨æœ‰10ä¸ªåƒç´ ï¼Œä¸åŒ…å«åœ¨å®¹å™¨å†…

top:10px; //æ˜¯æŒ‡å®¹å™¨æœ¬èº«çš„é¡¶éƒ¨è·ç¦»é¡µé¢çš„é¡¶ç«¯æœ‰10ä¸ªåƒç´ 
```

### observerï¼ˆç›‘å¬å±æ€§ï¼‰  
å±æ€§è¢«æ”¹å˜æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œä¹Ÿå¯ä»¥å†™æˆåœ¨ `methods` æ®µä¸­å®šä¹‰çš„æ–¹æ³•åå­—ç¬¦ä¸², å¦‚ï¼š`'_propertyChange'`ã€‚é€šå¸¸ `newVal` å°±æ˜¯æ–°è®¾ç½®çš„æ•°æ®ï¼Œ`oldVal` æ˜¯æ—§æ•°æ®
```
properties: {
  rate: {
    type: Number,
    value: 0,
    observer(newVal, oldVal, changedPath) {
      this.updateRate();
    }
  }
}
```

### äº‹ä»¶å›è°ƒã€ä¸»åŠ¨è§¦å‘
ç»„ä»¶å†…é€šè¿‡ä¸»åŠ¨è§¦å‘å›è°ƒæ–¹æ³•ï¼Œå®ç°äº‹ä»¶ä¼ é€’ï¼ŒåŒæ—¶ä½¿ç”¨åˆ°ç»„ä»¶çš„æ–‡ä»¶éœ€è¦ç»‘å®šå›è°ƒæ–¹æ³•ã€‚ä»¥ `searchbar` ç»„ä»¶ä¸ºä¾‹ï¼š  
searchbar.js æ–‡ä»¶ï¼š
```
/**
  * ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
  */
methods: {
  // è¾“å…¥æ¡†è¾“å…¥å›è°ƒ
  onInputEvent: function(event) {
    var value = event.detail.value;
    var detail = {"value": value};
    var options = {};
    // å›è°ƒæ–¹æ³•
    this.triggerEvent("searchinput",detail,options);
  }
}
```

search.wxml æ–‡ä»¶ï¼š
```
<searchbar bindsearchinput="onSearchInputEvent"></searchbar>
```

`bindsearchinput` = `bind` + `searchinput`ã€‚`"onSearchInputEvent"` æ˜¯éœ€è¦å®ç°çš„å›è°ƒäº‹ä»¶ã€‚

search.js æ–‡ä»¶ï¼š
```
// pages/search/search.js
import {network} from "../../utils/network.js"

Page({

  // è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶
  onSearchInputEvent: function(event) {
    var that = this;
    var value = event.detail.value;
    // to do
  }
})
```

### åŠ è½½åŠ¨ç”»
```
// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
wx.showLoading({
  title: 'æ­£åœ¨åŠ è½½ä¸­...',
})

// ç§»é™¤åŠ è½½åŠ¨ç”»
wx.hideLoading();
```

### scroll-view æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®
```
// æ»šåŠ¨åˆ°é¡¶éƒ¨
wx.pageScrollTo({
  scrollTop: 0,
})
```

### ç½‘ç»œè¯·æ±‚
```
// å‘èµ·ç½‘ç»œè¯·æ±‚
wx.request({
  // è®¾ç½®è¯·æ±‚url
  url: url,
  // è®¾ç½®è¯·æ±‚å‚æ•°
  data: {
    count: count
  },
  // è¯·æ±‚æˆåŠŸå›è°ƒ
  success: function(res) {
    console.log(res);
  }
})
```

### æ„é€ å™¨
å¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ª .js æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…éƒ¨åˆ›å»ºæ„é€ å™¨ã€‚ä»¥ `globalUrlsã€ntework` ä¸ºä¾‹ï¼Œæ„é€ å™¨å†…éƒ¨å¯ä»¥å®šä¹‰å˜é‡ã€æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å¤–éƒ¨è°ƒç”¨è€…ä¸éœ€è¦åˆå§‹åŒ–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `globalUrlsã€ntework` è°ƒç”¨æ„é€ å™¨å†…éƒ¨çš„å˜é‡å’Œæ–¹æ³•ï¼ŒåŒ iOS é‡Œçš„ç±»æ–¹æ³•ã€‚
```
const globalUrls = {
    // å†…å®¹
}
```


# ES6è¯­æ³•
ES6 æ˜¯ ECMAScript 6 çš„ç®€å†™ï¼ŒECMAScript 6 æ³›æŒ‡â€œä¸‹ä¸€ä»£ JavaScript è¯­è¨€â€ï¼Œå…·ä½“æ¯å¹´å‘å¸ƒçš„éƒ½æœ‰è‡ªå·±çš„ä¸“å±åç§°ï¼Œæ¯”å¦‚2015å¹´å‘å¸ƒçš„åˆ™ä¸º ESMAScript 2015ã€‚ç›®å‰è¯´çš„ ES6 è¯­æ³•ï¼Œä¸€èˆ¬å€¼å¾—éƒ½æ˜¯ ESMAScript 2015ç‰ˆã€‚[ECMAScript](https://baike.baidu.com/item/ECMAScript/1889420?fr=aladdin) æ˜¯ JavaScript çš„æ ‡å‡†ï¼ŒJavaScript æ˜¯ ECMAScript çš„ä¸€ç§å®ç°ï¼Œå¦å¤–çš„ ECMAScript æ–¹è¨€è¿˜æœ‰ Jscript å’Œ ActionScriptã€‚

åœ¨å°ç¨‹åºå¼€å‘å·¥å…·ä¸­å¼€å¯ES6ï¼šåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­->è¯¦æƒ…->ES6è½¬ES5ã€‚

## å®šä¹‰å˜é‡

### let
`let` è·Ÿ `var` ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨æ¥å®šä¹‰å˜é‡ï¼Œä½†æ˜¯ä»–æ¯” `var` æ›´åŠ çš„å®‰å…¨ï¼Œä½“ç°åœ¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š
1. ä¸ä¼šå‡ºç°å˜é‡æå‡çš„æƒ…å†µã€‚
   ```
   console.log(a);
   var a = 10;
   ```

   å˜é‡ `a` æ˜¯åœ¨æ‰“å°çš„åé¢å®šä¹‰çš„ï¼Œä½†æ˜¯ä»¥ä¸Šçš„ä»£ç å¹¶ä¸ä¼šå‡ºé”™ï¼Œè€Œæ˜¯ä¼šæ‰“å° `undefined`ï¼Œå› ä¸ºvarä¼šæŠŠå˜é‡ `a` æå‡åˆ°ä»£ç æœ€å¼€å§‹çš„åœ°æ–¹è¿›è¡Œå®šä¹‰ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ `let` å°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼š
   ```
   console.log(b);
   let b = 10;
   ```

   æ­¤æ—¶å†å»æ‰“å°çš„æ—¶å€™ï¼Œå°±ç›´æ¥ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ `ReferenceError: b is not defined.`ï¼Œè¿™æ‰æ˜¯æ­£ç¡®çš„æ–¹å¼ã€‚

   æ³¨æ„ï¼šå°ç¨‹åºä¸­ä¸èƒ½çœŸæ­£è§£æES6è¯­æ³•ï¼Œä»–åªæ˜¯å€ŸåŠ©äº†ç¬¬ä¸‰æ–¹å·¥å…·å°† ES6 è¯­æ³•è½¬æˆ ES5 è¯­æ³•è¿è¡Œçš„ï¼Œåœ¨åº•å±‚ä¹Ÿæ˜¯ç”¨ `var` æ¥ä»£æ›¿ `let` çš„ï¼Œæ‰€ä»¥ä¾ç„¶ä¼šå‘ç”Ÿå˜é‡æå‡ã€‚

2. åªåœ¨å½“å‰ä»£ç å—å†…æœ‰æ•ˆã€‚
   ```
   for(var i=0;i<=3;i++){
     console.log(i);
   }
   console.log(i);
   ```

   æ­£å¸¸é€»è¾‘ä¸‹ï¼Œåœ¨ for å¾ªç¯ç»“æŸå i å°±ä¸èƒ½å¤Ÿå†ä½¿ç”¨äº†ï¼Œä½†æ˜¯è¿™é‡Œçš„æ‰“å°ç»“æœæ˜¯ 3 è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ç§ç°è±¡åœ¨ä¸€äº›æƒ…å†µä¸‹ä¹Ÿä¼šé˜é‡Šè«åå…¶å¦™çš„é”™è¯¯ï¼Œå½±å“å¼€å‘ã€‚ä½†æ˜¯ `let` å°±ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š
   ```
   for(let i=0; i<=3; i++){
     console.log(i);
   }
   console.log(i);
   ```

   æ­¤æ—¶å†æ‰“å°içš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ `ReferenceError: b is not defined.`ã€‚

### const
`const` æ˜¯ç”¨æ¥å®šä¹‰å¸¸é‡çš„ï¼Œå¸¸é‡æ˜¯ä¸€æ—¦å®šä¹‰å¥½äº†ä»¥åï¼Œå°±ä¸èƒ½å¤Ÿå†ä¿®æ”¹äº†ï¼š
```
const PI = 3.14;
PI = 3 // ä¼šæŠ›å‡ºå¼‚å¸¸
```

`const` åªæ˜¯ç”¨æ¥é™åˆ¶æŒ‡å‘çš„å†…å­˜åœ°å€ä¸èƒ½æ”¹å˜ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªå†…å­˜åœ°å€ä¸Šçš„æ•°æ®æ”¹å˜äº†ï¼Œæ˜¯å¯ä»¥çš„ï¼š
```
const mylist = [1,2,3];
mylist.push(4);
console.log(mylist);
```

æ‰“å°ç»“æœï¼š
```
[1,2,3,4]
```

## å‡½æ•°
### é»˜è®¤å‚æ•°
```
function fetch(url, method="get"){
    console.log(url);
    console.log(method);
}
```

`method="get"` è¡¨ç¤ºåœ¨è°ƒç”¨ `fetch` å‡½æ•°çš„æ—¶ï¼Œå¯ä»¥ä¸ä¼  `method` å‚æ•°ï¼Œä»–ä¼šé»˜è®¤ä½¿ç”¨ `get`ï¼š
```
fetch("http://www.baidu.com/"); //method == get
fetch("http://www.baidu.com/","post") // method == post
```

* å®šä¹‰é»˜è®¤å‚æ•°çš„æ—¶å€™ï¼Œé»˜è®¤å‚æ•°å¿…é¡»è¦åœ¨éé»˜è®¤å‚æ•°çš„åé¢ã€‚

æœ‰å¤šä¸ªé»˜è®¤å€¼çš„æƒ…å†µï¼š
```
function person(name, age=18, gender='ç”·'){
    console.log(name, age, gender);
}
```

åœ¨è°ƒç”¨ `person` å‡½æ•°æ—¶ï¼Œå¦‚æœåªæä¾› `gender`ï¼Œä¸æä¾› `age`ï¼Œé‚£ä¹ˆå¿…é¡»ä¸è§£æ„èµ‹å€¼é»˜è®¤å€¼ç»“åˆä½¿ç”¨ï¼š
```
function person(name, {age=18 ,gender='å¥³'} = {}){
    console.log(name, age, gender);
}

person("çŸ¥äº†",{gender:"ç”·"});
```

### ç®­å¤´å‡½æ•°
å‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°å˜é‡ä¼ é€’çš„æ—¶å€™ï¼Œä¸ºäº†ç®€åŒ–å†™æ³•ï¼Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥å®ç°ï¼š
```
wx.request({
    url: "http://www.baidu.com/",
    success: function(res){
        // to do
    }
});
```

å¯¹ä¸Šé¢çš„ä»£ç ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š
```
wx.request({
    url: 'http://www.baidu.com/',
    success: res => {
        // to do 
    }
});
```

#### ç®­å¤´å‡½æ•°çš„è¯­æ³•
```
(å‚æ•°1,å‚æ•°2) => {ä»£ç å—}
```

å®šä¹‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ï¼š
```
function request(url,success) {
  if (success) {
    let result = success();
    console.log(result);
  }
}
```

å¦‚æœåªæœ‰ä¸€è¡Œä»£ç ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ç”¨èŠ±æ‹¬å·ï¼ˆ`(a,b) => a+b` è¿”å› a+b çš„ç»“æœï¼‰ï¼š
```
request("http://www.baidu.com/", (res1, res2) => true);
```

å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ä¸ä½¿ç”¨åœ†æ‹¬å·ï¼ˆ`a => a+1`ï¼‰ï¼š
```
request("http://www.baidu.com/", res => {
  console.log(res);
  return true;
});
```

å¦‚æœæ²¡æœ‰å‚æ•°ï¼š
```
request("http://www.baidu.com/", () => {
  console.log("111111");
  return true;
});
```

### Promise
`Promise` çš„å®ç°åŸç†ï¼š
```
const p = new Promise(function(resolve,reject){
    setTimeout(() => {
        // å¦‚æœæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä¸‹é¢çš„thenå‡½æ•°
        resolve("success");
    },1000);
    
    setTimeout(() => {
        // å¦‚æœæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä¸‹é¢çš„catchå‡½æ•°
        reject("fail")
    },1000);

    // å¦‚æœä»¥ä¸Šä»£ç éƒ½æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆåªä¼šè°ƒç”¨ä¸‹é¢çš„thenæ–¹æ³•ï¼Œå› ä¸ºresolveçš„è°ƒç”¨åœ¨å‰é¢ã€‚
});

p.then((res) => {
  console.log(res);
}).catch((error) => {
  console.log(error);
});
```

## ç±»
åœ¨ ESS ä¸­å®ç°ä¸€ä¸ªç±»ï¼š
```
function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.toString = function () {
  return '(' + this.x + ', ' + this.y + ')';
};

var p = new Point(1, 2);
```

åœ¨ ES6 ä¸­å®ç°ä¸€ä¸ªç±»ï¼š
```
class Person{
  // æ„é€ å‡½æ•°
  constructor(name,age){
    this.name = name;
    this.age = age;
  }

  sayHello(){
    console.log("hello world");
  }
}

let p = new Person("zhiliao",18);
p.sayHello();
```

### å®šä¹‰é™æ€æ–¹æ³•
ä½¿ç”¨ `static` å…³é”®å­—å®šä¹‰çš„é™æ€æ–¹æ³•ï¼Œè¯¥é™æ€æ–¹æ³•æ˜¯åªå±äºç±»ï¼Œä¸å±äºå¯¹è±¡ã€‚åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ç›´æ¥é€šè¿‡ç±»åå°±å¯ä»¥è°ƒç”¨ï¼š
```
class Utils{
  constructor(){}
  static timeFormat(time){
    // to do
  }
}

// è°ƒç”¨
Utils.timeFormat("2021/1/1")
```

## æ¨¡å—
åœ¨ä¼ ç»Ÿçš„ JS ä¸­ï¼Œæ²¡æœ‰åŠæ³•åœ¨å¤šä¸ª js æ–‡ä»¶ä¸­äº’ç›¸å¯¼å…¥ï¼Œå¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´å¾ˆä¸æ–¹ä¾¿ã€‚å› æ­¤ ES6 æä¾›äº†ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚

### export
è®¤åœ¨ä¸€ä¸ªjsæ–‡ä»¶ä¸­å†™å¥½çš„ä»£ç æˆ–è€…å˜é‡ï¼Œæ˜¯ä¸èƒ½å¤Ÿç»™å…¶ä»–çš„æ–‡ä»¶ä½¿ç”¨çš„ï¼Œå¦‚æœæƒ³è¦è¢«å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨exportå…³é”®å­—ï¼š
```
// utils.js
var name = "zhiliao";
function dateFormat(date){
    // æ ¼å¼åŒ–ä»£ç 
}
class Person{
    constructor(name,age){
        this.name = name;
        this.age = age;
    }
}

// å¯¼å‡º
export {name,dateFormat,Person}
```

### import
ä»¥ä¸Šæ–‡ä»¶è¿›è¡Œ `export` äº†ï¼Œé‚£ä¹ˆä»¥åå…¶ä»–æ–‡ä»¶æƒ³è¦ä½¿ç”¨çš„ï¼Œåˆ™éœ€è¦ä»è¿™ä¸ªæ–‡ä»¶ä¸­æŠŠéœ€è¦çš„è¿›è¡Œ `import`ï¼š
```
// from åé¢æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„
import {name,dateFormat,Person} from "utils.js";
```

# äº‘å¼€å‘

[å°ç¨‹åºÂ·äº‘å¼€å‘](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)

## åˆ›å»ºå°ç¨‹åº
[åˆ›å»ºå°ç¨‹åº](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/quick-start/miniprogram.html)
![å¾®ä¿¡å°ç¨‹åº13](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº13.png)
![å¾®ä¿¡å°ç¨‹åº14](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº14.png)

## æ•°æ®åº“
### åˆ›å»ºç¨‹åº
æ–°å»ºé¡¹ç›® databasedemoï¼š
![å¾®ä¿¡å°ç¨‹åº15](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº15.png)

### åˆå§‹åŒ–äº‘å¼€å‘
åœ¨ app.js æ–‡ä»¶ä¸­çš„ `onLaunch()` æ–¹æ³• [åˆå§‹åŒ–](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/init.html) æ•°æ®åº“ï¼š
```
App({

  /**
   * å½“å°ç¨‹åºåˆå§‹åŒ–å®Œæˆæ—¶ï¼Œä¼šè§¦å‘ onLaunchï¼ˆå…¨å±€åªè§¦å‘ä¸€æ¬¡ï¼‰
   */
  onLaunch: function () {
    wx.cloud.init({
      env: "ç¯å¢ƒID"
      traceUser: true
    })
  }
})
```
`env`ï¼šæŒ‡å®šæ‰€æœ‰æœåŠ¡çš„é»˜è®¤ç¯å¢ƒã€‚  
`traceUser`ï¼šæ˜¯å¦åœ¨å°†ç”¨æˆ·è®¿é—®è®°å½•åˆ°ç”¨æˆ·ç®¡ç†ä¸­ï¼Œåœ¨æ§åˆ¶å°ä¸­å¯è§ã€‚  

### åˆ›å»ºé›†åˆ
åœ¨äº‘å¼€å‘çš„æ•°æ®åº“ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ `NoSQL` ç±»å‹çš„æ•°æ®åº“ã€‚å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼Œå¯¹åº”çš„æ˜¯ `NoSQL` ä¸­çš„ä¸€ä¸ªé›†åˆã€‚æ‰€ä»¥åœ¨æ‰€æ•°æ®æ“ä½œä¹‹å‰ï¼Œåº”è¯¥å…ˆåˆ›å»ºä¸€ä¸ªé›†åˆã€‚åˆ›å»ºå®Œé›†åˆåï¼Œä¹Ÿä¸éœ€è¦è·Ÿå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œå…ˆå®šä¹‰å¥½è¿™ä¸ªé›†åˆä¸­çš„å­—æ®µï¼Œè€Œæ˜¯ç›´æ¥æ’å…¥æ•°æ®ï¼Œå¹¶ä¸”æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ¯æ¡æ•°æ®çš„å­—æ®µæ— éœ€ä¿æŒä¸€è‡´ï¼
![å¾®ä¿¡å°ç¨‹åº16](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº16.png)

### è·å–æ•°æ®åº“å¯¹è±¡
å¯ä»¥é€šè¿‡ `wx.cloud.database` å‡½æ•°æ¥è·å–æ•°æ®åº“å¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°é»˜è®¤ä¼šä½¿ç”¨ `wx.cloud.init` æ–¹æ³•ä¸­æä¾›çš„ç¯å¢ƒä¸‹çš„æ•°æ®åº“ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨å…¶ä»–ç¯å¢ƒçš„æ•°æ®åº“ï¼Œå¯ä»¥ç»™ `wx.cloud.database` æ–¹æ³•ä¼ é€’ä¸€ä¸ª `env` å‚æ•°ï¼Œæ¯”å¦‚ï¼š`wx.cloud.database({ "env":"æ•°æ®åº“ç¯å¢ƒID" })`ã€‚

### è·å–é›†åˆå¯¹è±¡
å¯ä»¥é€šè¿‡ `db.collection("é›†åˆåç§°")` æ¥è·å–é›†åˆå¯¹è±¡ï¼Œæ¯”å¦‚é€šè¿‡ `const test = db.collection("test")` è·å–åˆ° `test` é›†åˆå¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥å¯¹ `test` æ¥è¿›è¡Œæ“ä½œäº†ã€‚

### æ’å…¥æ•°æ®
è°ƒç”¨é›†åˆ `test` çš„ `add()` æ–¹æ³•æ¥æ’å…¥æ•°æ®ï¼š
```
// æ•°æ®åº“
const db = wx.cloud.database();

Page({
  /**
   * æ·»åŠ æ•°æ®
   */
  add: function (options) {
    // é›†åˆ
    db.collection("test").add({
      data: {
        title: "æµ‹è¯•æ ‡é¢˜",
        pub_date: new Date("2021-04-01"),
        author: "æµ‹è¯•ä½œè€…",
        content: "æµ‹è¯•å†…å®¹"
      }
    }).then(res => {
      console.log(res);
    })
  }
})
```

![å¾®ä¿¡å°ç¨‹åº17](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº17.png)

### è·å–æ•°æ®
1.è·å–é›†åˆé‡Œçš„æ‰€æœ‰æ•°æ®ï¼ˆè€ƒè™‘åˆ°æ€§èƒ½ï¼Œå°ç¨‹åºä¸€æ¬¡æ€§æœ€å¤šåªèƒ½è·å–20æ¡æ•°æ®ï¼‰
```
get: function (options) {
  db.collection("test").get().then(res => {
    console.log(res)
  })
}
```

2.æ ¹æ® `id` è·å–æŒ‡å®šæŸä¸€æ¡æ•°æ®ï¼ˆé€šè¿‡ `id` è·å–æ•°æ®éœ€è¦é€šè¿‡ `doc()` å‡½æ•°æ¥å®ç°ï¼‰
```
getById: function (options) {
  db.collection("test").doc("b00064a76066e9340d0936c379481d64").get().then(res => {
    console.log(res)
  })
}
```

3.æ ¹æ®æ¡ä»¶è·å–æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ where å‡½æ•°æ¥å®ç°
```
getBy: function (options) {
  db.collection("test").where({
    title: "æµ‹è¯•æ ‡é¢˜"
  }).get().then(res => {
    console.log(res);
  })
}
```

### åˆ é™¤æ•°æ®
```
/**
 * åˆ é™¤ä¸€æ¡æ•°æ®,éœ€è¦çŸ¥é“è¿™æ¡æ•°æ®çš„ id
 */
remove: function (options) {
  db.collection("test").doc("b00064a76066e9340d0936c379481d64").remove().then(res => {
    console.log(res);
  })
}
```

åˆ é™¤å¤šæ¡æ•°æ®ï¼ˆåªèƒ½åœ¨æœåŠ¡ç«¯å®ç°ï¼Œéœ€è¦ç”¨åˆ°äº‘å‡½æ•°ï¼‰ï¼š
```
db.collection("article").where({
    title: "çŸ¥äº†"
}).remove().then(res => {
    console.log(res);
});
```

### æ›´æ–°æ•°æ®
```
/**
 * å±€éƒ¨æ•°æ®ï¼šå±€éƒ¨æ›´æ–°æ˜¯ä¸€æ¬¡æ€§åªæ›´æ–°ä¸€æ¡æ•°æ®ä¸­çš„æŸå‡ ä¸ªå­—æ®µçš„å€¼ï¼Œç”¨çš„æ˜¯updateæ–¹æ³•ã€‚ 
 */
update: function (options) {
  db.collection("test").doc("b00064a76066e9340d0936c379481d64").update({
    data: {
      title: "æµ‹è¯•ä½œè€…2"
    }
  }).then(res => {
    console.log(res);
  })
},

/**
 * æ•´ä½“æ›´æ–°ï¼šæ•´ä½“æ›´æ–°æ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®éƒ½æ›´æ–°ï¼Œç”¨çš„æ˜¯setæ–¹æ³• 
 */
updateAll: function (options) {
  db.collection("test").doc("b00064a76066e9340d0936c379481d64").set({
    data: {
        title: "æµ‹è¯•æ ‡é¢˜3",
        author: "æµ‹è¯•ä½œè€…2",
        content: "æµ‹è¯•å†…å®¹2"
    }
  })
}
```

ä¸€æ¬¡æ›´æ–°å¤šä¸ªæ•°æ®ï¼šéœ€è¦åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½¿ç”¨äº‘å‡½æ•°æ¥å®ç°ã€‚ 

### commandæŒ‡ä»¤
è·å– command å¯¹è±¡ï¼š
```
const db = wx.cloud.database();
const _ = db.command;
```

#### æŸ¥è¯¢æŒ‡ä»¤
é€šè¿‡ `db.command` å®ç°æ¡ä»¶æŸ¥è¯¢ã€‚
##### command.eq
ç¤ºä¾‹ä¸€ï¼Œåœ¨ `test` é›†åˆä¸­ï¼Œæ‰¾åˆ°å­—æ®µ `author == "æµ‹è¯•ä½œè€…03"` çš„æ•°æ®ï¼š  
ç¬¬ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡åˆ¶å®šæ•°æ®æŸ¥è¯¢ï¼š
```
db.collection("test").where({
  author: "æµ‹è¯•ä½œè€…03"
}).get().then(res => {
  console.log(res);
});
```

ç¬¬äºŒç§æ–¹å¼ï¼Œé€šè¿‡eqæŒ‡ä»¤æŸ¥è¯¢ï¼š
```
eqcommand: function(){
  db.collection("test").where({
    author: _.eq("æµ‹è¯•ä½œè€…03")
  }).get().then(res => {
    console.log(res);
  })
}
```

![å¾®ä¿¡å°ç¨‹åº18](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº18.png)
`author: _.eq("æµ‹è¯•ä½œè€…03")` å¼ºè°ƒç”¨æ˜¯ç­‰äºï¼Œ`author: "æµ‹è¯•ä½œè€…03"` å¼ºè°ƒçš„äº‹åŒ¹é…æ¡ä»¶ã€‚

ç¤ºä¾‹äºŒï¼ŒåŒ¹é… `dic.key == "æµ‹è¯•å¯¹è±¡03"` çš„æ•°æ®ï¼š
```
db.collection("test").where({
  dic: {
    key: "æµ‹è¯•å¯¹è±¡03"
  }
}).get().then(res => {
  console.log(res)
})
```

æŒ‡å®šæ•°æ®æ–¹å¼å¯ä»¥è·å–åˆ°ä¸¤æ¡æ•°æ®ï¼Œè¿™ä¸¤æ¡æ•°æ®çš„ `dic` å¯¹è±¡çš„ `key` ç­‰äº"æµ‹è¯•å¯¹è±¡03"ã€‚
![å¾®ä¿¡å°ç¨‹åº19](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº19.png)

ç¤ºä¾‹ä¸‰ï¼ŒåŒ¹é… `dic.key == "æµ‹è¯•å¯¹è±¡03"` ä¸” `dic.key02 == "æµ‹è¯•å¯¹è±¡03"` çš„æ•°æ®ï¼š
```
db.collection("test").where({
  dic: {
    key: "æµ‹è¯•å¯¹è±¡03",
    key02: "æµ‹è¯•å¯¹è±¡03"
  }
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº20](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº20.png)

ç¤ºä¾‹å››ï¼Œè·å– `dic == { key: "æµ‹è¯•å¯¹è±¡" }` çš„æ•°æ®ï¼š
```
db.collection("test").where({
  dic: _.eq({
    key: "æµ‹è¯•å¯¹è±¡03"
  })
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº21](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº21.png)

##### command.neq
è¡¨ç¤ºå­—æ®µä¸ç­‰äºæŸä¸ªå€¼ï¼Œå’Œ `db.command.eq` ç›¸åã€‚

##### command.lt
è¡¨ç¤ºå°äºæŸä¸ªå€¼ã€‚æ¯”å¦‚æŸ¥æ‰¾å°äº2021/4/1 10:00:00å‘å¸ƒçš„æ•°æ®ï¼š
```
db.collection("test").where({
  pub_date: _.lt(new Date("2021/4/1 10:00:00"))
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº22](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº22.png)

##### command.lte
è¡¨ç¤ºå°äºæˆ–è€…ç­‰äºæŸä¸ªå€¼ã€‚ä¸ `command.lt` ç±»ä¼¼ã€‚

##### command.gt
è¡¨ç¤ºå¤§äºæŸä¸ªå€¼ã€‚ä¸ `command.lt` ç±»ä¼¼ã€‚

##### command.gte
è¡¨ç¤ºå¤§äºæˆ–è€…ç­‰äºæŸä¸ªå€¼ã€‚ä¸ `command.lte` ç±»ä¼¼ã€‚

##### command.in
æŸ¥è¯¢ç­›é€‰æ¡ä»¶ï¼Œè¡¨ç¤ºå­—æ®µçš„å€¼éœ€åœ¨ç»™å®šçš„æ•°ç»„å†…ã€‚æ¯”å¦‚æŸ¥æ‰¾åŒ—äº¬æ—¥æŠ¥å’Œä»Šæ—¥å¤´æ¡ä¸¤ä¸ªä½œè€…å‘è¡¨çš„æ–‡ç« ï¼š
```
db.collection("test").where({
  author: _.in(["æµ‹è¯•ä½œè€…01", "æµ‹è¯•ä½œè€…02"])
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº23](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº23.png)

##### command.nin
æŸ¥è¯¢ç­›é€‰æ¡ä»¶ï¼Œè¡¨ç¤ºå­—æ®µçš„å€¼éœ€ä¸åœ¨ç»™å®šçš„æ•°ç»„å†…ã€‚ä¸ `command.in` ç±»ä¼¼ã€‚

##### command.and
æŸ¥è¯¢æŒ‡ä»¤ï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘ "ä¸" çš„å…³ç³»ï¼Œè¡¨ç¤ºéœ€åŒæ—¶æ»¡è¶³å¤šä¸ªæŸ¥è¯¢ç­›é€‰æ¡ä»¶ã€‚æ¯”å¦‚è·å–å‘è¡¨åœ¨ 2021/4/1 10:00:00 å’Œ 2021/4/1 11:00:00 ä¹‹é—´çš„æ‰€æœ‰æ•°æ®ï¼š
```
// 1.æ™®é€šè°ƒç”¨
db.collection("test").where({
  pub_date: _.and(_.gte(new Date("2021/4/1 10:00:00")), _.lte(new Date("2021/4/1 11:00:00")))
}).get().then(res => {
  console.log(res)
})

// 2.é“¾å¼è°ƒç”¨
db.collection("test").where({
  pub_date: _.gte(new Date("2021/4/1 10:00:00")).and(_.lte(new Date("2021/4/1 11:00:00")))
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº24](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº24.png)

##### command.or
æŸ¥è¯¢æŒ‡ä»¤ï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘ "æˆ–" çš„å…³ç³»ï¼Œè¡¨ç¤ºéœ€åŒæ—¶æ»¡è¶³å¤šä¸ªæŸ¥è¯¢ç­›é€‰æ¡ä»¶ã€‚æˆ–æŒ‡ä»¤æœ‰ä¸¤ç§ç”¨æ³•ï¼š
1. å¯ä»¥è¿›è¡Œå­—æ®µå€¼çš„ â€œæˆ–â€ æ“ä½œï¼›
2. å¯ä»¥è¿›è¡Œè·¨å­—æ®µçš„ â€œæˆ–â€ æ“ä½œã€‚

ç¤ºä¾‹ä¸€ï¼Œä¸€ä¸ªå­—æ®µçš„æˆ–æ“ä½œï¼ˆæ¯”å¦‚è·å–æ—¶é—´åœ¨ 2021/4/1 10:00:00 å‰æˆ–è€… 2021/4/1 11:00:00 åçš„æ•°æ®ï¼‰ï¼š
```
db.collection("test").where({
  pub_date: _.or(_.lt(new Date("2021/4/1 10:00:00")), _.gt(new Date("2021/4/1 11:00:00")))
}).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº25](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº25.png)

ç¤ºä¾‹äºŒï¼Œè·¨å­—æ®µæˆ–æ“ä½œï¼ˆæ¯”å¦‚æƒ³è¦è·å–æ—¶é—´åœ¨ 2021/4/1 10:00:00 å‰ï¼Œæˆ–è€…æ˜¯ä½œè€…ä¸­åŒ…å« â€œæµ‹è¯•ä½œè€…01â€ çš„æ•°æ®ï¼‰ï¼š
```
db.collection("test").where(
  _.or([
    {
      pub_date: _.lt(new Date("2021/4/1 10:00:00"))
    },
    {
      author: "æµ‹è¯•ä½œè€…01"
    }
  ])
).get().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº26](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº26.png)
æ³¨æ„ï¼š`where()` æ²¡æœ‰ `{}`ï¼Œ`or()` å†…éƒ¨æ˜¯ä¸€ä¸ªæ•°ç»„ `[]`ã€‚

#### æ›´æ–°æŒ‡ä»¤

##### command.set
æ›´æ–°æŒ‡ä»¤ã€‚ç”¨äºè®¾å®šå­—æ®µç­‰äºæŒ‡å®šå€¼ã€‚æ¯”å¦‚ä»¥ä¸‹æ˜¯ä¸€æ¡æ•°æ®ï¼š
![å¾®ä¿¡å°ç¨‹åº27](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº27.png)

å¦‚æœæƒ³å°†è¿™ä¸ªæ•°æ®ä¸­çš„ `dic` å˜æˆ `{ "key": "æµ‹è¯•å¯¹è±¡" } `ï¼Œé‚£ä¹ˆé€šè¿‡ä¼ ç»Ÿçš„æ–¹å¼æ˜¯æ— æ³•å®ç°çš„ï¼š
```
db.collection("test").doc("b00064a760741e750e1185f2595e14a6").update({
  data: {
    dic: {
      "key": "æµ‹è¯•å¯¹è±¡"
    }
  }
}).then(res => {
  console.log(res)
})
```

ä¸Šé¢è¿™ç§æ–¹å¼ï¼Œåªèƒ½å°† `dic.key` æ”¹æˆâ€œæµ‹è¯•å¯¹è±¡â€ï¼Œå³ `dic == { key: "æµ‹è¯•å¯¹è±¡", key02: "æµ‹è¯•å¯¹è±¡03" }`ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `_.set` æ–¹æ³•ï¼š
```
db.collection("test").doc("b00064a760741e750e1185f2595e14a6").update({
  data: {
    dic: _.set({
      key: "æµ‹è¯•å¯¹è±¡"
    })
  }
}).then(res => {
  console.log(res);
})
```

![å¾®ä¿¡å°ç¨‹åº28](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº28.png)

##### command.remove
æ›´æ–°æŒ‡ä»¤ã€‚ç”¨äºè¡¨ç¤ºåˆ é™¤æŸä¸ªå­—æ®µã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³å°†authorè¿™ä¸ªå­—æ®µåˆ é™¤ï¼Œé‚£ä¹ˆå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```
db.collection("test").doc("b00064a760741e750e1185f2595e14a6").update({
  data: {
    dic: _.remove()
  }
}).then(res => {
  console.log(res);
})
```

![å¾®ä¿¡å°ç¨‹åº29](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº29.png)

##### command.inc
æ›´æ–°æŒ‡ä»¤ã€‚ç”¨äºæŒ‡ç¤ºå­—æ®µè‡ªå¢æŸä¸ªå€¼ï¼Œè¿™æ˜¯ä¸ªåŸå­æ“ä½œï¼Œä½¿ç”¨è¿™ä¸ªæ“ä½œæŒ‡ä»¤è€Œä¸æ˜¯å…ˆè¯»æ•°æ®ã€å†åŠ ã€å†å†™å›çš„å¥½å¤„æ˜¯ï¼š

åŸå­æ€§ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶å†™ï¼Œå¯¹æ•°æ®åº“æ¥è¯´éƒ½æ˜¯å°†å­—æ®µåŠ ä¸€ï¼Œä¸ä¼šæœ‰åæ¥è€…è¦†å†™å‰è€…çš„æƒ…å†µã€‚
å‡å°‘ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼šä¸éœ€å…ˆè¯»å†å†™ã€‚
æ¯”å¦‚ `test` é›†åˆä¸­çš„ä¸€æ¡æ•°æ®åŠ ä¸€ä¸ª `read_count` å­—æ®µï¼Œç»™è¿™ä¸ªå­—æ®µåŠ 1ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®ç°ï¼š
```
db.collection("test").doc("b00064a760741e750e1185f2595e14a6").update({
  data: {
    read_count: _.inc(1)
  }
})
```

è¿è¡Œä¸¤æ¬¡ï¼š
![å¾®ä¿¡å°ç¨‹åº30](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº30.png)

##### command.mul
è‡ªä¹˜æŒ‡ä»¤ï¼Œè·Ÿ `command.inc` ä¸€æ ·ã€‚

##### command.push
æ›´æ–°æŒ‡ä»¤ï¼Œå¯¹ä¸€ä¸ªå€¼ä¸ºæ•°ç»„çš„å­—æ®µï¼Œå¾€æ•°ç»„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚å¦‚æœè¯¥å­—æ®µåŸä¸ºç©ºï¼Œåˆ™åˆ›å»ºè¯¥å­—æ®µå¹¶è®¾æ•°ç»„ä¸ºä¼ å…¥å€¼ã€‚  
æ¯”å¦‚è¦ç»™ `test` é›†åˆä¸­çš„æŸæ¡æ•°æ®æ·»åŠ æ ‡ç­¾ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥å®ç°ï¼š
```
db.collection("test").doc("b00064a760741e750e1185f2595e14a6").update({
  data: {
    tags: _.push(["æ–°é—»"])
  }
})
```

![å¾®ä¿¡å°ç¨‹åº31](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº31.png)

##### command.pop
æ›´æ–°æŒ‡ä»¤ï¼Œå¯¹ä¸€ä¸ªå€¼ä¸ºæ•°ç»„çš„å­—æ®µï¼Œå°†æ•°ç»„å°¾éƒ¨å…ƒç´ åˆ é™¤ã€‚

##### command.shift
æ›´æ–°æŒ‡ä»¤ï¼Œå¯¹ä¸€ä¸ªå€¼ä¸ºæ•°ç»„çš„å­—æ®µï¼Œå°†æ•°ç»„å¤´éƒ¨å…ƒç´ åˆ é™¤ã€‚

##### command.unshift
æ›´æ–°æŒ‡ä»¤ï¼Œå¯¹ä¸€ä¸ªå€¼ä¸ºæ•°ç»„çš„å­—æ®µï¼Œå¾€æ•°ç»„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚å¦‚æœè¯¥å­—æ®µåŸä¸ºç©ºï¼Œåˆ™åˆ›å»ºè¯¥å­—æ®µå¹¶è®¾æ•°ç»„ä¸ºä¼ å…¥å€¼ã€‚

### é«˜çº§æŸ¥è¯¢
#### collection.count
ç»Ÿè®¡é›†åˆè®°å½•æ•°æˆ–ç»Ÿè®¡æŸ¥è¯¢è¯­å¥å¯¹åº”çš„ç»“æœè®°å½•æ•°ï¼Œæ³¨æ„è¿™ä¸é›†åˆæƒé™è®¾ç½®æœ‰å…³ï¼Œä¸€ä¸ªç”¨æˆ·ä»…èƒ½ç»Ÿè®¡å…¶æœ‰è¯»æƒé™çš„è®°å½•æ•°ã€‚æ¯”å¦‚æŸ¥æ‰¾æ‰€æœ‰ç”±â€œæµ‹è¯•ä½œè€…03â€å‘å¸ƒçš„æ•°æ®çš„ä¸ªæ•°ï¼š
```
db.collection("test").where({
  author: "æµ‹è¯•ä½œè€…03"
}).count().then(res => {
  console.log(res)
})
```

![å¾®ä¿¡å°ç¨‹åº32](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº32.png)

#### collection.orderBy
è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š
1. ä¸€ä¸ªå¿…å¡«å­—ç¬¦ä¸²å‚æ•° `fieldName` ç”¨äºå®šä¹‰éœ€è¦æ’åºçš„å­—æ®µï¼›
2. ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•° `order` å®šä¹‰æ’åºé¡ºåºï¼Œ`order` åªèƒ½å– `asc` æˆ– `desc`ã€‚

æ³¨æ„ï¼š
1. å¦‚æœéœ€è¦å¯¹åµŒå¥—å­—æ®µæ’åºï¼Œéœ€è¦ç”¨ "ç‚¹è¡¨ç¤ºæ³•" è¿æ¥åµŒå¥—å­—æ®µï¼Œæ¯”å¦‚ `author.age` è¡¨ç¤ºå­—æ®µ `author` é‡Œçš„åµŒå¥—å­—æ®µ `age`ã€‚
2. åŒæ—¶ä¹Ÿæ”¯æŒæŒ‰å¤šä¸ªå­—æ®µæ’åºï¼Œå¤šæ¬¡è°ƒç”¨ `orderBy` å³å¯ï¼Œå¤šå­—æ®µæ’åºæ—¶çš„é¡ºåºä¼šæŒ‰ç…§ `orderBy` è°ƒç”¨é¡ºåºå…ˆåå¯¹å¤šä¸ªå­—æ®µæ’åºã€‚

æ¯”å¦‚é€šè¿‡â€œé˜…è¯»é‡â€ä»å¤§åˆ°å°ä»¥åŠâ€œä½œè€…çš„å¹´é¾„â€ä»å°åˆ°å¤§è¿›è¡Œæ’åºã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å®ç°ï¼š
```
orderBy: function (options) {
  db.collection("test")
  .orderBy("read_count", "desc")
  .orderBy("author.age", "asc")
  .get()
  .then(res => {
    console.log(res);
  })
}
```

æ²¡æœ‰æŒ‡å®šå­—æ®µçš„æ•°æ®ä¹Ÿä¼šè¿”å›å¹¶ä¸”é»˜è®¤æ’åœ¨åé¢ï¼š
![å¾®ä¿¡å°ç¨‹åº33](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº33.png)

#### collection.limit
æŒ‡å®šæŸ¥è¯¢ç»“æœé›†æ•°é‡ä¸Šé™ã€‚æ¯”å¦‚ä¸€æ¬¡æ€§è·å–10ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥å®ç°ï¼š
```
limit: function (options) {
  db.collection("test").limit(10)
  .get()
  .then(res => {
    console.log(res);
  })
}
```

![å¾®ä¿¡å°ç¨‹åº34](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº34.png)

#### collection.skip
æŒ‡å®šæŸ¥è¯¢è¿”å›ç»“æœæ—¶ä»æŒ‡å®šåºåˆ—åçš„ç»“æœå¼€å§‹è¿”å›ï¼Œå¸¸ç”¨äºåˆ†é¡µã€‚æ¯”å¦‚è·³è¿‡å‰é¢4ç¯‡æ–‡ç« ï¼Œä»ç¬¬11ç¯‡å¼€å§‹è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
skip: function (options) {
  db.collection("test").skip(4)
  .get()
  .then(res => {
    console.log(res);
  })
}
```

![å¾®ä¿¡å°ç¨‹åº35](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº35.png)

#### collection.field
æŒ‡å®šè¿”å›ç»“æœä¸­è®°å½•éœ€è¿”å›çš„å­—æ®µã€‚æ¯”å¦‚åªæƒ³è·å– `test` æ–‡ç« ä¸­çš„ `author` å­—æ®µã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å®ç°ï¼š
```
field: function (options) {
  db.collection("test").field({
    read_count: true
  }).get().then(res => {
    console.log(res)
  })
}
```

ç»“æœæ˜¾ç¤ºï¼Œå¦‚æœæ•°æ®ä¸­æ²¡æœ‰æŒ‡å®šçš„å­—æ®µä¹Ÿä¼šè¿”å›ï¼š
![å¾®ä¿¡å°ç¨‹åº36](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº36.png)

## æ–‡ä»¶ç®¡ç†
å°ç¨‹åºæ–‡ä»¶ç®¡ç†å®˜æ–¹æ–‡æ¡£ï¼š[æ–‡ä»¶](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.saveFile.html)ã€‚

### wx.saveFile(Object object)  
ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°ã€‚æ³¨æ„ï¼šsaveFile ä¼šæŠŠä¸´æ—¶æ–‡ä»¶ç§»åŠ¨ï¼Œå› æ­¤è°ƒç”¨æˆåŠŸåä¼ å…¥çš„ tempFilePath å°†ä¸å¯ç”¨
```
/**
 * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢æ˜¾ç¤º
 */
onShow: function () {
  wx.chooseImage({
    success: function (res) {
      const tempFilePaths = res.tempFilePaths
      wx.saveFile({
        tempFilePath: tempFilePaths[0],
        success (res) {
          const savedFilePath = res.saveFile;
          console.log(res)
        }
      })
    }
  })
},
```

## äº‘å‡½æ•°
### nodeç¯å¢ƒæ­å»º
å› ä¸ºäº‘å‡½æ•°åœ¨æœåŠ¡å™¨ä¸Šæ˜¯è¿è¡Œåœ¨ node.js ç¯å¢ƒä¸­çš„ï¼Œå¹¶ä¸”äº‘å‡½æ•°ä¼šç”¨åˆ°ä¸€äº›ç¬¬ä¸‰æ–¹åº“ã€‚å…ˆåœ¨æœ¬åœ°ç¼–å†™å¥½ï¼Œå†æäº¤åˆ°äº‘æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœ¬åœ°ä¹Ÿéœ€è¦å®‰è£…å¥½ä¸€å¥— node.js ç¯å¢ƒã€‚åŸåˆ™ä¸Šï¼Œæœ¬åœ°çš„ node.js ç‰ˆæœ¬åº”è¯¥è·Ÿäº‘æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¸€è‡´ã€‚

### åˆå§‹åŒ–ç¯å¢ƒ
åœ¨ä»¥ä¸Šæ–‡ä»¶å¤¹ä¸­ï¼Œå³é”®->åˆå§‹åŒ–ç¯å¢ƒï¼š
![å¾®ä¿¡å°ç¨‹åº37](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº37.png)

### åˆ›å»ºäº‘å‡½æ•°
åœ¨ `cloudfunctions` æ–‡ä»¶å¤¹ä¸Šï¼Œå³é”®->åˆ›å»ºäº‘å‡½æ•°ï¼Œå¡«å…¥äº‘å‡½æ•°çš„åç§°ï¼Œç„¶åç‚¹å‡»ç¡®å®šå³å¯åˆ›å»ºå¥½ã€‚ç„¶åå°±å¯ä»¥åœ¨ç›¸åº”çš„ `index.js` æ–‡ä»¶ä¸­å†™ä»£ç äº†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk')

cloud.init()

// äº‘å‡½æ•°å…¥å£å‡½æ•°
exports.main = async (event, context) => {
  const x = event.x;
  const y = event.y;

  return {
    result: x + y
  }
}
```

### ä¸Šä¼ å’Œéƒ¨ç½²
åœ¨æœ¬åœ°åˆ›å»ºå®Œäº‘å‡½æ•°åï¼Œéœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶éƒ¨ç½²ã€‚åªéœ€è¦åœ¨ç›¸åº”å‡½æ•°çš„æ–‡ä»¶å¤¹ä¸Šï¼šå³é”® -> ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ã€‚
![å¾®ä¿¡å°ç¨‹åº38](å¾®ä¿¡å°ç¨‹åº/å¾®ä¿¡å°ç¨‹åº38.png)

### åœ¨äº‘å‡½æ•°ä¸­æ“ä½œæ•°æ®åº“
åœ¨äº‘å‡½æ•°ä¸­æ“ä½œæ•°æ®åº“ã€æ–‡ä»¶ç­‰ï¼Œå¯ä»¥é€šè¿‡ `wx-server-sdk` å®ç°ã€‚è¿™ä¸ª sdk ä¸å°ç¨‹åºç«¯çš„ API æœ‰ä»¥ä¸‹ä¸¤ç‚¹ä¸åŒï¼š
1. æœåŠ¡ç«¯çš„ API ä»…æ”¯æŒ Promise é£æ ¼è°ƒç”¨ã€‚
2. æœåŠ¡ç«¯ API å¯ä»¥è¿›è¡Œæ‰¹é‡çš„ update å’Œ remove æ“ä½œã€‚

è·å–å¾®åšæ•°æ®ç¤ºä¾‹ï¼š
```
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk')
cloud.init()

// æ•°æ®åº“
const db = cloud.database();

// äº‘å‡½æ•°å…¥å£å‡½æ•°
exports.main = async (event, context) => {
  // è·å–å¾®ä¿¡è°ƒç”¨ä¸Šä¸‹æ–‡
  const wxContext = cloud.getWXContext()
  // å°ç¨‹åºç”¨æˆ· openid
  const openId = wxContext.OPENID;

  const start = event.start;
  // è·å– weibo é›†åˆ
  let promise = db.collection("weibo");
  if (start > 0) {
    promise = promise.skip(start);
  }
  // å¼‚æ­¥è·å–10è°ƒå¾®åšæ•°æ®ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´ï¼Œå€’åº
  const weiboRes = await promise.limit(10).orderBy("create_time", "desc").get()
  const weibos = weiboRes.data;
  if(weibos.length > 0){
    weibos.forEach((weibo,index) => {
      weibo.isPraised = false;
      if(weibo.praises && weibo.praises.length > 0){
        weibo.praises.forEach((praise,index) => {
          if(praise == openId){
            weibo.isPraised = true;
          }
        })
      }
    })
  }
  // è¿”å›æ•°æ®
  return {
    weibos
  }
}
```

