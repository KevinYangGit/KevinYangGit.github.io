<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="OCåº•å±‚åŸç†," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="æ€è€ƒï¼š  è®²ä¸€ä¸‹ OC çš„æ¶ˆæ¯æœºåˆ¶ æ¶ˆæ¯è½¬å‘æœºåˆ¶æµç¨‹ ä»€ä¹ˆæ˜¯ Runtimeï¼Ÿå¹³æ—¶é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ä¹ˆï¼Ÿ Runtime çš„å…·ä½“åº”ç”¨">
<meta name="keywords" content="OCåº•å±‚åŸç†">
<meta property="og:type" content="article">
<meta property="og:title" content="Runtime">
<meta property="og:url" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/index.html">
<meta property="og:site_name" content="Kevin&#39;s  blog">
<meta property="og:description" content="æ€è€ƒï¼š  è®²ä¸€ä¸‹ OC çš„æ¶ˆæ¯æœºåˆ¶ æ¶ˆæ¯è½¬å‘æœºåˆ¶æµç¨‹ ä»€ä¹ˆæ˜¯ Runtimeï¼Ÿå¹³æ—¶é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ä¹ˆï¼Ÿ Runtime çš„å…·ä½“åº”ç”¨">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime01.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime02.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime05.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime04.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime06.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime07.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime03.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime08.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime09.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime10.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime11.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime12.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime17.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime18.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime13.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime14.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime19.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime15.png">
<meta property="og:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime16.png">
<meta property="og:updated_time" content="2020-06-21T07:03:03.701Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Runtime">
<meta name="twitter:description" content="æ€è€ƒï¼š  è®²ä¸€ä¸‹ OC çš„æ¶ˆæ¯æœºåˆ¶ æ¶ˆæ¯è½¬å‘æœºåˆ¶æµç¨‹ ä»€ä¹ˆæ˜¯ Runtimeï¼Ÿå¹³æ—¶é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ä¹ˆï¼Ÿ Runtime çš„å…·ä½“åº”ç”¨">
<meta name="twitter:image" content="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/"/>





  <title>Runtime | Kevin's  blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kevin's  blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/12/OCåº•å±‚/åŸç†/Runtime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kevin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/myAvatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kevin's  blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Runtime</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-06-12T18:27:54+08:00">
                2020-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>æ€è€ƒï¼š</p>
<ul>
<li>è®²ä¸€ä¸‹ OC çš„æ¶ˆæ¯æœºåˆ¶</li>
<li>æ¶ˆæ¯è½¬å‘æœºåˆ¶æµç¨‹</li>
<li>ä»€ä¹ˆæ˜¯ Runtimeï¼Ÿå¹³æ—¶é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ä¹ˆï¼Ÿ</li>
<li>Runtime çš„å…·ä½“åº”ç”¨</li>
</ul>
<a id="more"></a>
<ul>
<li><p>æ‰“å°ç»“æœåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ‰“å°1</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></div><div class="line">- (<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"[self class] = %@"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>]);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"[super class] = %@"</span>, [<span class="keyword">super</span> <span class="keyword">class</span>]);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"[self superclass] = %@"</span>, [<span class="keyword">self</span> superclass]);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"[super superclass] = %@"</span>, [<span class="keyword">super</span> superclass]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">//æ‰“å°2</span></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        <span class="built_in">BOOL</span> res1 = [[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</div><div class="line">        <span class="built_in">BOOL</span> res2 = [[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</div><div class="line">        <span class="built_in">BOOL</span> res3 = [[Person <span class="keyword">class</span>] isKindOfClass:[Person <span class="keyword">class</span>]];</div><div class="line">        <span class="built_in">BOOL</span> res4 = [[Person <span class="keyword">class</span>] isMemberOfClass:[Person <span class="keyword">class</span>]];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%d %d %d %d"</span>, res1, res2, res3, res4);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ä»¥ä¸‹ä»£ç èƒ½ä¸èƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿå¦‚æœå¯ä»¥ï¼Œæ‰“å°ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line">- (<span class="keyword">void</span>)print;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">void</span>)print &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"my name's %@"</span>, <span class="keyword">self</span>.name);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="keyword">id</span> cls = [Person <span class="keyword">class</span>];</div><div class="line">    <span class="keyword">void</span> *obj = &amp;cls;</div><div class="line">    [(__bridge <span class="keyword">id</span>)obj print];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>Objective-C æ˜¯ä¸€é—¨åŠ¨æ€æ€§æ¯”è¾ƒå¼ºçš„ç¼–ç¨‹è¯­è¨€ï¼Œè·Ÿ Cã€C++ ç­‰è¯­è¨€æœ‰ç€å¾ˆå¤§çš„ä¸åŒï¼ŒObjective-C çš„åŠ¨æ€æ€§æ˜¯ç”± Runtime API æ¥æ”¯æ’‘çš„ï¼ŒRuntime API æä¾›çš„æ¥å£åŸºæœ¬éƒ½æ˜¯ C è¯­è¨€çš„ï¼Œæºç ç”± C\C++\æ±‡ç¼–è¯­è¨€ ç¼–å†™ã€‚</p>
<h1 id="isa-è¯¦è§£"><a href="#isa-è¯¦è§£" class="headerlink" title="isa è¯¦è§£"></a>isa è¯¦è§£</h1><p>å­¦ä¹  Runtimeï¼Œé¦–å…ˆè¦äº†è§£å®ƒåº•å±‚çš„ä¸€äº›å¸¸ç”¨æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ isa æŒ‡é’ˆã€‚åœ¨ arm64 æ¶æ„ä¹‹å‰ï¼Œisa å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æŒ‡é’ˆï¼Œå­˜å‚¨ç€ Classã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ä» arm64 æ¶æ„å¼€å§‹ï¼Œå¯¹ isa è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå˜æˆäº†ä¸€ä¸ªå…±ç”¨ä½“ï¼ˆunionï¼‰ç»“æ„ï¼Œè¿˜ä½¿ç”¨ä½åŸŸæ¥å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">getter</span>=isTall) <span class="built_in">BOOL</span> tall;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">getter</span>=isRich) <span class="built_in">BOOL</span> rich;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">getter</span>=isHandsome) <span class="built_in">BOOL</span> handsome;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        person.tall = <span class="literal">YES</span>;</div><div class="line">        person.rich = <span class="literal">YES</span>;</div><div class="line">        person.handsome = <span class="literal">YES</span>;</div><div class="line">        </div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"tallï¼š%d, richï¼š%d, handsomeï¼š%d"</span>, person.isTall, person.isRich, person.isHandsome);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"personçš„å¤§å°ï¼š%zd"</span>, class_getInstanceSize([person <span class="keyword">class</span>]));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">1</span>, richï¼š<span class="number">1</span>, handsomeï¼š<span class="number">1</span></div><div class="line">personçš„å¤§å°ï¼š<span class="number">16</span></div></pre></td></tr></table></figure></p>
<p>tallï¼ˆ1ä¸ªå­—èŠ‚ï¼‰+ richï¼ˆ1ä¸ªå­—èŠ‚ï¼‰+ handsomeï¼ˆ1ä¸ªå­—èŠ‚ï¼‰+ isaï¼ˆ8ä¸ªå­—èŠ‚ï¼‰= 11ä¸ªå­—èŠ‚ã€‚æ ¹æ®å†…å­˜å¯¹é½åŸåˆ™ï¼Œperson çš„å†…å­˜å¤§å°æ˜¯16ä¸ªå­—èŠ‚ã€‚</p>
<p>å› ä¸º tallã€rich å’Œ handsome éƒ½æ˜¯ BOOL ç±»å‹ï¼Œå®ƒä»¬çš„å€¼åªæœ‰0å’Œ1ï¼Œæ‰€ä»¥å¯ä»¥ç”¨3ä¸ªäºŒè¿›åˆ¶ä½æ¥å­˜å‚¨ä»–ä»¬çš„å€¼ã€‚</p>
<h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>å®šä¹‰ä¸€ä¸ª char ç±»å‹çš„å˜é‡ _tallRichHandsome ç”¨æ¥å­˜å‚¨3ä¸ª BOOL ç±»å‹å˜é‡çš„å€¼ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span>()</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> _tallRichHandsome; <span class="comment">//0b 0000 0000</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>_tallRichHandsome å 1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼š<code>0b 0000 0000</code>ï¼‰ï¼Œè®©å®ƒæœ€å³è¾¹çš„3ä½ï¼ˆ<code>0b00000111</code>ï¼‰åˆ†åˆ«å­˜å‚¨ tallã€rich å’Œ handsomeï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span>b <span class="number">0000</span> <span class="number">0111</span> <span class="comment">//_tallRichHandsomeï¼ˆtallï¼šYES, richï¼šYES, handsomeï¼šYESï¼‰</span></div><div class="line"></div><div class="line"><span class="number">0</span>b <span class="number">0000</span> <span class="number">0001</span> <span class="comment">//tall</span></div><div class="line"><span class="number">0</span>b <span class="number">0000</span> <span class="number">0010</span> <span class="comment">//rich</span></div><div class="line"><span class="number">0</span>b <span class="number">0000</span> <span class="number">0100</span> <span class="comment">//handsome</span></div></pre></td></tr></table></figure></p>
<h3 id="å–å€¼"><a href="#å–å€¼" class="headerlink" title="å–å€¼"></a>å–å€¼</h3><ul>
<li>æŒ‰ä½ä¸è¿ç®—ç¬¦ï¼ˆ<code>&amp;</code>ï¼‰<br>å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªæ•°æ®ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½è¿›è¡Œâ€œä¸â€è¿ç®—ã€‚<br>è¿ç®—è§„åˆ™ï¼š<code>0&amp;0=0</code>ï¼Œ<code>0&amp;1=0</code>ï¼Œ<code>1&amp;0=0</code>ï¼Œ<code>1&amp;1=1</code>ã€‚<br>æ€»ç»“ï¼šä¸¤ä½åŒæ—¶ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0ã€‚ </li>
</ul>
<p>å› ä¸ºâ€ä¸â€è¿ç®—å¯ä»¥è·å–åˆ°ç‰¹å®šä½çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡â€œä¸â€è¿ç®—åˆ†åˆ«è·å–ä¸‰ä¸ªå˜é‡çš„å€¼ï¼š</p>
<p>åˆå§‹åŒ– _tallRichHandsome<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_tallRichHandsome = <span class="number">0b00000101</span>; //ï¼ˆtallï¼šYES, richï¼šNO, handsomeï¼šYESï¼‰</div></pre></td></tr></table></figure></p>
<p>è·å– tallï¼ˆ<code>_tallRichHandsome &amp; 0b00000001</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000101</span></div><div class="line">&amp; <span class="number">0b00000001</span></div><div class="line">-------------</div><div class="line">  <span class="number">0b00000001</span></div></pre></td></tr></table></figure></p>
<p>è·å– richï¼ˆ<code>_tallRichHandsome &amp; 0b00000010</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000101</span></div><div class="line">&amp; <span class="number">0b00000010</span></div><div class="line">-------------</div><div class="line">  <span class="number">0b00000000</span></div></pre></td></tr></table></figure></p>
<p>è·å– handsomeï¼ˆ<code>_tallRichHandsome &amp; 0b00000100</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000101</span></div><div class="line">&amp; <span class="number">0b00000100</span></div><div class="line">-------------</div><div class="line">  <span class="number">0b00000100</span></div></pre></td></tr></table></figure></p>
<p>ä»£ç å®ç°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="built_in">BOOL</span>)isTall;</div><div class="line">- (<span class="built_in">BOOL</span>)isRich;</div><div class="line">- (<span class="built_in">BOOL</span>)isHandsome;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span>()</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> _tallRichHandsome;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _tallRichHandsome = <span class="number">0</span>b00000101;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isTall &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome &amp; <span class="number">1</span>); <span class="comment">//1ï¼ˆåè¿›åˆ¶ï¼‰== 0b 0000 0001ï¼ˆäºŒè¿›åˆ¶ï¼‰</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isRich &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome &amp; <span class="number">2</span>); <span class="comment">//2ï¼ˆåè¿›åˆ¶ï¼‰== 0b 0000 0010ï¼ˆäºŒè¿›åˆ¶ï¼‰</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isHandsome &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome &amp; <span class="number">4</span>); <span class="comment">//4ï¼ˆåè¿›åˆ¶ï¼‰== 0b 0000 0100ï¼ˆäºŒè¿›åˆ¶ï¼‰</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"tallï¼š%d, richï¼š%d, handsomeï¼š%d"</span>, person.isTall, person.isRich, person.isHandsome);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">1</span>, richï¼š<span class="number">0</span>, handsomeï¼š<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>å› ä¸ºè¿”å›çš„æ˜¯ BOOL ç±»å‹ï¼Œè€Œâ€œä¸â€è¿ç®—å–å‡ºçš„æ˜¯æœ‰å€¼ï¼ˆ<code>0b00000001</code>ã€<code>0b00000100</code>ï¼‰å’Œ0ï¼ˆ<code>0b00000000</code>ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åœ¨â€œä¸â€è¿ç®—çš„ç»“æœå‰åŠ <code>!!</code>å–åä¸¤æ¬¡ï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">!(<span class="number">0b00000000</span>)   YES</div><div class="line">!!(<span class="number">0b00000000</span>)  NO   //!!(_tallRichHandsome &amp; <span class="number">2</span>)</div><div class="line"> </div><div class="line">!(<span class="number">0b00000001</span>)   NO</div><div class="line">!!(<span class="number">0b00000001</span>)  YES  //!!(_tallRichHandsome &amp; <span class="number">1</span>)</div><div class="line"></div><div class="line">!(<span class="number">0b00000100</span>)   NO</div><div class="line">!!(<span class="number">0b00000100</span>)  YES  //!!(_tallRichHandsome &amp; <span class="number">4</span>)</div></pre></td></tr></table></figure></p>
<h3 id="æ©ç "><a href="#æ©ç " class="headerlink" title="æ©ç "></a>æ©ç </h3><p>ä¸Šé¢ğŸ‘†çš„å®ç°å¤ªæŠ½è±¡ï¼Œå¯ä»¥ä½¿ç”¨æ©ç å¢åŠ å¯è¯»æ€§ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TallMask 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RichMask 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HandsomeMask 4</span></div></pre></td></tr></table></figure></p>
<p>ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶å®šä¹‰æ©ç ä¼šæ›´ç›´è§‚ï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#<span class="built_in">define</span> TallMask <span class="number">0b00000001</span></div><div class="line">#<span class="built_in">define</span> RichMask <span class="number">0b00000010</span></div><div class="line">#<span class="built_in">define</span> HandsomeMask <span class="number">0b00000100</span></div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ä½ç§»è¿ç®—ç¬¦ï¼Œç®€åŒ–ä»£ç ï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#<span class="built_in">define</span> TallMask (<span class="number">1</span>&lt;&lt;<span class="number">0</span>)     //å·¦ç§»<span class="number">0</span>ä½ï¼š<span class="number">0b00000001</span>ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ<span class="number">1</span>ï¼ˆåè¿›åˆ¶ï¼‰</div><div class="line">#<span class="built_in">define</span> RichMask (<span class="number">1</span>&lt;&lt;<span class="number">1</span>)     //å·¦ç§»<span class="number">1</span>ä½ï¼š<span class="number">0b00000010</span>ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ<span class="number">2</span>ï¼ˆåè¿›åˆ¶ï¼‰</div><div class="line">#<span class="built_in">define</span> HandsomeMask (<span class="number">1</span>&lt;&lt;<span class="number">2</span>) //å·¦ç§»<span class="number">2</span>ä½ï¼š<span class="number">0b00000100</span>ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ<span class="number">4</span>ï¼ˆåè¿›åˆ¶ï¼‰</div></pre></td></tr></table></figure></p>
<ul>
<li>å·¦ç§»è¿ç®—ç¬¦ï¼ˆ<code>&lt;&lt;</code>ï¼‰<br>å®šä¹‰ï¼šå°†ä¸€ä¸ªè¿ç®—å¯¹è±¡çš„å„äºŒè¿›åˆ¶ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼ˆå·¦è¾¹çš„äºŒè¿›åˆ¶ä½ä¸¢å¼ƒï¼Œå³è¾¹è¡¥0ï¼‰ã€‚</li>
</ul>
<p>æœ€ç»ˆå®ç°ï¼š<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#define</span> <span class="selector-tag">TallMask</span> (<span class="number">1</span>&lt;&lt;<span class="number">0</span>)</div><div class="line"><span class="selector-id">#define</span> <span class="selector-tag">RichMask</span> (<span class="number">1</span>&lt;&lt;<span class="number">1</span>)</div><div class="line"><span class="selector-id">#define</span> <span class="selector-tag">HandsomeMask</span> (<span class="number">1</span>&lt;&lt;<span class="number">2</span>)</div><div class="line"></div><div class="line">@<span class="selector-tag">implementation</span> <span class="selector-tag">Person</span></div><div class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">isTall</span> &#123;</div><div class="line">    <span class="selector-tag">return</span> !!(_tallRichHandsome &amp; TallMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">isRich</span> &#123;</div><div class="line">    <span class="selector-tag">return</span> !!(_tallRichHandsome &amp; RichMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">isHandsome</span> &#123;</div><div class="line">    <span class="selector-tag">return</span> !!(_tallRichHandsome &amp; HandsomeMask);</div><div class="line">&#125;</div><div class="line">@<span class="selector-tag">end</span></div></pre></td></tr></table></figure></p>
<h3 id="è®¾å€¼"><a href="#è®¾å€¼" class="headerlink" title="è®¾å€¼"></a>è®¾å€¼</h3><ul>
<li><p>æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼ˆ<code>|</code>ï¼‰<br>å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½è¿›è¡Œâ€œæˆ–â€è¿ç®—ã€‚<br>è¿ç®—è§„åˆ™ï¼š<code>0|0=0</code>ï¼Œ<code>0|1=1</code>ï¼Œ<code>1|0=1</code>ï¼Œ<code>1|1=1</code>ã€‚<br>æ€»ç»“ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªå¯¹è±¡åªè¦æœ‰ä¸€ä¸ªä¸º1ï¼Œå…¶å€¼ä¸º1ã€‚</p>
</li>
<li><p>å–åè¿ç®—ç¬¦ (<code>~</code>)<br>å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸€ä¸ªæ•°æ®ï¼ŒæŒ‰äºŒè¿›åˆ¶è¿›è¡Œâ€œå–åâ€è¿ç®—ã€‚<br>è¿ç®—è§„åˆ™ï¼š<code>~1=0</code>ï¼Œ<code>~0=1</code>ã€‚<br>æ€»ç»“ï¼šå¯¹ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æŒ‰ä½å–åï¼Œå³å°†0å˜1ï¼Œ1å˜0ã€‚</p>
</li>
</ul>
<p>è®¾ç½® YES æ—¶ï¼Œè·Ÿ _tallRichHandsome è¿›è¡ŒæŒ‰ä½â€œæˆ–â€è¿ç®—ï¼Œä¿®æ”¹ç‰¹å®šä½ç½®çš„å€¼ã€‚<br>è®¾ç½® NO æ—¶ï¼Œå…ˆå¯¹ rich çš„äºŒè¿›åˆ¶æ•°æŒ‰ä½å–åï¼Œå†è·Ÿ _tallRichHandsome è¿›è¡ŒæŒ‰ä½â€œä¸â€è¿ç®—ã€‚</p>
<p>åˆå§‹åŒ– _tallRichHandsome<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_tallRichHandsome = <span class="number">0b00000010</span>; //ï¼ˆtallï¼šNO, richï¼šYES, handsomeï¼šNOï¼‰</div></pre></td></tr></table></figure></p>
<p>è®¾ç½® tall ä¸º YESï¼ˆ<code>_tallRichHandsome |= 0b00000001</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000010</span></div><div class="line">| <span class="number">0b00000001</span></div><div class="line">-------------</div><div class="line">  <span class="number">0b00000011</span></div></pre></td></tr></table></figure></p>
<p>è®¾ç½® rich ä¸º NOï¼ˆ<code>_tallRichHandsome &amp;= ~0b00000010</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000010</span></div><div class="line">&amp; <span class="number">0b11111101</span>  //~<span class="number">0b00000010</span>ï¼ˆæŒ‰ä½å–åï¼‰ </div><div class="line">-------------</div><div class="line">  <span class="number">0b00000000</span></div></pre></td></tr></table></figure></p>
<p>è®¾ç½® handsome ä¸º YESï¼ˆ<code>_tallRichHandsome |= 0b00000001</code>ï¼‰<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b00000010</span></div><div class="line">| <span class="number">0b00000100</span></div><div class="line">-------------</div><div class="line">  <span class="number">0b00000110</span></div></pre></td></tr></table></figure></p>
<p>ä»£ç å®ç°ï¼š<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">@interface Person : NSObject</div><div class="line">- (<span class="keyword">void</span>)setTall:(BOOL)tall;</div><div class="line">- (<span class="keyword">void</span>)setRich:(BOOL)rich;</div><div class="line">- (<span class="keyword">void</span>)setHandsome:(BOOL)handsome;</div><div class="line">- (BOOL)isTall;</div><div class="line">- (BOOL)isRich;</div><div class="line">- (BOOL)isHandsome;</div><div class="line">@<span class="built_in">end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TallMask (1&lt;&lt;0)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RichMask (1&lt;&lt;1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HandsomeMask (1&lt;&lt;2)</span></div><div class="line"></div><div class="line"></div><div class="line">@interface Person()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> _tallRichHandsome;</div><div class="line">&#125;</div><div class="line">@<span class="built_in">end</span></div><div class="line"></div><div class="line">@implementation Person</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTall:(BOOL)tall &#123;</div><div class="line">    <span class="built_in">if</span> (tall) &#123;</div><div class="line">        _tallRichHandsome |= TallMask;</div><div class="line">    &#125; <span class="built_in">else</span> &#123;</div><div class="line">        _tallRichHandsome &amp;= ~TallMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setRich:(BOOL)rich &#123;</div><div class="line">    <span class="built_in">if</span> (rich) &#123;</div><div class="line">        _tallRichHandsome |= RichMask;</div><div class="line">    &#125; <span class="built_in">else</span> &#123;</div><div class="line">        _tallRichHandsome &amp;= ~RichMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHandsome:(BOOL)handsome &#123;</div><div class="line">    <span class="built_in">if</span> (handsome) &#123;</div><div class="line">        _tallRichHandsome |= HandsomeMask;</div><div class="line">    &#125; <span class="built_in">else</span> &#123;</div><div class="line">        _tallRichHandsome &amp;= ~HandsomeMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isTall &#123;</div><div class="line">    <span class="built_in">return</span> !!(_tallRichHandsome &amp; TallMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isRich &#123;</div><div class="line">    <span class="built_in">return</span> !!(_tallRichHandsome &amp; RichMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isHandsome &#123;</div><div class="line">    <span class="built_in">return</span> !!(_tallRichHandsome &amp; HandsomeMask);</div><div class="line">&#125;</div><div class="line">@<span class="built_in">end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        person.tall = YES;</div><div class="line">        person.rich = NO;</div><div class="line">        person.handsome = YES;</div><div class="line">        NSLog(@<span class="string">"tallï¼š%d, richï¼š%d, handsomeï¼š%d"</span>, person.isTall, person.isRich, person.isHandsome);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">1</span>, richï¼š<span class="number">0</span>, handsomeï¼š<span class="number">1</span></div></pre></td></tr></table></figure></p>
<h2 id="ä½åŸŸ"><a href="#ä½åŸŸ" class="headerlink" title="ä½åŸŸ"></a>ä½åŸŸ</h2><p>ä½åŸŸï¼ŒC è¯­è¨€å…è®¸åœ¨ä¸€ä¸ªç»“æ„ä½“ä¸­ä»¥ä½ä¸ºå•ä½æ¥æŒ‡å®šå…¶æˆå‘˜æ‰€å å†…å­˜é•¿åº¦ï¼Œè¿™ç§ä»¥ä½ä¸ºå•ä½çš„æˆå‘˜ç§°ä¸ºâ€œä½æ®µâ€æˆ–ç§°â€œä½åŸŸâ€( bit field) ã€‚åˆ©ç”¨ä½æ®µèƒ½å¤Ÿç”¨è¾ƒå°‘çš„ä½æ•°å­˜å‚¨æ•°æ®ã€‚</p>
<p>æœºæ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡åœ¨ç»“æ„ä½“å†…å­˜çš„æœ€å³è¾¹ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå…¶å®ƒå˜é‡ä¾æ¬¡ä»å·¦å¾€å³æ’ã€‚</p>
<p>ä½¿ç”¨ä½åŸŸå¢åŠ å¯è¯»æ€§ã€‚å®šä¹‰ç»“æ„ä½“ _tallRichHandsomeï¼Œæˆå‘˜å˜é‡ tallï¼Œå¹¶é€šè¿‡â€œ:â€è®¾ç½® tall åœ¨å†…å­˜ä¸­åªå 1ä½ã€‚<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span>()</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> &#123;</div><div class="line">        <span class="keyword">char</span> tall : <span class="number">1</span>; <span class="comment">//1ä½</span></div><div class="line">    &#125; _tallRichHandsome; <span class="comment">//1ä¸ªå­—èŠ‚</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">void</span>)setTall:(<span class="built_in">BOOL</span>)tall &#123;</div><div class="line">    _tallRichHandsome.tall = tall;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isTall &#123;</div><div class="line">    <span class="built_in">BOOL</span> ret = _tallRichHandsome.tall;</div><div class="line">    <span class="keyword">return</span> ret; <span class="comment">//æ–­ç‚¹2</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        person.tall = <span class="literal">YES</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"tallï¼š%d"</span>, person.isTall); <span class="comment">//æ–­ç‚¹1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">-1</span></div></pre></td></tr></table></figure></p>
<p>åœ¨æ–­ç‚¹1å¤„æŸ¥çœ‹ _tallRichHandsome çš„å†…å­˜ï¼š<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(lldb) p/x &amp;(person-&gt;_tallRichHandsome)</div><div class="line">((anonymous struct) *) $0 = 0x0000000100493d98</div><div class="line">(lldb) x 0x0000000100493d98</div><div class="line">0x100493d98:<span class="number"> 01 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00 2d 5b 4e<span class="number"> 53 </span>54<span class="number"> 61 </span>62<span class="number"> 50 </span> ........-[NSTabP</div><div class="line">0x100493da8:<span class="number"> 69 </span>63 6b<span class="number"> 65 </span>72<span class="number"> 56 </span>69<span class="number"> 65 </span>77<span class="number"> 43 </span>6f 6e<span class="number"> 74 </span>72 6f 6c  ickerViewControl</div></pre></td></tr></table></figure></p>
<p>å†…å­˜ä¸­çš„â€œ01â€æ˜¯åå…­è¿›åˆ¶çš„ï¼Œè½¬æˆäºŒè¿›åˆ¶å°±æ˜¯<code>0b 0000 0001</code>ã€‚å³ tallï¼šYESã€‚</p>
<p>åœ¨æ–­ç‚¹2å¤„æŸ¥çœ‹ ret çš„å†…å­˜ï¼š<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(lldb) p/x &amp; ret</div><div class="line">(BOOL *) <span class="variable">$0</span> = 0x00007ffeefbff4ff 255</div><div class="line">(lldb) x 0x00007ffeefbff4ff</div><div class="line">0x7ffeefbff4ff: ff b1 4e cb 5e ff 7f 00 00 90 81 16 03 01 00 00  <span class="built_in">..</span>N.^<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>.</div><div class="line">0x7ffeefbff50f: 00 50 f5 bf ef fe 7f 00 00 90 0c 00 00 01 00 00  .P<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></div></pre></td></tr></table></figure></p>
<p>å†…å­˜ä¸­çš„â€œffâ€æ˜¯åå…­è¿›åˆ¶çš„ï¼ˆ0xFFï¼‰ï¼Œè½¬æˆäºŒè¿›åˆ¶å°±æ˜¯<code>0b11111111</code>ï¼Œè½¬æˆåè¿›åˆ¶æ˜¯255ï¼ˆæ— ç¬¦å·ï¼‰æˆ–-1ï¼ˆæœ‰ç¬¦å·ï¼‰ã€‚è¿™æ˜¯å› ä¸º tall åŸæœ¬æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå³ tallï¼š0b1ï¼Œè€Œè¿”å›å€¼è¦æ±‚çš„æ˜¯ BOOL ç±»å‹çš„å€¼ï¼ˆ8ä½ï¼š<code>0b00000000</code>ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿”å›æ—¶ tall å¼ºè½¬æˆäº†ä¸€ä¸ª8ä½çš„å€¼ï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">0b1</span> -&gt; <span class="number">0b</span> <span class="number">1111</span> <span class="number">1111</span>ï¼ˆäºŒè¿›åˆ¶ï¼‰ //<span class="number">0xff</span>ï¼ˆåå…­è¿›åˆ¶ï¼‰</div></pre></td></tr></table></figure></p>
<p>å› ä¸ºåœ¨ç³»ç»Ÿä¸­æ•´æ•°æ˜¯ä»¥è¡¥ç å½¢å¼å­˜æ”¾çš„ï¼Œæ‰€ä»¥è¦æƒ³æ‰¾åˆ°æ‰“å°ç»“æœä¸ºâ€œ-1â€çš„åŸå› éœ€è¦å…ˆç®—å‡º <code>0b11111111</code> çš„åŸç ã€‚</p>
<ul>
<li>è¡¥ç æ±‚åŸç <br>å¦‚æœè¡¥ç çš„ç¬¦å·ä½ä¸ºâ€œ0â€ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå…¶åŸç å°±æ˜¯è¡¥ç ã€‚<br>å¦‚æœè¡¥ç çš„ç¬¦å·ä½ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œé‚£ä¹ˆæ±‚ç»™å®šçš„è¿™ä¸ªè¡¥ç çš„è¡¥ç å°±æ˜¯è¦æ±‚çš„åŸç ã€‚  </li>
</ul>
<p>å› ä¸º tall æ˜¯ä¸€ä¸ª char ç±»å‹çš„æ•´å‹å˜é‡ï¼Œæ˜¯æœ‰ç¬¦å·çš„ï¼ˆLLVMï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶çš„ <code>0b11111111</code> æ˜¯æœ‰ç¬¦å·çš„ã€‚</p>
<p>å› ä¸º <code>0b11111111</code> çš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œæ‰€ä»¥è¯¥ä½ä¸å˜ï¼Œä»ä¸ºâ€œ1â€ã€‚å…¶ä½™ä¸ƒä½å–ååä¸º <code>0b10000000</code>ï¼›å†åŠ 1ï¼Œæ‰€ä»¥æ˜¯ <code>0b10000001</code>ï¼Œåè¿›åˆ¶å°±æ˜¯ -1ã€‚æ‰€ä»¥ tall åœ¨è®¾ç½®ä¸º YES æ—¶ï¼Œæ‰“å°ç»“æœæ˜¯ -1ã€‚</p>
<p>å¦‚æœå°† tall è®¾ç½®ä¸º NO çš„è¯ï¼Œ_tallRichHandsome å’Œ ret çš„å†…å­˜éƒ½æ˜¯ <code>0b00000000</code>ã€‚<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(lldb) p/x &amp;(person-&gt;_tallRichHandsome)</div><div class="line">((anonymous struct) *) $1 = 0x0000000102c6fb28</div><div class="line">(lldb) x 0x0000000102c6fb28</div><div class="line">0x102c6fb28:<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00 2d 5b 4e<span class="number"> 53 </span>56<span class="number"> 69 </span>62<span class="number"> 72 </span> ........-[NSVibr</div><div class="line">0x102c6fb38:<span class="number"> 61 </span>6e<span class="number"> 74 </span>53<span class="number"> 70 </span>6c<span class="number"> 69 </span>74<span class="number"> 44 </span>69<span class="number"> 76 </span>69<span class="number"> 64 </span>65<span class="number"> 72 </span>56  antSplitDividerV</div><div class="line"></div><div class="line">(lldb) p/x &amp; ret</div><div class="line">(BOOL *) $0 = 0x00007ffeefbff4ff NO</div><div class="line">(lldb) x 0x00007ffeefbff4ff</div><div class="line">0x7ffeefbff4ff:<span class="number"> 00 </span>b1 4e cb 5e ff 7f<span class="number"> 00 </span>00<span class="number"> 20 </span>fb c6<span class="number"> 02 </span>01<span class="number"> 00 </span>00  ..N.^.... ......</div><div class="line">0x7ffeefbff50f:<span class="number"> 00 </span>50 f5 bf ef fe 7f<span class="number"> 00 </span>00 8d 0c<span class="number"> 00 </span>00<span class="number"> 01 </span>00<span class="number"> 00 </span> .P..............</div></pre></td></tr></table></figure></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨å¯¹ tall è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šæœ‰ä¸¤ä¸ªè¿”å›å€¼â€œ-1â€å’Œâ€œ0â€ã€‚ä¸ºäº†ä¿è¯è¿”å›çš„ç»“æœæ­£ç¡®ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢ğŸ‘†æåˆ°è¿‡çš„å–åä¸¤æ¬¡<code>!!</code>ã€‚</p>
<p>æœ€ç»ˆå®ç°ï¼š<br>å®šä¹‰ç»“æ„ä½“ _tallRichHandsomeï¼ŒåŒæ—¶å®šä¹‰æˆå‘˜å˜é‡ tallã€rich å’Œ handsomeï¼Œå¹¶é€šè¿‡â€œ:â€è®¾ç½®å¥¹ä»¬åœ¨å†…å­˜ä¸­åªå 1ä½ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span>()</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> &#123;</div><div class="line">        <span class="keyword">char</span> tall : <span class="number">1</span>; <span class="comment">//åªå 1ä½</span></div><div class="line">        <span class="keyword">char</span> rich : <span class="number">1</span>;</div><div class="line">        <span class="keyword">char</span> handsome : <span class="number">1</span>;</div><div class="line">    &#125; _tallRichHandsome;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">void</span>)setTall:(<span class="built_in">BOOL</span>)tall &#123;</div><div class="line">    _tallRichHandsome.tall = tall;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setRich:(<span class="built_in">BOOL</span>)rich &#123;</div><div class="line">    _tallRichHandsome.rich = rich;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHandsome:(<span class="built_in">BOOL</span>)handsome &#123;</div><div class="line">    _tallRichHandsome.handsome = handsome;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isTall &#123;</div><div class="line">    <span class="keyword">return</span> !!_tallRichHandsome.tall;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isRich &#123;</div><div class="line">    <span class="keyword">return</span> !!_tallRichHandsome.rich;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isHandsome &#123;</div><div class="line">    <span class="keyword">return</span> !!_tallRichHandsome.handsome;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        person.tall = <span class="literal">YES</span>;</div><div class="line">        person.rich = <span class="literal">NO</span>;</div><div class="line">        person.handsome = <span class="literal">YES</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"tallï¼š%d, richï¼š%d, handsomeï¼š%d"</span>, person.isTall, person.isRich, person.isHandsome); <span class="comment">//æ–­ç‚¹1</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">1</span>, richï¼š<span class="number">0</span>, handsomeï¼š<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>_tallRichHandsome çš„äºŒçº§åˆ¶å°±æ˜¯<code>0b00000111</code>ï¼Œtall æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡åœ¨æœ€å³è¾¹ï¼Œç„¶åä¾æ¬¡ä»å·¦å¾€å³æ’ã€‚</p>
<h2 id="å…±ç”¨ä½“ï¼ˆunionï¼‰"><a href="#å…±ç”¨ä½“ï¼ˆunionï¼‰" class="headerlink" title="å…±ç”¨ä½“ï¼ˆunionï¼‰"></a>å…±ç”¨ä½“ï¼ˆunionï¼‰</h2><h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h3><p>struct ç»“æ„ä½“é‡Œçš„æˆå‘˜å˜é‡å„è‡ªæ‹¥æœ‰ä¸€å—å†…å­˜ï¼Œå•ç‹¬å­˜åœ¨ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime01.png" alt="Runtime01"></p>
<p>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ Dateï¼Œå†…éƒ¨æœ‰ä¸‰ä¸ª int ç±»å‹çš„æˆå‘˜å˜é‡ yearã€month å’Œ dayï¼š<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">struct Date &#123;</div><div class="line">    <span class="built_in">int</span> <span class="built_in">year</span>;  <span class="comment">//4ä¸ªå­—èŠ‚</span></div><div class="line">    <span class="built_in">int</span> <span class="built_in">month</span>; <span class="comment">//4ä¸ªå­—èŠ‚</span></div><div class="line">    <span class="built_in">int</span> <span class="built_in">day</span>;   <span class="comment">//4ä¸ªå­—èŠ‚</span></div><div class="line">&#125;; <span class="comment">//12ä¸ªå­—èŠ‚</span></div><div class="line"></div><div class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, <span class="keyword">const</span> <span class="built_in">char</span> * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        <span class="comment">//struct Date date = &#123;2020, 6, 17&#125;;</span></div><div class="line">        struct Date date;</div><div class="line">        date.<span class="built_in">year</span> = <span class="number">2020</span>;</div><div class="line">        date.<span class="built_in">month</span> = <span class="number">6</span>;</div><div class="line">        date.<span class="built_in">day</span> = <span class="number">17</span>;</div><div class="line">        NSLog(@<span class="string">"yearï¼š%d, monthï¼š%d, dayï¼š%d"</span>, date.<span class="built_in">year</span>, date.<span class="built_in">month</span>, date.<span class="built_in">day</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">year</span>ï¼š<span class="number">2020</span>, <span class="built_in">month</span>ï¼š<span class="number">6</span>, <span class="built_in">day</span>ï¼š<span class="number">17</span></div></pre></td></tr></table></figure></p>
<p>å› ä¸ºä¸‰ä¸ªå˜é‡å„è‡ªæ‹¥æœ‰è‡ªå·±çš„å†…å­˜ï¼Œæ‰€ä»¥æ‰“å°ç»“æœå„ä¸ç›¸åŒã€‚</p>
<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><p>union å…±ç”¨ä½“é‡Œçš„æˆå‘˜å˜é‡å…±ç”¨ä¸€å—å†…å­˜ï¼Œå…±ç”¨ä½“çš„å†…å­˜å¤§å°ä»¥æˆå‘˜å˜é‡çš„æœ€å¤§å†…å­˜ä¸ºå‡†ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime02.png" alt="Runtime02"></p>
<p>å®šä¹‰å…±ç”¨ä½“ Dateï¼Œå†…éƒ¨æœ‰ä¸‰ä¸ª int ç±»å‹çš„å˜é‡ yearã€month å’Œ dayï¼š<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">union</span> <span class="title">Date</span> &#123;</span></div><div class="line">    int year;  <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line">    int month; <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line">    int day;   <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line">&#125;; <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line"></div><div class="line">int main(int argc, const char * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        <span class="class"><span class="keyword">union</span> <span class="title">Date</span> <span class="title">date</span>;</span></div><div class="line">        date.year = <span class="number">2020</span>;</div><div class="line">        NSLog(@<span class="string">"yearï¼š%d, monthï¼š%d, dayï¼š%d"</span>, date.year, date.month, date.day);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">year</span>ï¼š<span class="number">2020</span>, <span class="built_in">month</span>ï¼š<span class="number">2020</span>, <span class="built_in">day</span>ï¼š<span class="number">2020</span></div></pre></td></tr></table></figure></p>
<p>å› ä¸ºä¸‰ä¸ªå˜é‡å…±ç”¨ä¸€å—å†…å­˜ï¼Œæ‰€ä»¥ä¸‰ä¸ªå˜é‡è®¿é—®çš„å†…å­˜æ˜¯åŒä¸€å—å†…å­˜åœ°å€ã€‚</p>
<p>å®šä¹‰å…±ç”¨ä½“ Dateï¼Œå†…éƒ¨æœ‰ä¸€ä¸ª int ç±»å‹çš„å˜é‡ year å’Œä¸€ä¸ª char ç±»å‹çš„å˜é‡ monthï¼š<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">union</span> <span class="title">Date</span> &#123;</span></div><div class="line">    int year;   <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line">    char month; <span class="regexp">//</span><span class="number">1</span>ä¸ªå­—èŠ‚</div><div class="line">&#125;; <span class="regexp">//</span><span class="number">4</span>ä¸ªå­—èŠ‚</div><div class="line"></div><div class="line">int main(int argc, const char * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        <span class="class"><span class="keyword">union</span> <span class="title">Date</span> <span class="title">date</span>;</span></div><div class="line">        date.year = <span class="number">2020</span>;</div><div class="line">        NSLog(@<span class="string">"yearï¼š%d, monthï¼š%d"</span>, date.year, date.month);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">year</span>ï¼š<span class="number">2020</span>, <span class="built_in">month</span>ï¼š<span class="number">2020</span></div></pre></td></tr></table></figure></p>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å°†ä½è¿ç®—å’Œä½åŸŸç»“åˆåœ¨ä¸€èµ·å®šä¹‰ä¸€ä¸ªå…±ç”¨ä½“ï¼Œç”¨ä½è¿ç®—è¯»å–/å†™å…¥å˜é‡çš„å€¼ï¼Œç”¨ä½åŸŸå¢åŠ å¯è¯»æ€§ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TallMask (1&lt;&lt;0)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RichMask (1&lt;&lt;1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HandsomeMask (1&lt;&lt;2)</span></div><div class="line"></div><div class="line">@<span class="function">interface <span class="title">Person</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">union</span> &#123;</div><div class="line">        <span class="keyword">char</span> bits;</div><div class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></div><div class="line">            <span class="keyword">char</span> tall : <span class="number">1</span>;</div><div class="line">            <span class="keyword">char</span> rich : <span class="number">1</span>;</div><div class="line">            <span class="keyword">char</span> handsome : <span class="number">1</span>;</div><div class="line">        &#125;;</div><div class="line">    &#125;_tallRichHandsome;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation Person</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTall:(BOOL)tall &#123;</div><div class="line">    <span class="keyword">if</span> (tall) &#123;</div><div class="line">        _tallRichHandsome.bits |= TallMask;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        _tallRichHandsome.bits &amp;= ~TallMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setRich:(BOOL)rich &#123;</div><div class="line">    <span class="keyword">if</span> (rich) &#123;</div><div class="line">        _tallRichHandsome.bits |= RichMask;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        _tallRichHandsome.bits &amp;= ~RichMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHandsome:(BOOL)handsome &#123;</div><div class="line">    <span class="keyword">if</span> (handsome) &#123;</div><div class="line">        _tallRichHandsome.bits |= HandsomeMask;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        _tallRichHandsome.bits &amp;= ~HandsomeMask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isTall &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome.bits &amp; TallMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isRich &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome.bits &amp; RichMask);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isHandsome &#123;</div><div class="line">    <span class="keyword">return</span> !!(_tallRichHandsome.bits &amp; HandsomeMask);</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        person.tall = NO;</div><div class="line">        person.rich = NO;</div><div class="line">        person.handsome = YES;</div><div class="line">        NSLog(@<span class="string">"tallï¼š%d, richï¼š%d, handsomeï¼š%d"</span>, person.isTall, person.isRich, person.isHandsome);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tallï¼š<span class="number">0</span>, richï¼š<span class="number">0</span>, handsomeï¼š<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå®šä¹‰çš„ tallã€rich å’Œ handsome éƒ½æ˜¯å 1ä¸ªäºŒè¿›åˆ¶ä½çš„ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹å®ƒä»¬å äºŒè¿›åˆ¶ä½çš„ä¸ªæ•°ï¼Œbits ä¹Ÿè¦ä¿®æ”¹ä¸ºç›¸åº”çš„å®šä¹‰ï¼š</p>
<p>tallã€rich å’Œ handsome éƒ½æ˜¯å 4ä¸ªäºŒè¿›åˆ¶ä½ï¼Œé‚£ bits å°±éœ€è¦å®šä¹‰æˆ int ç±»å‹ï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ï¼Œæ©ç ä¹Ÿéœ€è¦å 4ä¸ªäºŒè¿›åˆ¶ä½ï¼š<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#define TallMask (1&lt;&lt;0)</span></div><div class="line"><span class="comment">#define RichMask (1&lt;&lt;4)</span></div><div class="line"><span class="comment">#define HandsomeMask (1&lt;&lt;8)</span></div><div class="line"></div><div class="line">@interface Person()</div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></div><div class="line">        int bits;</div><div class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></div><div class="line">            char tall : <span class="number">4</span>;</div><div class="line">            char rich : <span class="number">4</span>;</div><div class="line">            char handsome : <span class="number">4</span>;</div><div class="line">        &#125;;</div><div class="line">    &#125;_tallRichHandsome;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>æ©ç ä¹Ÿå¯ä»¥å†™æˆï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#<span class="built_in">define</span> TallMask (<span class="number">0b1111</span>&lt;&lt;<span class="number">0</span>)</div><div class="line">#<span class="built_in">define</span> RichMask (<span class="number">0b1111</span>&lt;&lt;<span class="number">4</span>)</div><div class="line">#<span class="built_in">define</span> HandsomeMask (<span class="number">0b1111</span>&lt;&lt;<span class="number">8</span>)</div></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TallMask (15&lt;&lt;0)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RichMask (15&lt;&lt;4)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HandsomeMask (15&lt;&lt;8)</span></div></pre></td></tr></table></figure></p>
<h2 id="isa"><a href="#isa" class="headerlink" title="isa"></a>isa</h2><p>åœ¨æºç  <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">objc4-781</a> ä¸­æŸ¥æ‰¾ isa çš„å®šä¹‰ã€‚  </p>
<p>æ‰¾åˆ° OC å¯¹è±¡çš„ç»“æ„ä½“ objc_objectï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">isa_t</span> isa;</div><div class="line">    </div><div class="line">    Â·Â·Â· <span class="comment">//çœç•¥ä¸€å †æ–¹æ³•</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="isa-t"><a href="#isa-t" class="headerlink" title="isa_t"></a>isa_t</h3><p>å¯ä»¥çœ‹åˆ° isa æ˜¯ä¸€ä¸ª isa_t ç±»å‹çš„å˜é‡ï¼ŒJump To Definition -&gt; isa_tï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">union</span> <span class="keyword">isa_t</span> &#123;</div><div class="line">    <span class="keyword">isa_t</span>() &#123; &#125;</div><div class="line">    <span class="keyword">isa_t</span>(<span class="keyword">uintptr_t</span> value) : bits(value) &#123; &#125;</div><div class="line"></div><div class="line">    Class cls;</div><div class="line">    <span class="keyword">uintptr_t</span> bits;</div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(ISA_BITFIELD)</span></div><div class="line">    <span class="comment">//ä½åŸŸ</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span> </div><div class="line">        ISA_BITFIELD;  <span class="comment">// defined in isa.h</span></div><div class="line">    &#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>ä½åŸŸä¸­æ˜¯ä¸€ä¸ªå® ISA_BITFIELDï¼ŒISA_BITFIELD åœ¨ <code>__arm64__</code>ï¼ˆçœŸæœºï¼‰ å’Œ <code>__x86_64__</code>ï¼ˆmacç”µè„‘/æ¨¡æ‹Ÿå™¨ï¼‰ æ¶æ„æœ‰ä¸åŒçš„å®šä¹‰ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># <span class="meta-keyword">if</span> __arm64__ <span class="comment">//çœŸæœºä¸Šå¸‚ arm64</span></span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MASK        0x0000000ffffffff8ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_MASK  0x000003f000000001ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_VALUE 0x000001a000000001ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_BITFIELD                                                      \</span></div><div class="line">      <span class="keyword">uintptr_t</span> nonpointer        : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> has_assoc         : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> has_cxx_dtor      : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> shiftcls          : <span class="number">33</span>; <span class="comment">/*MACH_VM_MAX_ADDRESS 0x1000000000*/</span> \</div><div class="line">      <span class="keyword">uintptr_t</span> magic             : <span class="number">6</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> weakly_referenced : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> deallocating      : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> has_sidetable_rc  : <span class="number">1</span>;                                       \</div><div class="line">      <span class="keyword">uintptr_t</span> extra_rc          : <span class="number">19</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> RC_ONE   (1ULL&lt;&lt;45)</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> RC_HALF  (1ULL&lt;&lt;18)</span></div><div class="line"></div><div class="line"><span class="meta"># <span class="meta-keyword">elif</span> __x86_64__ <span class="comment">//æ¨¡æ‹Ÿå™¨æ˜¯ x86 æ¶æ„</span></span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MASK        0x00007ffffffffff8ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_MASK  0x001f800000000001ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_VALUE 0x001d800000000001ULL</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_BITFIELD                                                        \</span></div><div class="line">      <span class="keyword">uintptr_t</span> nonpointer        : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> has_assoc         : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> has_cxx_dtor      : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> shiftcls          : <span class="number">44</span>; <span class="comment">/*MACH_VM_MAX_ADDRESS 0x7fffffe00000*/</span> \</div><div class="line">      <span class="keyword">uintptr_t</span> magic             : <span class="number">6</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> weakly_referenced : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> deallocating      : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> has_sidetable_rc  : <span class="number">1</span>;                                         \</div><div class="line">      <span class="keyword">uintptr_t</span> extra_rc          : <span class="number">8</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> RC_ONE   (1ULL&lt;&lt;56)</span></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> RC_HALF  (1ULL&lt;&lt;7)</span></div><div class="line"></div><div class="line"><span class="meta"># <span class="meta-keyword">else</span></span></div><div class="line"><span class="meta">#   <span class="meta-keyword">error</span> unknown architecture for packed isa</span></div><div class="line"><span class="meta"># <span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure></p>
<p>å°†å® <code>ISA_BITFIELD</code> æ›¿æ¢æ‰ï¼Œä¿ç•™çœŸæœºï¼ˆarm64ï¼‰ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„ isa_tï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime05.png" alt="Runtime05"></p>
<p> å› ä¸º isa æŒ‡é’ˆçš„å®šä¹‰åŒºåˆ† <code>__arm64__</code>ï¼ˆçœŸæœºï¼‰å’Œ <code>__x86_64__</code>ï¼ˆmac/æ¨¡æ‹Ÿå™¨ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç”¨çœŸæœºè¿è¡Œé¡¹ç›®æ‰èƒ½çœ‹åˆ° <code>ISA_BITFIELD</code> æ­£ç¡®çš„æˆå‘˜å˜é‡çš„å€¼ï¼š<br> <figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    Person *person = [[Person alloc] init];</div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹ person å¯¹è±¡çš„ isa æŒ‡é’ˆçš„å†…å­˜ï¼š<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(lldb) p/x person-&gt;isa</div><div class="line">(<span class="keyword">Class</span>) $<span class="number">0</span> = <span class="number">0x1A100455641</span> Person</div></pre></td></tr></table></figure></p>
<p>è½¬æˆäºŒè¿›åˆ¶ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime04.png" alt="Runtime04"></p>
<h3 id="ä½åŸŸ-1"><a href="#ä½åŸŸ-1" class="headerlink" title="ä½åŸŸ"></a>ä½åŸŸ</h3><ul>
<li>nonpointer<br>0ï¼Œä»£è¡¨æ™®é€šçš„æŒ‡é’ˆï¼Œisa åªå­˜å‚¨ç€ Classã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€<br>1ï¼Œä»£è¡¨ä¼˜åŒ–è¿‡ï¼Œisa ä½¿ç”¨ä½åŸŸå­˜å‚¨æ›´å¤šçš„ä¿¡æ¯</li>
<li>has_assoc<br>æ˜¯å¦æœ‰è®¾ç½®è¿‡å…³è”å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«</li>
<li>has_cxx_dtor<br>æ˜¯å¦æœ‰ C++ çš„ææ„å‡½æ•°ï¼ˆ.cxx_destructï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«</li>
<li>shiftcls<br>å­˜å‚¨ç€ Classã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯</li>
<li>magic<br>ç”¨äºåœ¨è°ƒè¯•æ—¶åˆ†è¾¨å¯¹è±¡æ˜¯å¦æœªå®Œæˆåˆå§‹åŒ–</li>
<li>weakly_referenced<br>æ˜¯å¦æœ‰è¢«å¼±å¼•ç”¨æŒ‡å‘è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«</li>
<li>deallocating<br>å¯¹è±¡æ˜¯å¦æ­£åœ¨é‡Šæ”¾</li>
<li>extra_rc<br>é‡Œé¢å­˜å‚¨çš„å€¼æ˜¯å¼•ç”¨è®¡æ•°å™¨å‡1</li>
<li>has_sidetable_rc<br>å¼•ç”¨è®¡æ•°å™¨æ˜¯å¦è¿‡å¤§æ— æ³•å­˜å‚¨åœ¨ isa ä¸­ï¼Œå¦‚æœä¸º1ï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªå« SideTable çš„ç±»çš„å±æ€§ä¸­</li>
</ul>
<p><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime06.png" alt="Runtime06"><br>nonpointerï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œåœ¨æœ€ä½ä½ä¸º1ï¼ˆç¬¬0ä½ï¼‰ã€‚<br>has_assocï¼ˆhas_associateï¼‰ï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆç¬¬1ä½ï¼‰ã€‚<br>has_cxx_dtorï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆç¬¬2ä½ï¼‰ã€‚<br>shiftclsï¼šå 33ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆä»ç¬¬3ä½åˆ°ç¬¬35ä½ï¼‰ã€‚<br>magicï¼šå 6ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆä»ç¬¬36ä½åˆ°ç¬¬41ä½ï¼‰ã€‚magic çš„å€¼å¯ä»¥ä»å® <code>ISA_MAGIC_VALUE</code> çœ‹åˆ°ï¼ˆ1aï¼‰ã€‚magic == 1a è¡¨ç¤ºåˆå§‹åŒ–æˆåŠŸã€‚<br>weakly_referencedï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆç¬¬42ä½ï¼‰ã€‚<br>deallocatingï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆç¬¬43ä½ï¼‰ã€‚<br>has_sidetable_rcï¼šå 1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆç¬¬44ä½ï¼‰ã€‚<br>extra_rcï¼ˆextra_retain_countï¼‰ï¼šå 19ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸º0ï¼ˆä»ç¬¬45ä½åˆ°63ä½ï¼‰ã€‚</p>
<h4 id="has-assoc-å’Œ-weakly-referenced"><a href="#has-assoc-å’Œ-weakly-referenced" class="headerlink" title="has_assoc å’Œ weakly_referenced"></a>has_assoc å’Œ weakly_referenced</h4><p>has_assoc å’Œ weakly_referenced æ ‡è®°çš„æ˜¯æ›¾ç»æ˜¯å¦è®¾ç½®è¿‡ï¼Œå¦‚æœæ·»åŠ äº† __weak å’Œå…³è”å¯¹è±¡å†ç§»é™¤æ‰ï¼Œè¿™ä¸¤ä¸ªå˜é‡çš„å€¼ä¾ç„¶æ˜¯1ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    Person *person = [[Person alloc] init];</div><div class="line">    __<span class="keyword">weak</span> Person *weakPerson = person;</div><div class="line">    weakPerson = <span class="literal">nil</span>;</div><div class="line">    objc_setAssociatedObject(person, <span class="string">@"name"</span>, <span class="string">@"Tom"</span>, OBJC_ASSOCIATION_COPY_NONATOMIC); <span class="comment">//æ·»åŠ å…³è”å¯¹è±¡</span></div><div class="line">    objc_setAssociatedObject(person, <span class="string">@"name"</span>, <span class="literal">nil</span>, OBJC_ASSOCIATION_COPY_NONATOMIC); <span class="comment">//ç§»é™¤å…³è”å¯¹è±¡</span></div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹å†…å­˜ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime07.png" alt="Runtime07"></p>
<h4 id="å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«"><a href="#å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«" class="headerlink" title="å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«"></a>å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«</h4><p>å¦‚æœ has_assocã€has_cxx_dtor å’Œ weakly_referenced ä¸º0ï¼Œå³æ²¡æœ‰æ·»åŠ è¿‡å…³è”å¯¹è±¡ã€æ²¡æœ‰ææ„å‡½æ•°å’Œæ²¡æœ‰è¢«å¼±å¼•ç”¨æŒ‡å‘è¿‡ï¼Œä¼šè®©å®ä¾‹å¯¹è±¡çš„é‡Šæ”¾å˜å¾—æ›´å¿«ã€‚è¿™ç‚¹å¯ä»¥ä»æºç é‡Œçœ‹å‡ºæ¥ã€‚  </p>
<p>é”€æ¯å®åˆ—å¯¹è±¡çš„æ–¹æ³• objc_destructInstanceï¼š<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"><span class="markdown">/<span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>objc_destructInstance</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>Destroys </span>an<span class="markdown"> instance without freeing memory. </span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>Calls C++ destructors.</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>Calls ARC ivar cleanup.</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>Removes associative references.</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>Returns <span class="code">`obj`</span>. Does nothing if <span class="code">`obj`</span> is nil.</span></span></div><div class="line"><span class="comment"><span class="markdown"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>/</span></span></div><div class="line"><span class="keyword">void</span> *objc_destructInstance(id obj) </div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (obj) &#123;</div><div class="line">        <span class="comment">// Read all of the flags at once for performance.</span></div><div class="line">        <span class="built_in">bool</span> cxx = obj-&gt;hasCxxDtor();</div><div class="line">        <span class="built_in">bool</span> assoc = obj-&gt;hasAssociatedObjects();</div><div class="line"></div><div class="line">        <span class="comment">// This order is important.</span></div><div class="line">        <span class="keyword">if</span> (cxx) object_cxxDestruct(obj);</div><div class="line">        <span class="keyword">if</span> (assoc) _object_remove_assocations(obj);</div><div class="line">        obj-&gt;clearDeallocating();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨é”€æ¯å®ä¾‹å¯¹è±¡çš„æ–¹æ³•é‡Œï¼Œåˆ¤æ–­äº†æœ‰æ²¡æœ‰ææ„å‡½æ•°å’Œå…³è”å¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯éœ€è¦å…ˆå¤„ç†ææ„å‡½æ•°å’Œå…³è”å¯¹è±¡ã€‚</p>
<p>Jump To Definition -&gt; clearDeallocatingï¼š<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">inline void </div><div class="line">objc_object::clearDeallocating()</div><div class="line">&#123;</div><div class="line">   <span class="built_in"> if </span>(slowpath(!isa.nonpointer)) &#123;</div><div class="line">        // Slow path for raw pointer isa.</div><div class="line">        sidetable_clearDeallocating();</div><div class="line">    &#125;</div><div class="line">    else<span class="built_in"> if </span>(slowpath(isa.weakly_referenced  ||  isa.has_sidetable_rc)) &#123;</div><div class="line">        // Slow path for non-pointer isa with weak refs<span class="built_in"> and/or </span>side table data.</div><div class="line">        clearDeallocating_slow();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    assert(!sidetable_present());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Jump To Definition -&gt; clearDeallocating_slowï¼š<br><figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Slow path of clearDeallocating() </span></div><div class="line"><span class="comment">// for objects with nonpointer isa</span></div><div class="line"><span class="comment">// that were ever weakly referenced </span></div><div class="line"><span class="comment">// or whose retain count ever overflowed to the side table.</span></div><div class="line">NEVER_INLINE <span class="keyword">void</span></div><div class="line">objc_object::clearDeallocating_slow()</div><div class="line">&#123;</div><div class="line">    ASSERT(isa<span class="variable">.nonpointer</span>  &amp;&amp;  (isa<span class="variable">.weakly_referenced</span> || isa<span class="variable">.has_sidetable_rc</span>));</div><div class="line"></div><div class="line">    SideTable&amp; <span class="keyword">table</span> = SideTables()[<span class="keyword">this</span>];</div><div class="line">    <span class="keyword">table</span><span class="variable">.lock</span>();</div><div class="line">    <span class="keyword">if</span> (isa<span class="variable">.weakly_referenced</span>) &#123;</div><div class="line">        weak_clear_no_lock(&amp;<span class="keyword">table</span><span class="variable">.weak_table</span>, (id)<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (isa<span class="variable">.has_sidetable_rc</span>) &#123;</div><div class="line">        <span class="keyword">table</span><span class="variable">.refcnts</span><span class="variable">.erase</span>(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">table</span><span class="variable">.unlock</span>();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ <code>clearDeallocating()</code> æ–¹æ³•é‡Œåˆ¤æ–­äº†æ˜¯å¦æœ‰å¼±å¼•ç”¨æŒ‡å‘è¿‡ï¼Œå¦‚æœæœ‰çš„è¯éœ€è¦åœ¨ <code>clearDeallocating_slow()</code> æ–¹æ³•é‡Œå¤„ç† weakly_referencedã€‚</p>
<h3 id="ISA-MASK"><a href="#ISA-MASK" class="headerlink" title="ISA_MASK"></a>ISA_MASK</h3><p>é€šè¿‡ <code>isa &amp; ISA_MASK</code> èƒ½å¤Ÿå–å‡º shiftcls çš„å€¼ï¼ˆClassã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯ï¼‰ã€‚å› ä¸º <code>ISA_MASK</code> æœ€åé¢ä¸‰ä½éƒ½æ˜¯0ï¼Œæ‰€ä»¥è·å–åˆ°çš„ Classã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€çš„æœ€åä¸‰ä½è‚¯å®šä¹Ÿä¸º0ã€‚<code>ISA_MASK</code>ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime03.png" alt="Runtime03"></p>
<p>è¯æ˜ï¼š<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> ViewController()</div><div class="line"><span class="variable">@end</span></div><div class="line"></div><div class="line"><span class="variable">@implementation</span> ViewController</div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    <span class="selector-attr">[super viewDidLoad]</span>;</div><div class="line">    <span class="selector-tag">NSLog</span>(@<span class="string">"%p"</span>, [ViewController class]);</div><div class="line">    <span class="selector-tag">NSLog</span>(@<span class="string">"%p"</span>, object_getClass([ViewController class]));</div><div class="line">    <span class="selector-tag">NSLog</span>(@<span class="string">"%p"</span>, [Person class]);</div><div class="line">    <span class="selector-tag">NSLog</span>(@<span class="string">"%p"</span>, object_getClass([Person class]));</div><div class="line">&#125;</div><div class="line">@<span class="selector-tag">end</span></div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span>x<span class="number">1007d5550</span></div><div class="line"><span class="number">0</span>x<span class="number">1007d5578</span></div><div class="line"><span class="number">0</span>x<span class="number">1007d5618</span></div><div class="line"><span class="number">0</span>x<span class="number">1007d55f0</span></div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœçš„æœ€åä¸€ä½éƒ½æ˜¯â€8â€œæˆ–â€0â€œï¼Œå³â€<code>1000</code>â€œæˆ–â€<code>0000</code>â€œã€‚æ‰€ä»¥ Classã€Meta-Class å¯¹è±¡çš„å†…å­˜åœ°å€çš„æœ€åä¸‰ä¸ºä¸º0ã€‚</p>
<h2 id="ä½è¿ç®—è¡¥å……"><a href="#ä½è¿ç®—è¡¥å……" class="headerlink" title="ä½è¿ç®—è¡¥å……"></a>ä½è¿ç®—è¡¥å……</h2><p>ç”¨å·¦ç§»å®šä¹‰æšä¸¾çš„æˆå‘˜å˜é‡ï¼Œç”¨â€æˆ–â€œè¿ç®—ä¼ å…¥å¤šä¸ªå€¼ï¼Œç”¨â€ä¸â€œè¿ç®—è·å–ä¼ å…¥çš„éƒ½æœ‰å“ªäº›å€¼ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</div><div class="line">    OptionsOne = <span class="number">1</span>&lt;&lt;<span class="number">0</span>,</div><div class="line">    OptionsTwo = <span class="number">1</span>&lt;&lt;<span class="number">1</span>,</div><div class="line">    OptionsThree = <span class="number">1</span>&lt;&lt;<span class="number">2</span>,</div><div class="line">    OptionsFour = <span class="number">1</span>&lt;&lt;<span class="number">3</span></div><div class="line">&#125; Options;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line">- (<span class="keyword">void</span>)setOptions:(Options)option &#123;</div><div class="line">    <span class="keyword">if</span> (option &amp; OptionsOne) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"OptionsOne"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (option &amp; OptionsTwo) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"OptionsTwo"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (option &amp; OptionsThree) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"OptionsThree"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (option &amp; OptionsFour) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"OptionsFour"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    [<span class="keyword">self</span> setOptions:OptionsOne | OptionsTwo | OptionsFour];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">OptionsOne</span></div><div class="line"><span class="attribute">OptionsTwo</span></div><div class="line"><span class="attribute">OptionsFour</span></div></pre></td></tr></table></figure></p>
<h1 id="Class-çš„ç»“æ„"><a href="#Class-çš„ç»“æ„" class="headerlink" title="Class çš„ç»“æ„"></a>Class çš„ç»“æ„</h1><p>ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡éƒ½æ˜¯ Class ç±»å‹çš„å¯¹è±¡ï¼Œå…ƒç±»å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å¯¹è±¡ã€‚</p>
<p>åœ¨æºç  <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">objc4-781</a> ä¸­æŸ¥æ‰¾ objc_class çš„å®šä¹‰ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">isa_t</span> isa;</div><div class="line"></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> :</span> objc_object &#123;</div><div class="line">    <span class="comment">// Class ISA;</span></div><div class="line">    Class superclass;</div><div class="line">    <span class="keyword">cache_t</span> cache;             <span class="comment">// formerly cache pointer and vtable</span></div><div class="line">    <span class="keyword">class_data_bits_t</span> bits;    <span class="comment">// class_rw_t * plus custom rr/alloc flags</span></div><div class="line"></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç»“æ„å›¾ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime08.png" alt="Runtime08"></p>
<p>ç»“æ„å›¾é‡Œå‡ºç°çš„ <code>rw</code>å’Œ <code>ro</code> åˆ†åˆ«è¡¨ç¤º readwrite å’Œ readonlyã€‚</p>
<h2 id="class-rw-t"><a href="#class-rw-t" class="headerlink" title="class_rw_t"></a>class_rw_t</h2><p>class_rw_t é‡Œé¢çš„ methodsã€propertiesã€protocols æ˜¯äºŒç»´æ•°ç»„ï¼Œæ˜¯å¯è¯»å¯å†™çš„ï¼ŒåŒ…å«äº†ç±»çš„åˆå§‹å†…å®¹ã€åˆ†ç±»çš„å†…å®¹ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">class_rw_ext_t</span> &#123;</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">class_ro_t</span> *ro;</div><div class="line">    <span class="keyword">method_array_t</span> methods;</div><div class="line">    <span class="keyword">property_array_t</span> properties;</div><div class="line">    <span class="keyword">protocol_array_t</span> protocols;</div><div class="line">    <span class="keyword">char</span> *demangledName;</div><div class="line">    <span class="keyword">uint32_t</span> version;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">class_rw_t</span> &#123;</span></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line"></div><div class="line">    explicit_atomic&lt;<span class="keyword">uintptr_t</span>&gt; ro_or_rw_ext;</div><div class="line"></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime09.png" alt="Runtime09"></p>
<p>ç±»çš„ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶æ˜¯æ”¾åœ¨ class_ro_t é‡Œçš„ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šå°†ç±»çš„ class_ro_t é‡Œçš„ä¿¡æ¯å’Œåˆ†ç±»çš„ä¿¡æ¯ï¼ˆæ³¨æ„é¡ºåºï¼‰åˆå¹¶èµ·æ¥æ”¾åˆ° class_rw_t é‡Œã€‚æ‰¾åˆ°åˆå¹¶åˆ†ç±»ä¿¡æ¯çš„æ–¹æ³• realizeClassWithoutSwiftï¼š<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">static Class realizeClassWithoutSwift(Class cls, Class previously)</div><div class="line">&#123;</div><div class="line">    runtimeLock.assertLocked();</div><div class="line"></div><div class="line">    class_rw_t *rw;</div><div class="line">    Class supercls;</div><div class="line">    Class metacls;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!cls) return <span class="literal">nil</span>;</div><div class="line">    <span class="function"><span class="title">if</span> (cls-&gt;</span>isRealized()) return cls;</div><div class="line">    ASSERT(cls == remapClass(cls));</div><div class="line"></div><div class="line">    <span class="comment">// fixme verify class is not in an un-dlopened part of the shared cache?</span></div><div class="line"></div><div class="line">    <span class="function"><span class="title">auto</span> ro = (const class_ro_t *)cls-&gt;</span><span class="keyword">data</span>(); <span class="comment">//å–å‡ºç±»ä¿¡æ¯ ro</span></div><div class="line">    <span class="function"><span class="title">auto</span> isMeta = ro-&gt;</span>flags &amp; RO_META;</div><div class="line">    <span class="function"><span class="title">if</span> (ro-&gt;</span>flags &amp; RO_FUTURE) &#123;</div><div class="line">        <span class="comment">// This was a future class. rw data is already allocated.</span></div><div class="line">        <span class="function"><span class="title">rw</span> = cls-&gt;</span><span class="keyword">data</span>();</div><div class="line">        <span class="function"><span class="title">ro</span> = cls-&gt;</span><span class="function"><span class="title">data</span>()-&gt;</span>ro();</div><div class="line">        ASSERT(!isMeta);</div><div class="line">        <span class="function"><span class="title">cls</span>-&gt;</span>changeInfo(RW_REALIZED|RW_REALIZING, RW_FUTURE);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// Normal class. Allocate writeable class data.</span></div><div class="line">        rw = objc::zalloc&lt;class_rw_t&gt;(); <span class="comment">//åˆå§‹åŒ– rw</span></div><div class="line">        <span class="function"><span class="title">rw</span>-&gt;</span>set_ro(ro); <span class="comment">//æ·»åŠ ç±»ä¿¡æ¯ ro</span></div><div class="line">        <span class="function"><span class="title">rw</span>-&gt;</span>flags = RW_REALIZED|RW_REALIZING|isMeta;</div><div class="line">        <span class="function"><span class="title">cls</span>-&gt;</span>setData(rw);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...<span class="comment">//ä¸€å †æ–¹æ³•</span></div><div class="line"></div><div class="line">    <span class="comment">// Attach categories</span></div><div class="line">    methodizeClass(cls, previously); <span class="comment">//æ·»åŠ åˆ†ç±»ä¿¡æ¯</span></div><div class="line"></div><div class="line">    return cls;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å¤„ç†åˆ†ç±»çš„ä¿¡æ¯ä¹‹å‰ï¼Œå…ˆä»ç±»é‡Œå–å‡ºäº†ç±»ä¿¡æ¯ roï¼Œç„¶ååˆå§‹åŒ–äº† rwï¼Œå†å°† ro ä¿å­˜åˆ° rw é‡Œã€‚</p>
<h3 id="method-array-t"><a href="#method-array-t" class="headerlink" title="method_array_t"></a>method_array_t</h3><p>methods æ˜¯ç”¨ method_array_t å®šä¹‰çš„ï¼Œmethod_array_t æ˜¯ä¸€ä¸ª list_array_tt ç±»å‹çš„äºŒç»´æ•°ç»„ï¼Œmethod_array_t é‡Œå­˜å‚¨çš„æ˜¯æ•°ç»„ method_list_tï¼Œæ•°ç»„ method_list_t é‡Œå­˜å‚¨çš„æ˜¯ method_tï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">method_array_t</span> :</span> </div><div class="line">    <span class="keyword">public</span> list_array_tt&lt;<span class="keyword">method_t</span>, <span class="keyword">method_list_t</span>&gt; <span class="comment">//list_array_tt&lt;Element, List&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">typedef</span> list_array_tt&lt;<span class="keyword">method_t</span>, <span class="keyword">method_list_t</span>&gt; Super;</div><div class="line"></div><div class="line"> <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">method_array_t</span>() : Super() &#123; &#125;</div><div class="line">    <span class="keyword">method_array_t</span>(<span class="keyword">method_list_t</span> *l) : Super(l) &#123; &#125;</div><div class="line"></div><div class="line">    <span class="keyword">method_list_t</span> * <span class="function"><span class="keyword">const</span> *<span class="title">beginCategoryMethodLists</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> beginLists();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">method_list_t</span> * <span class="function"><span class="keyword">const</span> *<span class="title">endCategoryMethodLists</span><span class="params">(Class cls)</span> <span class="keyword">const</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">method_array_t</span> duplicate() &#123;</div><div class="line">        <span class="keyword">return</span> Super::duplicate&lt;<span class="keyword">method_array_t</span>&gt;();</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæ˜¯ç±»å¯¹è±¡ï¼Œmethods é‡Œä¿å­˜çš„æ˜¯å¯¹è±¡æ–¹æ³•ï¼Œå¦‚æœæ˜¯å…ƒç±»å¯¹è±¡ï¼Œmethods é‡Œä¿å­˜çš„æ˜¯ç±»æ–¹æ³•ã€‚  </p>
<h3 id="property-array-t"><a href="#property-array-t" class="headerlink" title="property_array_t"></a>property_array_t</h3><p>properties æ˜¯ç”¨ property_array_t å®šä¹‰çš„ï¼Œproperty_array_t æ˜¯ä¸€ä¸ª list_array_tt ç±»å‹çš„äºŒç»´æ•°ç»„ï¼Œproperty_array_t é‡Œå­˜å‚¨çš„æ˜¯æ•°ç»„ property_tï¼Œæ•°ç»„ property_t å­˜å‚¨çš„æ˜¯ property_tï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">property_array_t</span> :</span> </div><div class="line">    <span class="keyword">public</span> list_array_tt&lt;<span class="keyword">property_t</span>, <span class="keyword">property_list_t</span>&gt; <span class="comment">//list_array_tt&lt;Element, List&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">typedef</span> list_array_tt&lt;<span class="keyword">property_t</span>, <span class="keyword">property_list_t</span>&gt; Super;</div><div class="line"></div><div class="line"> <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">property_array_t</span>() : Super() &#123; &#125;</div><div class="line">    <span class="keyword">property_array_t</span>(<span class="keyword">property_list_t</span> *l) : Super(l) &#123; &#125;</div><div class="line"></div><div class="line">    <span class="keyword">property_array_t</span> duplicate() &#123;</div><div class="line">        <span class="keyword">return</span> Super::duplicate&lt;<span class="keyword">property_array_t</span>&gt;();</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="protocol-array-t"><a href="#protocol-array-t" class="headerlink" title="protocol_array_t"></a>protocol_array_t</h3><p>protocols æ˜¯ç”¨ protocol_array_t å®šä¹‰çš„ï¼Œprotocol_array_t æ˜¯ä¸€ä¸ª list_array_tt ç±»å‹çš„äºŒç»´æ•°ç»„ï¼Œprotocol_array_t é‡Œå­˜å‚¨çš„æ˜¯æ•°ç»„ protocol_ref_tï¼Œæ•°ç»„ protocol_ref_t å­˜å‚¨çš„æ˜¯ protocol_ref_tï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">protocol_array_t</span> :</span> </div><div class="line">    <span class="keyword">public</span> list_array_tt&lt;<span class="keyword">protocol_ref_t</span>, <span class="keyword">protocol_list_t</span>&gt; <span class="comment">//list_array_tt&lt;Element, List&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">typedef</span> list_array_tt&lt;<span class="keyword">protocol_ref_t</span>, <span class="keyword">protocol_list_t</span>&gt; Super;</div><div class="line"></div><div class="line"> <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">protocol_array_t</span>() : Super() &#123; &#125;</div><div class="line">    <span class="keyword">protocol_array_t</span>(<span class="keyword">protocol_list_t</span> *l) : Super(l) &#123; &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protocol_array_t</span> duplicate() &#123;</div><div class="line">        <span class="keyword">return</span> Super::duplicate&lt;<span class="keyword">protocol_array_t</span>&gt;();</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="class-ro-t"><a href="#class-ro-t" class="headerlink" title="class_ro_t"></a>class_ro_t</h2><p>class_ro_t é‡Œé¢çš„ baseMethodListã€baseProtocolsã€ivarsã€baseProperties æ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ˜¯åªè¯»çš„ï¼ŒåŒ…å«äº†ç±»çš„åˆå§‹å†…å®¹ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">class_ro_t</span> &#123;</span></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line"></div><div class="line">    <span class="keyword">method_list_t</span> * baseMethodList;</div><div class="line">    <span class="keyword">protocol_list_t</span> * baseProtocols;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">ivar_list_t</span> * ivars;</div><div class="line">    </div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line"></div><div class="line">    <span class="keyword">property_list_t</span> *baseProperties;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime10.png" alt="Runtime10"></p>
<h3 id="method-list-tã€ivar-list-t-å’Œ-property-list-t"><a href="#method-list-tã€ivar-list-t-å’Œ-property-list-t" class="headerlink" title="method_list_tã€ivar_list_t å’Œ property_list_t"></a>method_list_tã€ivar_list_t å’Œ property_list_t</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">method_list_t</span> :</span> entsize_list_tt&lt;<span class="keyword">method_t</span>, <span class="keyword">method_list_t</span>, <span class="number">0x3</span>&gt; &#123;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isUniqued</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isFixedUp</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setFixedUp</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">uint32_t</span> indexOfMethod(<span class="keyword">const</span> <span class="keyword">method_t</span> *meth) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">uint32_t</span> i = </div><div class="line">            (<span class="keyword">uint32_t</span>)(((<span class="keyword">uintptr_t</span>)meth - (<span class="keyword">uintptr_t</span>)<span class="keyword">this</span>) / entsize());</div><div class="line">        ASSERT(i &lt; count);</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ivar_list_t</span> :</span> entsize_list_tt&lt;<span class="keyword">ivar_t</span>, <span class="keyword">ivar_list_t</span>, <span class="number">0</span>&gt; &#123;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">containsIvar</span><span class="params">(Ivar ivar)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (ivar &gt;= (Ivar)&amp;*begin()  &amp;&amp;  ivar &lt; (Ivar)&amp;*end());</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">property_list_t</span> :</span> entsize_list_tt&lt;<span class="keyword">property_t</span>, <span class="keyword">property_list_t</span>, <span class="number">0</span>&gt; &#123;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="method-t"><a href="#method-t" class="headerlink" title="method_t"></a>method_t</h2><p>method_t æ˜¯å¯¹æ–¹æ³•\å‡½æ•°çš„å°è£…ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> MethodListIMP = IMP;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">method_t</span> &#123;</span></div><div class="line">    SEL name;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *types;</div><div class="line">    MethodListIMP imp;</div><div class="line"></div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime11.png" alt="Runtime11"></p>
<h3 id="IMP"><a href="#IMP" class="headerlink" title="IMP"></a>IMP</h3><p><code>IMP</code> ä»£è¡¨å‡½æ•°çš„å…·ä½“å®ç°ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime12.png" alt="Runtime12"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">void</span>)test;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__); <span class="comment">//æ–­ç‚¹2</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    Person *person = [[Person alloc] init];</div><div class="line">    </div><div class="line">    test_objc_class *cls = (__bridge test_objc_class*)[Person <span class="keyword">class</span>];</div><div class="line">    class_rw_t *data = cls-&gt;data();</div><div class="line">    </div><div class="line">    [person test]; <span class="comment">//æ–­ç‚¹1</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–­ç‚¹1æ‰“å° impï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime17.png" alt="Runtime17"></p>
<p>æ–­ç‚¹2æŸ¥çœ‹ <code>-(void)test</code> çš„å†…å­˜ï¼ˆé€‰æ‹© Debug -&gt; Debug Workflow -&gt; Always Show Disassemblyï¼‰ï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime18.png" alt="Runtime10"></p>
<p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œimp æŒ‡å‘çš„å†…å­˜åœ°å€å°±æ˜¯ <code>-(void)test</code> æ–¹æ³•çš„å†…å­˜åœ°å€ã€‚</p>
<h3 id="SEL"><a href="#SEL" class="headerlink" title="SEL"></a>SEL</h3><p><code>SEL</code> ä»£è¡¨æ–¹æ³•\å‡½æ•°åï¼Œä¸€èˆ¬å«åšé€‰æ‹©å™¨ï¼Œåº•å±‚ç»“æ„è·Ÿ <code>char *</code> ç±»ä¼¼ã€‚<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime13.png" alt="Runtime13"></p>
<ul>
<li>å¯ä»¥é€šè¿‡ <code>@selector()</code> å’Œ <code>sel_registerName()</code> è·å¾—ã€‚</li>
<li>å¯ä»¥é€šè¿‡ <code>sel_getName()</code> å’Œ <code>NSStringFromSelector()</code> è½¬æˆå­—ç¬¦ä¸²ã€‚</li>
<li>ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•ï¼Œæ‰€å¯¹åº”çš„æ–¹æ³•é€‰æ‹©å™¨æ˜¯ç›¸åŒçš„</li>
</ul>
<p>ä¸‹é¢çš„ä»£ç éœ€è¦ç”¨åˆ° ClassInfo.hï¼Œå¹¶ä¸”éœ€è¦çœŸæœºè¿è¡Œï¼š<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">int main(<span class="name">int</span> argc, char * argv[]) &#123;</div><div class="line">    NSString * appDelegateClassName<span class="comment">;</span></div><div class="line">    @autoreleasepool &#123;</div><div class="line">        appDelegateClassName = NSStringFromClass([AppDelegate class])<span class="comment">;</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //SELï¼ˆ@selector()ï¼‰å°±æ˜¯å­—ç¬¦ä¸²</div><div class="line">    NSLog(@<span class="string">"%s, %s"</span>, <span class="string">"test"</span>, @selector(<span class="name">test</span>))<span class="comment">;</span></div><div class="line">    </div><div class="line">    //å¯ä»¥é€šè¿‡@selector()å’Œsel_registerName()è·å¾—</div><div class="line">    SEL sel1 = @selector(<span class="name">test</span>)<span class="comment">;</span></div><div class="line">    SEL sel2 = sel_registerName(<span class="string">"test"</span>)<span class="comment">;</span></div><div class="line">    NSLog(@<span class="string">"sel1ï¼š%s, sel2ï¼š%s"</span>, sel1, sel2)<span class="comment">;</span></div><div class="line">    </div><div class="line">    //å¯ä»¥é€šè¿‡sel_getName()å’ŒNSStringFromSelector()è½¬æˆå­—ç¬¦ä¸²</div><div class="line">    char *selString1 = sel_getName(sel1);</div><div class="line">    NSString *selString2 = NSStringFromSelector(<span class="name">sel2</span>)<span class="comment">;</span></div><div class="line">    NSLog(@<span class="string">"selString1ï¼š%s, selString2ï¼š%@"</span>, selString1, selString2)<span class="comment">;</span></div><div class="line">    </div><div class="line">    //ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•ï¼Œæ‰€å¯¹åº”çš„æ–¹æ³•é€‰æ‹©å™¨æ˜¯ç›¸åŒçš„</div><div class="line">    NSLog(@<span class="string">"%p, %p, %p"</span>, @selector(<span class="name">test</span>), @selector(<span class="name">test</span>), sel_registerName(<span class="string">"test"</span>))<span class="comment">;</span></div><div class="line">    </div><div class="line">    return UIApplicationMain(<span class="name">argc</span>, argv, <span class="literal">nil</span>, appDelegateClassName)<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">test</span>, <span class="keyword">test</span></div><div class="line">sel1ï¼š<span class="keyword">test</span>, sel2ï¼š<span class="keyword">test</span></div><div class="line">selString1ï¼š<span class="keyword">test</span>, selString2ï¼š<span class="keyword">test</span></div><div class="line"><span class="number">0x7fff5281ed06</span>, <span class="number">0x7fff5281ed06</span>, <span class="number">0x7fff5281ed06</span></div></pre></td></tr></table></figure></p>
<h3 id="types"><a href="#types" class="headerlink" title="types"></a>types</h3><p>types åŒ…å«äº†å‡½æ•°è¿”å›å€¼ã€å‚æ•°ç¼–ç çš„å­—ç¬¦ä¸²ã€‚<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime14.png" alt="Runtime14"></p>
<p>ä¸‹é¢çš„ä»£ç éœ€è¦ç”¨åˆ° ClassInfo.hï¼Œå¹¶ä¸”éœ€è¦çœŸæœºè¿è¡Œï¼š<br>ä¾‹1ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">void</span>)test;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    Person *person = [[Person alloc] init];</div><div class="line">    </div><div class="line">    test_objc_class *cls = (__bridge test_objc_class*)[Person <span class="keyword">class</span>];</div><div class="line">    class_rw_t *data = cls-&gt;data();</div><div class="line">    [person test]; <span class="comment">//æ–­ç‚¹1</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ–­ç‚¹1å‡ºæ‰“å° typesï¼š<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime19.png" alt="Runtime19"><br>â€œv16@0:8â€ æ˜¯ç±»å‹ç¼–ç ï¼š<code>v</code>ï¼šè¿”å›å€¼ç±»å‹ voidï¼Œ<code>16</code>ï¼šå‚æ•°å çš„å­—èŠ‚æ•°ä¹‹å’Œï¼ˆidï¼ˆ8ä¸ªå­—èŠ‚ï¼‰ + SELï¼ˆ8ä¸ªå­—èŠ‚ï¼‰ï¼‰ï¼Œ<code>@</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ idï¼Œ<code>0</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°å†…å­˜çš„å¼€å§‹ä½ç½®ï¼Œ<code>:</code>ï¼šç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ SELï¼Œ<code>8</code>ï¼šç¬¬äºŒä¸ªå‚æ•°å†…å­˜çš„å¼€å§‹ä½ç½®ï¼ˆid å äº†8ä¸ªå­—èŠ‚ï¼‰ã€‚  </p>
<p>ä¸‹é¢çš„ä»£ç éœ€è¦ç”¨åˆ° ClassInfo.hï¼Œå¹¶ä¸”éœ€è¦çœŸæœºè¿è¡Œï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"><span class="comment">// v 16 @ 0 : 8</span></div><div class="line"><span class="comment">//- (void)test:(id)self _cmd:(SEL)_cmd</span></div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>ä¾‹2ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">int</span>)test:(<span class="keyword">int</span>)age height:(<span class="keyword">float</span>)height;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">- (<span class="keyword">int</span>)test:(<span class="keyword">int</span>)age height:(<span class="keyword">float</span>)height &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Person *person = [[Person alloc] init];</div><div class="line">    test_objc_class *cls = (__bridge test_objc_class*)[Person <span class="keyword">class</span>];</div><div class="line">    class_rw_t *data = cls-&gt;data();</div><div class="line">    [person test:<span class="number">20</span> height:<span class="number">30</span>]; <span class="comment">//æ–­ç‚¹1</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ–­ç‚¹1å‡ºæ‰“å° typesï¼šï¼š<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">P<span class="function"><span class="title">rinting</span> description of <span class="keyword">data</span>-&gt;</span><span class="function"><span class="title">methods</span>-&gt;</span>first.types:</div><div class="line">(const char *) types = <span class="number">0</span>x0000000100087d4d <span class="string">"i24@0:8i16f20"</span></div></pre></td></tr></table></figure></p>
<p>â€œi24@0:8i16f20â€ æ˜¯ç±»å‹ç¼–ç ï¼š<code>i</code>ï¼šèŒƒå›´å€¼ç±»å‹ intï¼Œ<code>24</code>ï¼šå‚æ•°å çš„å­—èŠ‚æ•°ä¹‹å’Œï¼ˆidï¼ˆ8ä¸ªå­—èŠ‚ï¼‰ + SELï¼ˆ8ä¸ªå­—èŠ‚ï¼‰+ intï¼ˆ4ä¸ªå­—èŠ‚ï¼‰+ floatï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ï¼‰ï¼Œ<code>@</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ idï¼Œ<code>0</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°å†…å­˜çš„å¼€å§‹ä½ç½®ï¼Œ<code>:</code>ï¼šç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ SELï¼Œ<code>8</code>ï¼šç¬¬äºŒä¸ªå‚æ•°å†…å­˜çš„å¼€å§‹ä½ç½®ï¼ˆid å äº†8ä¸ªå­—èŠ‚ï¼‰ï¼Œ<code>i</code>ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹ intï¼Œ<code>16</code>ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„å¼€å§‹ä½ç½®ï¼ˆid å äº†8ä¸ªå­—èŠ‚ + SEL å äº†8ä¸ªå­—èŠ‚ï¼‰ï¼Œ<code>f</code>ï¼šç¬¬å››ä¸ªå‚æ•°çš„ç±»å‹ floatï¼Œ<code>20</code>ï¼šç¬¬å››ä¸ªå‚æ•°çš„å¼€å§‹ä½ç½®ï¼ˆid å äº†8ä¸ªå­—èŠ‚ + SEL å äº†8ä¸ªå­—èŠ‚ + int å äº†4ä¸ªå­—èŠ‚ï¼‰ã€‚<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"><span class="comment">// i 24 @ 0 : 8 i 16 f 20</span></div><div class="line"><span class="comment">//- (int)test:(id)self _cmd:(SEL)_cmd age:(int)age height:(float)height</span></div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<h3 id="Type-Encoding"><a href="#Type-Encoding" class="headerlink" title="Type Encoding"></a>Type Encoding</h3><p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="external">Type Encodings</a> æ˜¯ iOS ä¸­æä¾›çš„ä¸€ä¸ªå«åš @encode çš„æŒ‡ä»¤ï¼Œå¯ä»¥å°†å…·ä½“çš„ç±»å‹è¡¨ç¤ºæˆå­—ç¬¦ä¸²ç¼–ç ã€‚<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime15.png" alt="Runtime15"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"id == %sï¼ŒSEL == %s"</span>, <span class="keyword">@encode</span>(<span class="keyword">id</span>), <span class="keyword">@encode</span>(SEL));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">id</span> == @ï¼ŒSEL == :</div></pre></td></tr></table></figure></p>
<h2 id="æ–¹æ³•ç¼“å­˜"><a href="#æ–¹æ³•ç¼“å­˜" class="headerlink" title="æ–¹æ³•ç¼“å­˜"></a>æ–¹æ³•ç¼“å­˜</h2><p>Class å†…éƒ¨ç»“æ„ä¸­æœ‰ä¸ªæ–¹æ³•ç¼“å­˜ cacheï¼ˆcache_tï¼‰ï¼Œç”¨æ•£åˆ—è¡¨ï¼ˆå“ˆå¸Œè¡¨ï¼‰æ¥ç¼“å­˜æ›¾ç»è°ƒç”¨è¿‡çš„æ–¹æ³•ï¼Œå¯ä»¥æé«˜æ–¹æ³•çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚<br><img src="/2020/06/12/OCåº•å±‚/åŸç†/Runtime/Runtime16.png" alt="Runtime16"></p>
<p>ç¼“å­˜æŸ¥æ‰¾ï¼šobjc-cache.mm -&gt; <code>bucket_t * cache_t::find(cache_key_t k, id receiver)</code></p>
<p>cache_t é‡Œé€šè¿‡ _buckets ç¼“å­˜æ–¹æ³•ï¼Œé€šè¿‡ _mask è®¡ç®—ç´¢å¼•ï¼Œé€šè¿‡ _occupied ç»Ÿè®¡å·²ç»ç¼“å­˜çš„æ–¹æ³•çš„æ•°é‡ã€‚_buckets é‡Œç¼“å­˜çš„æ˜¯ bucke_t ç»“æ„ä½“ï¼š<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">_key</span> = @selector(æ–¹æ³•å)</div><div class="line"><span class="attr">_imp</span> = æ–¹æ³•çš„å‡½æ•°åœ°å€</div></pre></td></tr></table></figure></p>
<h3 id="mask"><a href="#mask" class="headerlink" title="_mask"></a>_mask</h3><p>_mask çš„å€¼æ˜¯æ•£åˆ—è¡¨çš„é•¿åº¦-1ï¼Œä¿è¯â€œä¸â€è¿ç®—çš„ç»“æœä¸ä¼šè¶…å‡ºæ•£åˆ—è¡¨çš„é•¿åº¦ï¼ˆ&amp;_mask &lt;= _maskï¼‰ï¼Œå³è®¡ç®—å‡ºçš„ç´¢å¼•ä¸ä¼šè¶Šç•Œã€‚</p>
<p>å‡è®¾ _mask = 0b0000 1000ï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  <span class="number">0b0100</span> <span class="number">1101</span></div><div class="line">&amp; <span class="number">0b0000</span> <span class="number">1000</span></div><div class="line">--------------</div><div class="line">  <span class="number">0b0000</span> <span class="number">1000</span></div></pre></td></tr></table></figure></p>
<p>æ•£åˆ—è¡¨ï¼ˆå“ˆå¸Œè¡¨ï¼‰çš„å®ç°é€»è¾‘ï¼š<br>1ã€å®ç°ä¸€ä¸ªæ–¹æ³•1å¯ä»¥è®¡ç®—å‡ºç´¢å¼•ï¼›<br>2ã€å®ç°ä¸€ä¸ªæ–¹æ³•2å¯ä»¥è§£å†³ç´¢å¼•å†²çªï¼ˆå¦‚ï¼šå¯¹ç´¢å¼• -1 è®¡ç®—å‡ºæ–°çš„ç´¢å¼•å€¼ï¼‰ï¼›</p>
<p>ä½¿ç”¨æ±‚ä½™ <code>%</code> ä¹Ÿå¯ä»¥å®ç°æ•£åˆ—è¡¨ï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼Œé€šè¿‡æ±‚ä½™è®¡ç®—å‡ºçš„ç´¢å¼•ä¹Ÿå¯ä»¥ä¿è¯ä¸è¶Šç•Œã€‚</p>
<h3 id="buckets"><a href="#buckets" class="headerlink" title="_buckets"></a>_buckets</h3><p>_buckets åœ¨åˆå§‹åŒ–æ—¶çš„ç©ºé—´å¤§å°æ˜¯æŒ‡å®šå¥½çš„ï¼Œå¹¶ä¸”å†…éƒ¨çš„æ•°æ®éƒ½æ˜¯ NULLï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰ã€‚å¦‚æœ _buckets é‡Œçš„æ•°æ®æ»¡äº†ï¼Œ_buckets ä¼šå°†æ•°æ®æ¸…ç©º -&gt; æ‰©å®¹x2ï¼ˆä¸€å€ï¼‰-&gt; é‡æ–°ç¼“å­˜ã€‚</p>
<p>å…ˆé€šè¿‡ <code>mask_t begin = cache_hash(sel, m)</code> è®¡ç®—å‡ºç´¢å¼• beginï¼š<br>å¦‚æœ begin å¤„æ²¡æœ‰å€¼ï¼Œç¼“å­˜ã€‚<br>å¦‚æœ begin å¤„æœ‰å€¼ï¼Œæ˜¯å½“å‰éœ€è¦ç¼“å­˜çš„æ–¹æ³•ï¼Œè¡¨ç¤ºå·²ç»ç¼“å­˜è¿‡äº†ç›´æ¥è¿”å›ã€‚<br>å¦‚æœ begin å¤„æœ‰å€¼ï¼Œä¸æ˜¯å½“å‰éœ€è¦ç¼“å­˜çš„æ–¹æ³•ï¼Œé€šè¿‡ <code>(i = cache_next(i, m)</code> è®¡ç®—å‡ºæ–°çš„ç´¢å¼•ï¼Œå¦‚æœæ–°çš„ç´¢å¼•ä¸ç­‰äº begin åˆ™é‡æ–°åˆ¤æ–­ï¼Œå¦‚æœæ–°çš„ç´¢å¼•ç­‰äº begin åˆ™å»æ‰©å®¹ï¼ˆbad_cache()ï¼‰ã€‚<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">void cache_t:<span class="type"></span>:insert(Class cls, SEL sel, IMP imp, id receiver)</div><div class="line">&#123;</div><div class="line">    ...... <span class="comment">//çœç•¥</span></div><div class="line"></div><div class="line">    <span class="comment">// Use the cache as-is if it is less than 3/4 full</span></div><div class="line">    mask_t <span class="keyword">new</span><span class="type">Occupied</span> = occupied() + <span class="number">1</span>; <span class="comment">//occupied() æ•£åˆ—è¡¨é•¿åº¦ï¼ŒnewOccupied æ·»åŠ åçš„é•¿åº¦</span></div><div class="line">    unsigned oldCapacity = capacity(), capacity = oldCapacity;</div><div class="line">    <span class="keyword">if</span> (slowpath(isConstantEmptyCache())) &#123; <span class="comment">//ç¬¬ä¸€æ¬¡</span></div><div class="line">        <span class="comment">// Cache is read-only. Replace it.</span></div><div class="line">        <span class="keyword">if</span> (!capacity) capacity = INIT_CACHE_SIZE;</div><div class="line">        reallocate(oldCapacity, capacity, <span class="comment">/* freeOld */</span><span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fastpath(<span class="keyword">new</span><span class="type">Occupied</span> + CACHE_END_MARKER &lt;= capacity / <span class="number">4</span> * <span class="number">3</span>)) &#123; <span class="comment">//å·²ç»ç¼“å­˜çš„æ•°æ®ä¸è¶³3/4</span></div><div class="line">        <span class="comment">// Cache is less than 3/4 full. Use it as-is.</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        capacity = capacity ? capacity * <span class="number">2</span> : <span class="type">INIT_CACHE_SIZE</span>; <span class="comment">//æ‰©å®¹x2</span></div><div class="line">        <span class="keyword">if</span> (capacity &gt; MAX_CACHE_SIZE) &#123;</div><div class="line">            capacity = MAX_CACHE_SIZE;</div><div class="line">        &#125;</div><div class="line">        reallocate(oldCapacity, capacity, <span class="literal">true</span>); <span class="comment">//æ¸…ç©ºæ•°æ® -&gt; æ‰©å®¹</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    bucket_t *b = buckets();</div><div class="line">    mask_t m = capacity - <span class="number">1</span>;</div><div class="line">    mask_t begin = cache_hash(sel, m); <span class="comment">//è®¡ç®—å‡ºç´¢å¼•</span></div><div class="line">    mask_t i = begin;</div><div class="line"></div><div class="line">    <span class="comment">// Scan for the first unused slot and insert there.</span></div><div class="line">    <span class="comment">// There is guaranteed to be an empty slot because the</span></div><div class="line">    <span class="comment">// minimum size is 4 and we resized at 3/4 full.</span></div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        <span class="keyword">if</span> (fastpath(b[i].sel() == <span class="number">0</span>)) &#123; <span class="comment">//å¦‚æœ begin å¤„æ²¡æœ‰å€¼ï¼Œç¼“å­˜</span></div><div class="line">            incrementOccupied();</div><div class="line">            b[i].<span class="keyword">set</span>&lt;Atomic, Encoded&gt;(sel, imp, cls);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (b[i].sel() == sel) &#123; <span class="comment">//ç´¢å¼•å¤„æœ‰å€¼ï¼Œæ˜¯å½“å‰éœ€è¦ç¼“å­˜çš„æ–¹æ³•</span></div><div class="line">            <span class="comment">// The entry was added to the cache by some other thread</span></div><div class="line">            <span class="comment">// before we grabbed the cacheUpdateLock.</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span> (fastpath((i = cache_next(i, m)) != begin)); <span class="comment">//è®¡ç®—å‡ºæ–°çš„ç´¢å¼•ï¼Œåˆ¤æ–­æ–°çš„ç´¢å¼•æ˜¯å¦ç­‰äº beginï¼Œå¦‚æœç­‰äº begin åˆ™é‡æ–°åˆ¤æ–­ï¼Œå¦‚æœä¸ç­‰äº begin åˆ™è°ƒç”¨ bad_cache() å¤„ç†å¼‚å¸¸ç¼“å­˜</span></div><div class="line"></div><div class="line">    cache_t:<span class="type"></span>:bad_cache(receiver, (SEL)sel, cls);</div><div class="line">&#125;</div><div class="line"></div><div class="line">...... <span class="comment">//çœç•¥</span></div><div class="line"></div><div class="line">void cache_t:<span class="type"></span>:reallocate(mask_t oldCapacity, mask_t <span class="keyword">new</span><span class="type">Capacity</span>, bool freeOld)</div><div class="line">&#123;</div><div class="line">    bucket_t *oldBuckets = buckets(); <span class="comment">//æ—§çš„æ•£åˆ—è¡¨</span></div><div class="line">    bucket_t *<span class="keyword">new</span><span class="type">Buckets</span> = allocateBuckets(<span class="keyword">new</span><span class="type">Capacity</span>); <span class="comment">//æ–°çš„æ•£åˆ—è¡¨</span></div><div class="line"></div><div class="line">    <span class="comment">// Cache's old contents are not propagated. </span></div><div class="line">    <span class="comment">// This is thought to save cache memory at the cost of extra cache fills.</span></div><div class="line">    <span class="comment">// fixme re-measure this</span></div><div class="line"></div><div class="line">    ASSERT(<span class="keyword">new</span><span class="type">Capacity</span> &gt; <span class="number">0</span>);</div><div class="line">    ASSERT((uintptr_t)(mask_t)(<span class="keyword">new</span><span class="type">Capacity</span>-<span class="number">1</span>) == <span class="keyword">new</span><span class="type">Capacity</span>-<span class="number">1</span>);</div><div class="line"></div><div class="line">    setBucketsAndMask(<span class="keyword">new</span><span class="type">Buckets</span>, <span class="keyword">new</span><span class="type">Capacity</span> - <span class="number">1</span>); <span class="comment">//ä½¿ç”¨æ–°çš„æ•£åˆ—è¡¨ï¼Œ_mask = newCapacity - 1</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (freeOld) &#123;</div><div class="line">        cache_collect_free(oldBuckets, oldCapacity); <span class="comment">//æ¸…ç©ºæ—§çš„æ•°æ®</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>__arm64__</code> ä¸‹çš„ cache_next æ–¹æ³•ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> mask_t <span class="title">cache_next</span><span class="params">(<span class="keyword">mask_t</span> i, <span class="keyword">mask_t</span> mask)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> i ? i<span class="number">-1</span> : mask;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç©ºé—´æ¢æ—¶é—´"><a href="#ç©ºé—´æ¢æ—¶é—´" class="headerlink" title="ç©ºé—´æ¢æ—¶é—´"></a>ç©ºé—´æ¢æ—¶é—´</h3><p>æ•£åˆ—è¡¨ï¼ˆå“ˆå¸Œè¡¨ï¼‰éå†å…ƒç´ çš„æ•ˆç‡æ¯”æ•°ç»„é«˜çš„åŸå› æ˜¯ç‰ºç‰²äº†ä¸€å®šçš„ç©ºé—´æ¢å–äº†æ—¶é—´ã€‚<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span>(<span class="params"><span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]</span>) </span>&#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        Person *person = [[Person alloc] init];</div><div class="line">        [<span class="meta">person testPerson</span>];</div><div class="line">        [<span class="meta">person testPerson</span>];</div><div class="line">        [<span class="meta">person testStudent</span>];</div><div class="line">        [<span class="meta">person testStudent2</span>];</div><div class="line">        <span class="comment">//......</span></div><div class="line">        [<span class="meta">person testStudentN</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>ç´¢å¼•</th>
<th>ç¼“å­˜çš„æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>NULL</td>
</tr>
<tr>
<td>1</td>
<td>bucket_tï¼ˆ_key = @selector(testStudent2), _impï¼‰</td>
</tr>
<tr>
<td>2</td>
<td>bucket_tï¼ˆ_key = @selector(testStudent), _impï¼‰</td>
</tr>
<tr>
<td>3</td>
<td>NULL</td>
</tr>
<tr>
<td>4</td>
<td>bucket_tï¼ˆ_key = @selector(testPerson), _impï¼‰</td>
</tr>
<tr>
<td>5</td>
<td>NULL</td>
</tr>
<tr>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
</tr>
</tbody>
</table>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>[person testPerson]</code> å³ <code>objc_msgSend(objc_getClass(&quot;Person&quot;), sel_registerName(&quot;testPerson&quot;))</code> å‘ person å®ä¾‹å¯¹è±¡å‘é€ä¸€æ¡ testPerson æ¶ˆæ¯ï¼Œperson ä¼šé€šè¿‡ isa æ‰¾åˆ° Person ç±»å¯¹è±¡æŸ¥æ‰¾ <code>-(void)testPerson</code> æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå†é€šè¿‡ superclass æ‰¾åˆ°çˆ¶ç±»çš„ç±»å¯¹è±¡ç»§ç»­æŸ¥æ‰¾ã€‚å‡è®¾åœ¨æŸ¥æ‰¾åˆ°åŸºç±»çš„ç±»å¯¹è±¡æ—¶æ‰¾åˆ°äº†  <code>-(void)testPerson</code> æ–¹æ³•ï¼Œå®åˆ—å¯¹è±¡ person ä¼šæŠŠ <code>-(void)testPerson</code> æ–¹æ³•ç¼“å­˜åˆ° _buckets é‡Œç„¶åè¿”å›ã€‚</p>
<p>åœ¨ç¼“å­˜ <code>@selector(testPerson)</code> æ–¹æ³•æ—¶ï¼Œå…ˆè®¡ç®—å‡ºç´¢å¼•ï¼ˆ4ï¼‰ï¼Œç„¶åæ£€æŸ¥ç´¢å¼•å¤„æ˜¯å¦æœ‰å€¼ï¼Œæ²¡å€¼ï¼Œå°† <code>@selector(testPerson)</code> ç¼“å­˜åˆ°å¯¹è±¡çš„ç´¢å¼•å¤„ã€‚</p>
<p>ç¬¬äºŒæ¬¡è°ƒç”¨ <code>[person testPerson]</code> ä¼šå…ˆå»å®ä¾‹å¯¹è±¡ person çš„ _buckets é‡Œæ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•å¤„çš„å€¼åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰æ–¹æ³• <code>@selector(testPerson)</code>ï¼Œå¦‚æœæ˜¯å°±ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸æ˜¯å°±å°†ç´¢å¼• -1 ç»§ç»­åœ¨ _buckets é‡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†å°±ç›´æ¥è¿”å›ã€‚å¦‚æœæ‰¾äº†ä¸€åœˆè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šåŒç¬¬ä¸€æ¬¡ä¸€æ ·å»ç±»å¯¹è±¡å’Œçˆ¶ç±»çš„ç±»å¯¹è±¡æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åç¼“å­˜åˆ° _buckets é‡Œå¹¶è¿”å›ã€‚</p>
<p>åœ¨ç¼“å­˜ <code>@selector(testStudent)</code> æ–¹æ³•æ—¶ï¼Œå…ˆè®¡ç®—å‡ºç´¢å¼•ï¼ˆ2ï¼‰ï¼Œç„¶åæ£€æŸ¥ç´¢å¼•å¤„æ˜¯å¦æœ‰å€¼ï¼Œæ²¡å€¼ï¼Œå°† <code>@selector(testPerson)</code> ç¼“å­˜åˆ°å¯¹è±¡çš„ç´¢å¼•å¤„ã€‚</p>
<p>åœ¨ç¼“å­˜ <code>@selector(testStudent2)</code> æ–¹æ³•æ—¶ï¼Œå…ˆè®¡ç®—å‡ºç´¢å¼•ï¼ˆå‡è®¾ä¸ <code>@selector(testStudent)</code> ç›¸åŒï¼ˆ2ï¼‰ï¼‰ï¼Œç„¶åæ£€æŸ¥ç´¢å¼•å¤„æ˜¯å¦æœ‰å€¼ï¼Œæœ‰å€¼ï¼Œå°†ç´¢å¼• -1 è·å–åˆ°æ–°çš„ç´¢å¼•ï¼ˆ1ï¼‰ï¼Œå†æ£€æŸ¥æ–°çš„ç´¢å¼•å¤„æ˜¯å¦æœ‰å€¼ï¼Œæ²¡å€¼ï¼Œå°† <code>@selector(testStudent2)</code> ç¼“å­˜åˆ°å¯¹è±¡çš„ç´¢å¼•å¤„ã€‚</p>
<p>å‡è®¾åœ¨ç¼“å­˜ <code>@selector(testStudentN)</code> æ—¶ _buckets æ»¡äº†ï¼Œé‚£ä¹ˆ _buckets ä¼šæ¸…ç©ºæ•°æ® -&gt; æ‰©å®¹x2 -&gt; é‡æ–°ç¼“å­˜ã€‚</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/OCåº•å±‚åŸç†/" rel="tag"># OCåº•å±‚åŸç†</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/31/OCåº•å±‚/åŸç†/block/" rel="next" title="block">
                <i class="fa fa-chevron-left"></i> block
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="gitalk-container"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/myAvatar.gif"
              alt="Kevin" />
          
            <p class="site-author-name" itemprop="name">Kevin</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/KevinYangGit" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/_YangQI" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>Twitter</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#isa-è¯¦è§£"><span class="nav-number">1.</span> <span class="nav-text">isa è¯¦è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½è¿ç®—"><span class="nav-number">1.1.</span> <span class="nav-text">ä½è¿ç®—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾è®¡"><span class="nav-number">1.1.1.</span> <span class="nav-text">è®¾è®¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å€¼"><span class="nav-number">1.1.2.</span> <span class="nav-text">å–å€¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ©ç "><span class="nav-number">1.1.3.</span> <span class="nav-text">æ©ç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾å€¼"><span class="nav-number">1.1.4.</span> <span class="nav-text">è®¾å€¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½åŸŸ"><span class="nav-number">1.2.</span> <span class="nav-text">ä½åŸŸ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…±ç”¨ä½“ï¼ˆunionï¼‰"><span class="nav-number">1.3.</span> <span class="nav-text">å…±ç”¨ä½“ï¼ˆunionï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#struct"><span class="nav-number">1.3.1.</span> <span class="nav-text">struct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union"><span class="nav-number">1.3.2.</span> <span class="nav-text">union</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ç°"><span class="nav-number">1.3.3.</span> <span class="nav-text">å®ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#isa"><span class="nav-number">1.4.</span> <span class="nav-text">isa</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#isa-t"><span class="nav-number">1.4.1.</span> <span class="nav-text">isa_t</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½åŸŸ-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">ä½åŸŸ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#has-assoc-å’Œ-weakly-referenced"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">has_assoc å’Œ weakly_referenced</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">å¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISA-MASK"><span class="nav-number">1.4.3.</span> <span class="nav-text">ISA_MASK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½è¿ç®—è¡¥å……"><span class="nav-number">1.5.</span> <span class="nav-text">ä½è¿ç®—è¡¥å……</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Class-çš„ç»“æ„"><span class="nav-number">2.</span> <span class="nav-text">Class çš„ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#class-rw-t"><span class="nav-number">2.1.</span> <span class="nav-text">class_rw_t</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#method-array-t"><span class="nav-number">2.1.1.</span> <span class="nav-text">method_array_t</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#property-array-t"><span class="nav-number">2.1.2.</span> <span class="nav-text">property_array_t</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#protocol-array-t"><span class="nav-number">2.1.3.</span> <span class="nav-text">protocol_array_t</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#class-ro-t"><span class="nav-number">2.2.</span> <span class="nav-text">class_ro_t</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#method-list-tã€ivar-list-t-å’Œ-property-list-t"><span class="nav-number">2.2.1.</span> <span class="nav-text">method_list_tã€ivar_list_t å’Œ property_list_t</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#method-t"><span class="nav-number">2.3.</span> <span class="nav-text">method_t</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IMP"><span class="nav-number">2.3.1.</span> <span class="nav-text">IMP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SEL"><span class="nav-number">2.3.2.</span> <span class="nav-text">SEL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#types"><span class="nav-number">2.3.3.</span> <span class="nav-text">types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Type-Encoding"><span class="nav-number">2.3.4.</span> <span class="nav-text">Type Encoding</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ–¹æ³•ç¼“å­˜"><span class="nav-number">2.4.</span> <span class="nav-text">æ–¹æ³•ç¼“å­˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mask"><span class="nav-number">2.4.1.</span> <span class="nav-text">_mask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#buckets"><span class="nav-number">2.4.2.</span> <span class="nav-text">_buckets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç©ºé—´æ¢æ—¶é—´"><span class="nav-number">2.4.3.</span> <span class="nav-text">ç©ºé—´æ¢æ—¶é—´</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 &mdash; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kevin</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://rawgit.com/qhh0205/78e9e0b1f3114db6737f3ed8cdd51d3a/raw/3894c5be5aa2378336b1f5ee0f296fa0b22d06e9/md5.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '82b6ced795961ee1fcca',
          clientSecret: '4a2f24a39c6fcd85813d80031c6e0262a65404f5',
          repo: 'KevinYangGit.github.io',
          owner: '',
          admin: [''],
          id: md5(location.pathname),
          distractionFreeMode: ''
        })
        gitalk.render('gitalk-container')
    </script>

  





  

  

  

  

  

  

</body>
</html>
